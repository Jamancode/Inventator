<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Inventartor</title>
    <style>
        /* ===== CSS Variables & Root Styles ===== */
        :root {
            /* Gr√ºn-Pastell Farbschema mit optimalen Kontrasten */
            --primary-green: #52b788;
            --primary-dark: #2d6a4f;
            --primary-light: #95d5b2;
            --accent-green: #74c69d;
            --background-light: #f1faee;
            --background-white: #ffffff;
            --text-dark: #1b4332;
            --text-medium: #40916c;
            --text-light: #52b788;
            --shadow-color: rgba(45, 106, 79, 0.1);
            --border-color: #d8f3dc;
            --error-color: #e63946;
            --warning-color: #f77f00;
            --success-color: #06ffa5;
            --info-color: #4ecdc4;

            /* Animationen */
            --transition-fast: 0.2s ease;
            --transition-medium: 0.4s ease;
            --transition-slow: 0.6s ease;

            /* Layout */
            --header-height: 60px;
            --sidebar-width: 280px;
            --border-radius: 12px;
            --border-radius-small: 8px;
            --spacing-xs: 0.25rem;
            --spacing-sm: 0.5rem;
            --spacing-md: 1rem;
            --spacing-lg: 1.5rem;
            --spacing-xl: 2rem;
        }

        /* Dark Mode Variables */
        [data-theme="dark"] {
            --primary-green: #74c69d;
            --primary-dark: #95d5b2;
            --primary-light: #40916c;
            --accent-green: #52b788;
            --background-light: #081c15;
            --background-white: #1b4332;
            --text-dark: #f1faee;
            --text-medium: #b7e4c7;
            --text-light: #95d5b2;
            --shadow-color: rgba(149, 213, 178, 0.1);
            --border-color: #2d6a4f;
        }

        /* ===== Reset & Base Styles ===== */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        html {
            font-size: 16px;
            scroll-behavior: smooth;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background-color: var(--background-light);
            color: var(--text-dark);
            line-height: 1.6;
            overflow-x: hidden;
            transition: background-color var(--transition-medium), color var(--transition-medium);
            font-size: 1.1rem; /* Gr√∂√üere Schrift f√ºr bessere Lesbarkeit */
        }

        /* ===== Loading Screen ===== */
        .loading-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, var(--primary-light) 0%, var(--accent-green) 100%);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 10000;
            transition: opacity 0.5s ease;
        }

        .loading-content {
            text-align: center;
            color: white;
        }

        .loading-spinner {
            width: 80px;
            height: 80px;
            border: 5px solid rgba(255, 255, 255, 0.3);
            border-top-color: white;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* ===== Header ===== */
        .header {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            height: var(--header-height);
            background: var(--background-white);
            box-shadow: 0 2px 20px var(--shadow-color);
            z-index: 1000;
            display: flex;
            align-items: center;
            padding: 0 var(--spacing-md);
            transition: all var(--transition-medium);
        }

        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            width: 100%;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: var(--spacing-sm);
            font-size: 1.3rem;
            font-weight: 700;
            color: var(--primary-dark);
        }

        .logo-icon {
            width: 36px;
            height: 36px;
            background: linear-gradient(135deg, var(--primary-green), var(--accent-green));
            border-radius: var(--border-radius-small);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.3rem;
            color: white;
            animation: pulse 2s ease infinite;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        .header-actions {
            display: flex;
            align-items: center;
            gap: var(--spacing-sm);
        }

        /* ===== Burger Menu ===== */
        .burger-menu {
            display: none;
            background: none;
            border: none;
            cursor: pointer;
            padding: var(--spacing-sm);
            position: relative;
            width: 40px;
            height: 40px;
        }

        .burger-line {
            position: absolute;
            left: 8px;
            height: 3px;
            width: 24px;
            background: var(--text-dark);
            border-radius: 2px;
            transition: all var(--transition-fast);
        }

        .burger-line:nth-child(1) { top: 10px; }
        .burger-line:nth-child(2) { top: 19px; }
        .burger-line:nth-child(3) { bottom: 10px; }

        .burger-menu.active .burger-line:nth-child(1) {
            transform: rotate(45deg);
            top: 19px;
        }

        .burger-menu.active .burger-line:nth-child(2) {
            opacity: 0;
        }

        .burger-menu.active .burger-line:nth-child(3) {
            transform: rotate(-45deg);
            bottom: 18px;
        }

        .theme-toggle {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: var(--text-medium);
            transition: all var(--transition-fast);
            padding: var(--spacing-sm);
            border-radius: var(--border-radius-small);
        }

        .theme-toggle:hover {
            background: var(--background-light);
            color: var(--primary-dark);
            transform: rotate(180deg);
        }

        /* ===== Main Layout ===== */
        .app-container {
            display: flex;
            min-height: 100vh;
            padding-top: var(--header-height);
        }

        /* ===== Sidebar Navigation ===== */
        .sidebar {
            width: var(--sidebar-width);
            background: var(--background-white);
            box-shadow: 2px 0 20px var(--shadow-color);
            padding: var(--spacing-lg);
            overflow-y: auto;
            transition: all var(--transition-medium);
            position: fixed;
            left: 0;
            top: var(--header-height);
            bottom: 0;
            z-index: 900;
        }

        .sidebar-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            z-index: 899;
        }

        .nav-item {
            display: flex;
            align-items: center;
            gap: var(--spacing-md);
            padding: var(--spacing-md) var(--spacing-lg);
            margin-bottom: var(--spacing-sm);
            border-radius: var(--border-radius-small);
            cursor: pointer;
            transition: all var(--transition-fast);
            color: var(--text-medium);
            font-weight: 500;
            font-size: 1.1rem;
        }

        .nav-item:hover {
            background: var(--background-light);
            color: var(--primary-dark);
            transform: translateX(5px);
        }

        .nav-item.active {
            background: linear-gradient(135deg, var(--primary-green), var(--accent-green));
            color: white;
            box-shadow: 0 5px 15px rgba(82, 183, 136, 0.3);
        }

        .nav-icon {
            font-size: 1.25rem;
            min-width: 24px;
        }

        /* ===== Main Content ===== */
        .main-content {
            flex: 1;
            margin-left: var(--sidebar-width);
            padding: var(--spacing-lg);
            transition: margin-left var(--transition-medium);
        }

        /* ===== Dashboard Stats ===== */
        .dashboard-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: var(--spacing-md);
            margin-bottom: var(--spacing-xl);
        }

        .stat-card {
            background: var(--background-white);
            border-radius: var(--border-radius);
            padding: var(--spacing-lg);
            box-shadow: 0 5px 20px var(--shadow-color);
            transition: all var(--transition-fast);
            position: relative;
            overflow: hidden;
        }

        .stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, var(--primary-green), var(--accent-green));
            transform: scaleX(0);
            transform-origin: left;
            transition: transform var(--transition-medium);
        }

        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 30px var(--shadow-color);
        }

        .stat-card:hover::before {
            transform: scaleX(1);
        }

        .stat-icon {
            width: 50px;
            height: 50px;
            background: var(--background-light);
            border-radius: var(--border-radius-small);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            color: var(--primary-green);
            margin-bottom: var(--spacing-md);
        }

        .stat-value {
            font-size: 2.5rem;
            font-weight: 700;
            color: var(--primary-dark);
            margin-bottom: var(--spacing-xs);
        }

        .stat-label {
            color: var(--text-medium);
            font-size: 1rem;
        }

        /* ===== Content Sections ===== */
        .content-section {
            background: var(--background-white);
            border-radius: var(--border-radius);
            padding: var(--spacing-xl);
            box-shadow: 0 5px 20px var(--shadow-color);
            margin-bottom: var(--spacing-xl);
            animation: fadeInUp 0.5s ease;
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: var(--spacing-lg);
            padding-bottom: var(--spacing-md);
            border-bottom: 2px solid var(--border-color);
            flex-wrap: wrap;
            gap: var(--spacing-md);
        }

        .section-title {
            font-size: 1.8rem;
            font-weight: 600;
            color: var(--primary-dark);
        }

        /* ===== Forms ===== */
        .form-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: var(--spacing-md);
        }

        .form-group {
            margin-bottom: var(--spacing-lg);
        }

        .form-label {
            display: block;
            margin-bottom: var(--spacing-sm);
            font-weight: 600;
            color: var(--text-dark);
            font-size: 1.1rem;
        }

        .form-input,
        .form-select,
        .form-textarea {
            width: 100%;
            padding: var(--spacing-md);
            border: 2px solid var(--border-color);
            border-radius: var(--border-radius-small);
            background: var(--background-white);
            color: var(--text-dark);
            font-size: 1.1rem;
            transition: all var(--transition-fast);
        }

        .form-input:focus,
        .form-select:focus,
        .form-textarea:focus {
            outline: none;
            border-color: var(--primary-green);
            box-shadow: 0 0 0 3px rgba(82, 183, 136, 0.1);
        }

        /* ===== Buttons ===== */
        .btn {
            padding: var(--spacing-md) var(--spacing-lg);
            border: none;
            border-radius: var(--border-radius-small);
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all var(--transition-fast);
            display: inline-flex;
            align-items: center;
            gap: var(--spacing-sm);
            position: relative;
            overflow: hidden;
        }

        .btn::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            background: rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            transform: translate(-50%, -50%);
            transition: width 0.6s, height 0.6s;
        }

        .btn:active::before {
            width: 300px;
            height: 300px;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--primary-green), var(--accent-green));
            color: white;
            box-shadow: 0 5px 15px rgba(82, 183, 136, 0.3);
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(82, 183, 136, 0.4);
        }

        .btn-secondary {
            background: var(--background-light);
            color: var(--text-dark);
            border: 2px solid var(--border-color);
        }

        .btn-secondary:hover {
            background: var(--border-color);
            border-color: var(--primary-green);
        }

        .btn-danger {
            background: var(--error-color);
            color: white;
        }

        .btn-danger:hover {
            background: #d62828;
            transform: translateY(-2px);
        }

        /* ===== Modal ===== */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.7);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 2000;
            opacity: 0;
            visibility: hidden;
            transition: all var(--transition-medium);
            padding: var(--spacing-md);
        }

        .modal.active {
            opacity: 1;
            visibility: visible;
        }

        .modal-content {
            background: var(--background-white);
            border-radius: var(--border-radius);
            padding: var(--spacing-xl);
            max-width: 600px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
            transform: scale(0.8);
            transition: transform var(--transition-medium);
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        }

        .modal.active .modal-content {
            transform: scale(1);
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: var(--spacing-lg);
        }

        .modal-close {
            background: none;
            border: none;
            font-size: 1.5rem;
            color: var(--text-medium);
            cursor: pointer;
            padding: var(--spacing-sm);
            border-radius: var(--border-radius-small);
            transition: all var(--transition-fast);
        }

        .modal-close:hover {
            background: var(--background-light);
            color: var(--error-color);
            transform: rotate(90deg);
        }

        /* ===== Inventory Grid ===== */
        .inventory-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: var(--spacing-lg);
            margin-top: var(--spacing-lg);
        }

        .inventory-item {
            background: var(--background-white);
            border: 2px solid var(--border-color);
            border-radius: var(--border-radius);
            padding: var(--spacing-md);
            transition: all var(--transition-fast);
            cursor: pointer;
            position: relative;
            overflow: hidden;
        }

        .inventory-item::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, transparent, rgba(82, 183, 136, 0.1));
            transform: translateX(-100%);
            transition: transform var(--transition-medium);
        }

        .inventory-item:hover {
            border-color: var(--primary-green);
            transform: translateY(-5px);
            box-shadow: 0 10px 25px var(--shadow-color);
        }

        .inventory-item:hover::before {
            transform: translateX(0);
        }

        .item-image {
            width: 100%;
            height: 150px;
            object-fit: cover;
            border-radius: var(--border-radius-small);
            margin-bottom: var(--spacing-md);
        }

        .item-name {
            font-weight: 600;
            color: var(--text-dark);
            margin-bottom: var(--spacing-sm);
            font-size: 1.2rem;
        }

        .item-id {
            font-size: 0.9rem;
            color: var(--text-medium);
            font-family: monospace;
        }

        .item-location {
            font-size: 1rem;
            color: var(--text-medium);
            display: flex;
            align-items: center;
            gap: var(--spacing-xs);
            margin-top: var(--spacing-sm);
        }

        .item-position {
            font-size: 0.9rem;
            color: var(--primary-green);
            font-style: italic;
        }

        /* ===== Progress Bars ===== */
        .progress-bar {
            width: 100%;
            height: 10px;
            background: var(--background-light);
            border-radius: 5px;
            overflow: hidden;
            margin-top: var(--spacing-xs);
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--primary-green), var(--accent-green));
            transition: width var(--transition-medium);
            position: relative;
            overflow: hidden;
        }

        .progress-fill::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            bottom: 0;
            right: 0;
            background: linear-gradient(
                90deg,
                transparent,
                rgba(255, 255, 255, 0.3),
                transparent
            );
            animation: shimmer 2s infinite;
        }

        @keyframes shimmer {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }

        /* ===== Voice Control ===== */
        .voice-section {
            background: var(--background-light);
            border-radius: var(--border-radius);
            padding: var(--spacing-xl);
            text-align: center;
        }

        .voice-input-area {
            margin: var(--spacing-xl) 0;
        }

        .voice-input {
            width: 100%;
            max-width: 600px;
            padding: var(--spacing-lg);
            font-size: 1.3rem;
            background: var(--background-white);
            border: 3px solid var(--primary-green);
            border-radius: var(--border-radius);
            color: var(--text-dark);
            text-align: center;
            margin: 0 auto var(--spacing-lg);
            display: block;
        }

        .voice-button {
            width: 150px;
            height: 150px;
            border-radius: 50%;
            border: none;
            background: linear-gradient(135deg, var(--primary-green), var(--accent-green));
            color: white;
            font-size: 4rem;
            cursor: pointer;
            transition: all var(--transition-fast);
            position: relative;
            box-shadow: 0 10px 30px rgba(82, 183, 136, 0.3);
            margin: 0 auto;
        }

        .voice-button:hover {
            transform: scale(1.05);
            box-shadow: 0 15px 40px rgba(82, 183, 136, 0.4);
        }

        .voice-button.listening {
            animation: pulse 1.5s ease infinite;
            background: linear-gradient(135deg, #e63946, #d62828);
        }

        .voice-result {
            margin-top: var(--spacing-xl);
            padding: var(--spacing-lg);
            background: var(--background-white);
            border-radius: var(--border-radius);
            font-size: 1.2rem;
            min-height: 100px;
            display: flex;
            align-items: center;
            justify-content: center;
            white-space: pre-wrap;
            line-height: 1.8;
        }

        /* ===== Room Planner Canvas ===== */
        .planner-container {
            position: relative;
            background: var(--background-light);
            border-radius: var(--border-radius);
            padding: var(--spacing-md);
        }

        .planner-toolbar {
            display: flex;
            gap: var(--spacing-sm);
            margin-bottom: var(--spacing-md);
            flex-wrap: wrap;
        }

        .planner-tool {
            padding: var(--spacing-sm) var(--spacing-md);
            background: var(--background-white);
            border: 2px solid var(--border-color);
            border-radius: var(--border-radius-small);
            cursor: pointer;
            transition: all var(--transition-fast);
            font-size: 1rem;
        }

        .planner-tool.active {
            background: var(--primary-green);
            color: white;
            border-color: var(--primary-green);
        }

        .planner-canvas {
            width: 100%;
            height: 500px;
            background: white;
            border: 2px solid var(--border-color);
            border-radius: var(--border-radius-small);
            cursor: crosshair;
            position: relative;
            overflow: hidden;
        }

        .room-object {
            position: absolute;
            background: var(--primary-light);
            border: 2px solid var(--primary-green);
            border-radius: 4px;
            padding: 4px 8px;
            font-size: 0.9rem;
            cursor: move;
            user-select: none;
            min-width: 80px;
            min-height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            text-align: center;
        }

        .room-object.selected {
            border-color: var(--error-color);
            box-shadow: 0 0 0 2px rgba(230, 57, 70, 0.3);
        }

        .resize-handle {
            position: absolute;
            width: 10px;
            height: 10px;
            background: var(--primary-dark);
            border-radius: 50%;
        }

        .resize-handle.nw { top: -5px; left: -5px; cursor: nw-resize; }
        .resize-handle.ne { top: -5px; right: -5px; cursor: ne-resize; }
        .resize-handle.sw { bottom: -5px; left: -5px; cursor: sw-resize; }
        .resize-handle.se { bottom: -5px; right: -5px; cursor: se-resize; }

        /* ===== Maintenance Section ===== */
        .maintenance-grid {
            display: grid;
            gap: var(--spacing-md);
        }

        .maintenance-card {
            background: var(--background-light);
            padding: var(--spacing-lg);
            border-radius: var(--border-radius);
            border-left: 4px solid var(--warning-color);
        }

        .maintenance-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: var(--spacing-md);
        }

        .maintenance-title {
            font-size: 1.2rem;
            font-weight: 600;
            color: var(--text-dark);
        }

        .maintenance-interval {
            display: flex;
            gap: var(--spacing-md);
            flex-wrap: wrap;
        }

        .interval-item {
            background: var(--background-white);
            padding: var(--spacing-sm) var(--spacing-md);
            border-radius: var(--border-radius-small);
            font-size: 0.9rem;
        }

        /* ===== Analytics Section ===== */
        .analytics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: var(--spacing-lg);
            margin-bottom: var(--spacing-xl);
        }

        .chart-container {
            background: var(--background-white);
            padding: var(--spacing-lg);
            border-radius: var(--border-radius);
            box-shadow: 0 5px 20px var(--shadow-color);
        }

        .chart-title {
            font-size: 1.3rem;
            font-weight: 600;
            color: var(--primary-dark);
            margin-bottom: var(--spacing-md);
        }

        .chart {
            width: 100%;
            height: 300px;
            position: relative;
        }

        /* ===== Filter Chips ===== */
        .filter-chips {
            display: flex;
            flex-wrap: wrap;
            gap: var(--spacing-sm);
            margin-top: var(--spacing-md);
        }

        .filter-chip {
            padding: var(--spacing-sm) var(--spacing-md);
            background: var(--background-light);
            border: 2px solid transparent;
            border-radius: 50px;
            font-size: 1rem;
            cursor: pointer;
            transition: all var(--transition-fast);
            display: flex;
            align-items: center;
            gap: var(--spacing-xs);
        }

        .filter-chip:hover {
            border-color: var(--primary-green);
            transform: translateY(-2px);
        }

        .filter-chip.active {
            background: var(--primary-green);
            color: white;
            border-color: var(--primary-green);
        }

        /* ===== Notifications ===== */
        .notification-container {
            position: fixed;
            top: calc(var(--header-height) + var(--spacing-lg));
            right: var(--spacing-lg);
            z-index: 3000;
            display: flex;
            flex-direction: column;
            gap: var(--spacing-md);
            max-width: 400px;
        }

        .notification {
            background: var(--background-white);
            border-radius: var(--border-radius-small);
            padding: var(--spacing-md) var(--spacing-lg);
            box-shadow: 0 5px 20px var(--shadow-color);
            display: flex;
            align-items: center;
            gap: var(--spacing-md);
            animation: slideInRight 0.5s ease;
            position: relative;
            overflow: hidden;
            font-size: 1.1rem;
        }

        @keyframes slideInRight {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        .notification::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 4px;
            height: 100%;
            background: var(--primary-green);
        }

        .notification.error::before {
            background: var(--error-color);
        }

        .notification.warning::before {
            background: var(--warning-color);
        }

        .notification.success::before {
            background: var(--success-color);
        }

        /* ===== Responsive Design - Mobile First ===== */
        @media (max-width: 768px) {
            :root {
                --header-height: 56px;
                --spacing-lg: 1rem;
                --spacing-xl: 1.5rem;
            }

            body {
                font-size: 1rem;
            }

            .burger-menu {
                display: block;
            }

            .sidebar {
                transform: translateX(-100%);
                width: 85%;
                max-width: 300px;
            }

            .sidebar.open {
                transform: translateX(0);
            }

            .sidebar-overlay.active {
                display: block;
            }

            .main-content {
                margin-left: 0;
                padding: var(--spacing-md);
            }

            .header-actions .btn-text {
                display: none;
            }

            .logo-text {
                display: none;
            }

            .dashboard-stats {
                grid-template-columns: 1fr;
            }

            .inventory-grid {
                grid-template-columns: 1fr;
            }

            .section-header {
                flex-direction: column;
                align-items: stretch;
            }

            .voice-button {
                width: 120px;
                height: 120px;
                font-size: 3rem;
            }

            .modal-content {
                margin: var(--spacing-md);
                padding: var(--spacing-lg);
            }

            .notification-container {
                left: var(--spacing-md);
                right: var(--spacing-md);
            }

            .analytics-grid {
                grid-template-columns: 1fr;
            }

            .form-row {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 480px) {
            .stat-value {
                font-size: 2rem;
            }

            .section-title {
                font-size: 1.5rem;
            }

            .planner-canvas {
                height: 400px;
            }
        }

        /* ===== Print Styles ===== */
        @media print {
            .header,
            .sidebar,
            .sidebar-overlay,
            .notification-container,
            .btn,
            .modal {
                display: none !important;
            }

            .main-content {
                margin: 0;
                padding: 0;
            }

            .content-section {
                box-shadow: none;
                border: 1px solid #ddd;
                page-break-inside: avoid;
            }
        }

        /* ===== Utility Classes ===== */
        .hidden {
            display: none !important;
        }

        .sr-only {
            position: absolute;
            width: 1px;
            height: 1px;
            padding: 0;
            margin: -1px;
            overflow: hidden;
            clip: rect(0, 0, 0, 0);
            white-space: nowrap;
            border: 0;
        }

        .text-center {
            text-align: center;
        }

        .mt-md {
            margin-top: var(--spacing-md);
        }

        .mb-md {
            margin-bottom: var(--spacing-md);
        }

        .flex {
            display: flex;
        }

        .flex-center {
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .gap-md {
            gap: var(--spacing-md);
        }

        /* ===== Skeleton Loading ===== */
        .skeleton {
            background: linear-gradient(90deg, var(--background-light) 25%, var(--border-color) 50%, var(--background-light) 75%);
            background-size: 200% 100%;
            animation: loading 1.5s infinite;
        }

        @keyframes loading {
            0% { background-position: 200% 0; }
            100% { background-position: -200% 0; }
        }
    </style>
</head>
<body>
    <!-- Loading Screen -->
    <div class="loading-screen" id="loadingScreen">
        <div class="loading-content">
            <div class="loading-spinner"></div>
            <h2>Inventartor</h2>
            <p>Wird geladen...</p>
        </div>
    </div>

    <!-- Header -->
    <header class="header">
        <div class="header-content">
            <div class="flex-center gap-md">
                <button class="burger-menu" id="burgerMenu" aria-label="Men√º √∂ffnen">
                    <span class="burger-line"></span>
                    <span class="burger-line"></span>
                    <span class="burger-line"></span>
                </button>
                <div class="logo">
                    <div class="logo-icon">üì¶</div>
                    <span class="logo-text">Inventartor</span>
                </div>
            </div>
            <div class="header-actions">
                <button class="theme-toggle" id="themeToggle" aria-label="Theme umschalten">üåì</button>
                <button class="btn btn-primary" id="quickAddBtn">
                    <span>‚ûï</span>
                    <span class="btn-text">Hinzuf√ºgen</span>
                </button>
            </div>
        </div>
    </header>

    <!-- Sidebar Overlay for Mobile -->
    <div class="sidebar-overlay" id="sidebarOverlay"></div>

    <!-- Main App Container -->
    <div class="app-container">
        <!-- Sidebar Navigation -->
        <nav class="sidebar" id="sidebar" role="navigation">
            <div class="nav-item active" data-section="dashboard" tabindex="0">
                <span class="nav-icon">üìä</span>
                <span class="nav-text">Dashboard</span>
            </div>
            <div class="nav-item" data-section="search" tabindex="0">
                <span class="nav-icon">üîç</span>
                <span class="nav-text">Suche & Filter</span>
            </div>
            <div class="nav-item" data-section="voice" tabindex="0">
                <span class="nav-icon">üé§</span>
                <span class="nav-text">Sprachsteuerung</span>
            </div>
            <div class="nav-item" data-section="inventory" tabindex="0">
                <span class="nav-icon">üì¶</span>
                <span class="nav-text">Inventar</span>
            </div>
            <div class="nav-item" data-section="add" tabindex="0">
                <span class="nav-icon">‚ûï</span>
                <span class="nav-text">Hinzuf√ºgen</span>
            </div>
            <div class="nav-item" data-section="planner" tabindex="0">
                <span class="nav-icon">üè†</span>
                <span class="nav-text">Grundriss</span>
            </div>
            <div class="nav-item" data-section="analytics" tabindex="0">
                <span class="nav-icon">üìà</span>
                <span class="nav-text">Analysen</span>
            </div>
            <div class="nav-item" data-section="maintenance" tabindex="0">
                <span class="nav-icon">üîß</span>
                <span class="nav-text">Wartung</span>
            </div>
            <div class="nav-item" data-section="settings" tabindex="0">
                <span class="nav-icon">‚öôÔ∏è</span>
                <span class="nav-text">Einstellungen</span>
            </div>
        </nav>

        <!-- Main Content Area -->
        <main class="main-content" id="mainContent">
            <!-- Dashboard Section -->
            <section class="content-section" id="dashboard-section">
                <div class="section-header">
                    <h1 class="section-title">Dashboard √úbersicht</h1>
                    <button class="btn btn-secondary" id="refreshDashboard">
                        <span>üîÑ</span>
                        <span>Aktualisieren</span>
                    </button>
                </div>

                <div class="dashboard-stats">
                    <div class="stat-card">
                        <div class="stat-icon">üì¶</div>
                        <div class="stat-value" id="totalItems">0</div>
                        <div class="stat-label">Gegenst√§nde gesamt</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">üè†</div>
                        <div class="stat-value" id="totalRooms">0</div>
                        <div class="stat-label">R√§ume</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">üìÅ</div>
                        <div class="stat-value" id="totalContainers">0</div>
                        <div class="stat-label">Container</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">‚ö†Ô∏è</div>
                        <div class="stat-value" id="lowStock">0</div>
                        <div class="stat-label">Wartung n√∂tig</div>
                    </div>
                </div>

                <div class="content-section mt-md">
                    <h2 class="section-title">Zuletzt hinzugef√ºgt</h2>
                    <div class="inventory-grid" id="recentItems">
                        <!-- Recent items will be populated here -->
                    </div>
                </div>
            </section>

            <!-- Voice Control Section -->
            <section class="content-section hidden" id="voice-section">
                <div class="section-header">
                    <h1 class="section-title">üé§ Sprachsteuerung</h1>
                </div>

                <div class="voice-section">
                    <p style="font-size: 1.2rem; margin-bottom: var(--spacing-lg);">
                        Geben Sie einen Gegenstand ein oder nutzen Sie die Spracherkennung
                    </p>

                    <div class="voice-input-area">
                        <input type="text"
                               id="voiceTextInput"
                               class="voice-input"
                               placeholder="Gegenstand eingeben..."
                               autocomplete="off"
                               aria-label="Gegenstand suchen">

                        <button class="voice-button" id="voiceButton" aria-label="Spracherkennung starten">
                            üé§
                        </button>
                    </div>

                    <div class="voice-result" id="voiceResult">
                        Hier erscheint das Ergebnis Ihrer Suche
                    </div>
                </div>

                <div class="content-section mt-md">
                    <h3>Unterst√ºtzte Befehle</h3>
                    <ul style="font-size: 1.1rem; line-height: 1.8;">
                        <li>Sagen Sie einfach den Namen eines Gegenstands</li>
                        <li>Die App zeigt und spricht den genauen Standort</li>
                        <li>Beispiel: "Hammer" ‚Üí "Dein Hammer liegt in: Werkstatt > Werkbank > Obere Schublade"</li>
                    </ul>
                </div>
            </section>

            <!-- Search Section -->
            <section class="content-section hidden" id="search-section">
                <div class="section-header">
                    <h1 class="section-title">Suche & Filter</h1>
                </div>

                <div class="search-container">
                    <input type="text"
                           class="form-input"
                           id="searchInput"
                           placeholder="Suche nach Namen, ID oder Eigenschaften..."
                           style="font-size: 1.2rem; padding: var(--spacing-lg);">
                </div>

                <div class="filter-chips">
                    <div class="filter-chip" data-filter="all">Alle</div>
                    <div class="filter-chip" data-filter="low-stock">üî¥ Fast leer</div>
                    <div class="filter-chip" data-filter="full">üü¢ Voll</div>
                    <div class="filter-chip" data-filter="poor-condition">‚ö†Ô∏è Schlechter Zustand</div>
                    <div class="filter-chip" data-filter="low-battery">üîã Batterie schwach</div>
                    <div class="filter-chip" data-filter="maintenance">üîß Wartung f√§llig</div>
                </div>

                <div class="mt-md">
                    <h3>Kategorien</h3>
                    <div class="filter-chips" id="categoryFilters">
                        <!-- Category filters will be populated here -->
                    </div>
                </div>

                <div class="inventory-grid mt-md" id="searchResults">
                    <!-- Search results will be populated here -->
                </div>
            </section>

            <!-- Add Item Section -->
            <section class="content-section hidden" id="add-section">
                <div class="section-header">
                    <h1 class="section-title">Neuen Gegenstand hinzuf√ºgen</h1>
                </div>

                <form id="addItemForm">
                    <div class="form-group">
                        <label class="form-label">Foto hinzuf√ºgen</label>
                        <input type="file" id="itemPhoto" accept="image/*" class="form-input">
                        <div id="photoPreview" class="mt-md"></div>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Gegenstand *</label>
                        <input type="text" id="itemName" class="form-input" required placeholder="z.B. Akkuschrauber">
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">Raum *</label>
                            <select id="itemRoom" class="form-select" required>
                                <option value="">Raum ausw√§hlen...</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label class="form-label">M√∂bel (optional)</label>
                            <input type="text" id="itemFurniture" class="form-input" placeholder="z.B. Werkbank">
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">Container (optional)</label>
                            <input type="text" id="itemContainer" class="form-input" placeholder="z.B. Obere Schublade">
                        </div>

                        <div class="form-group">
                            <label class="form-label">Position</label>
                            <select id="itemPosition" class="form-select">
                                <option value="darin">Darin</option>
                                <option value="oben drauf">Oben drauf</option>
                                <option value="unten drunter">Unten drunter</option>
                            </select>
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">Wartungsintervall (Tage)</label>
                            <input type="number" id="maintenanceInterval" class="form-input" min="1" placeholder="z.B. 30">
                        </div>

                        <div class="form-group">
                            <label class="form-label">Laufzeit (Stunden)</label>
                            <input type="number" id="runtime" class="form-input" min="0" step="0.1" placeholder="z.B. 150.5">
                        </div>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Kategorie</label>
                        <div class="filter-chips" id="categorySelection">
                            <!-- Categories will be populated here -->
                        </div>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Eigenschaften</label>
                        <div id="propertySliders">
                            <!-- Property sliders will be populated here -->
                        </div>
                        <button type="button" class="btn btn-secondary mt-md" id="addPropertyBtn">
                            ‚ûï Eigene Eigenschaft hinzuf√ºgen
                        </button>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Notizen</label>
                        <textarea id="itemNotes" class="form-textarea" rows="3" placeholder="Zus√§tzliche Informationen..."></textarea>
                    </div>

                    <div class="flex gap-md">
                        <button type="submit" class="btn btn-primary">
                            <span>üíæ</span>
                            <span>Speichern</span>
                        </button>
                        <button type="button" class="btn btn-secondary" id="resetFormBtn">
                            <span>üîÑ</span>
                            <span>Zur√ºcksetzen</span>
                        </button>
                    </div>
                </form>
            </section>

            <!-- Inventory Section -->
            <section class="content-section hidden" id="inventory-section">
                <div class="section-header">
                    <h1 class="section-title">Inventar √úbersicht</h1>
                    <div class="flex gap-md">
                        <button class="btn btn-secondary" id="toggleTreeView">
                            <span>üå≥</span>
                            <span>Alle auf-/zuklappen</span>
                        </button>
                        <button class="btn btn-primary" id="exportInventory">
                            <span>üì§</span>
                            <span>Exportieren</span>
                        </button>
                    </div>
                </div>

                <div id="inventoryTree">
                    <!-- Inventory tree will be populated here -->
                </div>
            </section>

            <!-- Room Planner Section -->
            <section class="content-section hidden" id="planner-section">
                <div class="section-header">
                    <h1 class="section-title">Grundriss Editor</h1>
                    <select id="roomSelect" class="form-select" style="width: 200px;">
                        <option value="">Raum ausw√§hlen...</option>
                    </select>
                </div>

                <div class="planner-container">
                    <div class="planner-toolbar">
                        <button class="planner-tool active" data-tool="select">üëÜ Ausw√§hlen</button>
                        <button class="planner-tool" data-tool="rectangle">‚¨ú Rechteck</button>
                        <button class="planner-tool" data-tool="delete">üóëÔ∏è L√∂schen</button>
                        <button class="planner-tool" data-tool="clear">üîÑ Alles l√∂schen</button>
                    </div>
                    <div class="planner-canvas" id="plannerCanvas">
                        <!-- Room objects will be added here -->
                    </div>
                </div>
            </section>

            <!-- Analytics Section -->
            <section class="content-section hidden" id="analytics-section">
                <div class="section-header">
                    <h1 class="section-title">Analysen & Berichte</h1>
                    <div class="flex gap-md">
                        <button class="btn btn-primary" id="generateReport">
                            <span>üìä</span>
                            <span>Bericht erstellen</span>
                        </button>
                        <button class="btn btn-secondary" id="exportAnalyticsJSON">
                            <span>üìÑ</span>
                            <span>JSON Export</span>
                        </button>
                        <button class="btn btn-secondary" id="exportAnalyticsCSV">
                            <span>üìä</span>
                            <span>Excel Export</span>
                        </button>
                    </div>
                </div>

                <div class="analytics-grid">
                    <div class="chart-container">
                        <h3 class="chart-title">Kategorieverteilung</h3>
                        <div class="chart" id="categoryChart"></div>
                    </div>
                    <div class="chart-container">
                        <h3 class="chart-title">Zustands√ºbersicht</h3>
                        <div class="chart" id="conditionChart"></div>
                    </div>
                    <div class="chart-container">
                        <h3 class="chart-title">F√ºllstandsanalyse</h3>
                        <div class="chart" id="fillLevelChart"></div>
                    </div>
                    <div class="chart-container">
                        <h3 class="chart-title">Raumauslastung</h3>
                        <div class="chart" id="roomUsageChart"></div>
                    </div>
                </div>

                <div class="content-section mt-md">
                    <h3>Detaillierte Statistiken</h3>
                    <div id="detailedStats">
                        <!-- Detailed statistics will be populated here -->
                    </div>
                </div>
            </section>

            <!-- Maintenance Section -->
            <section class="content-section hidden" id="maintenance-section">
                <div class="section-header">
                    <h1 class="section-title">Wartung & Erinnerungen</h1>
                    <button class="btn btn-primary" id="maintenanceSettings">
                        <span>‚öôÔ∏è</span>
                        <span>Einstellungen</span>
                    </button>
                </div>

                <div class="filter-chips mb-md">
                    <div class="filter-chip active" data-maintenance="all">Alle</div>
                    <div class="filter-chip" data-maintenance="interval">Zeitintervall</div>
                    <div class="filter-chip" data-maintenance="runtime">Laufzeit</div>
                    <div class="filter-chip" data-maintenance="fillLevel">F√ºllstand</div>
                    <div class="filter-chip" data-maintenance="battery">Batteriestand</div>
                    <div class="filter-chip" data-maintenance="condition">Zustand</div>
                </div>

                <div class="maintenance-grid" id="maintenanceItems">
                    <!-- Maintenance items will be populated here -->
                </div>
            </section>

            <!-- Settings Section -->
            <section class="content-section hidden" id="settings-section">
                <div class="section-header">
                    <h1 class="section-title">Einstellungen</h1>
                </div>

                <div class="settings-panel">
                    <div class="content-section">
                        <h3 class="section-title">Wartungsgrenzwerte</h3>

                        <div class="form-row">
                            <div class="form-group">
                                <label class="form-label">F√ºllstand Warnung unter (%)</label>
                                <input type="number" id="fillLevelThreshold" class="form-input" min="0" max="100" value="20">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Batteriestand Warnung unter (%)</label>
                                <input type="number" id="batteryThreshold" class="form-input" min="0" max="100" value="25">
                            </div>
                        </div>

                        <div class="form-row">
                            <div class="form-group">
                                <label class="form-label">Zustand Warnung unter (%)</label>
                                <input type="number" id="conditionThreshold" class="form-input" min="0" max="100" value="30">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Wartung X Tage vorher warnen</label>
                                <input type="number" id="maintenanceDaysBefore" class="form-input" min="1" value="7">
                            </div>
                        </div>
                    </div>

                    <div class="content-section">
                        <h3 class="section-title">Sprach-APIs</h3>

                        <div class="form-group">
                            <label class="form-label">Text-to-Speech Provider</label>
                            <select class="form-select" id="ttsProvider">
                                <option value="browser">Browser (Standard)</option>
                                <option value="google">Google Cloud TTS</option>
                                <option value="amazon">Amazon Polly</option>
                                <option value="azure">Azure Speech</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label class="form-label">Speech-to-Text Provider</label>
                            <select class="form-select" id="sttProvider">
                                <option value="browser">Browser (Standard)</option>
                                <option value="google">Google Cloud STT</option>
                                <option value="azure">Azure Speech</option>
                                <option value="whisper">OpenAI Whisper</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label class="form-label">Sprechgeschwindigkeit</label>
                            <input type="range" class="form-input" id="speechRate" min="0.5" max="2" step="0.1" value="1">
                            <div class="text-center mt-md">
                                <span id="speechRateValue">1.0</span>x
                            </div>
                        </div>
                    </div>

                    <div class="content-section">
                        <h3 class="section-title">Datenmanagement</h3>

                        <div class="form-group">
                            <label class="form-label">IDs anzeigen</label>
                            <label class="switch">
                                <input type="checkbox" id="showIDsToggle">
                                <span class="slider"></span>
                            </label>
                        </div>

                        <div class="form-group">
                            <label class="form-label">Daten exportieren</label>
                            <div class="flex gap-md">
                                <button class="btn btn-secondary" id="exportJSON">JSON</button>
                                <button class="btn btn-secondary" id="exportCSV">CSV (Excel)</button>
                            </div>
                        </div>

                        <div class="form-group">
                            <label class="form-label">Daten importieren</label>
                            <input type="file" class="form-input" id="importFile" accept=".json,.csv">
                        </div>

                        <div class="form-group">
                            <label class="form-label">Alle Daten l√∂schen</label>
                            <button class="btn btn-danger" id="clearAllData">üóëÔ∏è Alles l√∂schen</button>
                        </div>
                    </div>

                    <div class="content-section">
                        <h3 class="section-title">Kategorien & Eigenschaften</h3>

                        <div class="form-group">
                            <label class="form-label">Kategorien (eine pro Zeile)</label>
                            <textarea id="categoriesConfig" class="form-textarea" rows="8">üì± Elektronik
üîß Werkzeug
üëï Kleidung
üìö B√ºcher
üç¥ K√ºche
üéÆ Gaming
üè† Haushalt
üíä Medizin</textarea>
                        </div>

                        <div class="form-group">
                            <label class="form-label">Standard-Eigenschaften (eine pro Zeile)</label>
                            <textarea id="propertiesConfig" class="form-textarea" rows="5">F√ºllstand
Zustand
Batterie
Sauberkeit
Wichtigkeit</textarea>
                        </div>

                        <button class="btn btn-primary" id="saveConfig">
                            <span>üíæ</span>
                            <span>Konfiguration speichern</span>
                        </button>
                    </div>
                </div>
            </section>
        </main>
    </div>

    <!-- Modals -->
    <div class="modal" id="itemModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="modalTitle">Gegenstand Details</h3>
                <button class="modal-close" onclick="closeModal('itemModal')">‚úï</button>
            </div>
            <div id="modalContent">
                <!-- Modal content will be populated here -->
            </div>
        </div>
    </div>

    <div class="modal" id="maintenanceModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Wartungseinstellungen</h3>
                <button class="modal-close" onclick="closeModal('maintenanceModal')">‚úï</button>
            </div>
            <div id="maintenanceModalContent">
                <!-- Maintenance settings will be populated here -->
            </div>
        </div>
    </div>

    <!-- Notification Container -->
    <div class="notification-container" id="notificationContainer"></div>

    <!-- JavaScript -->
    <script>
        // ===== Smart Inventar Organizer Pro 2.0 - Enhanced JavaScript =====

        // App State Management
        const AppState = {
            inventory: [],
            rooms: [],
            categories: [],
            properties: [],
            roomPlans: {},
            nextId: 1001, // Start ID counter
            settings: {
                theme: 'light',
                autoSave: true,
                showIDs: false,
                speechRate: 1,
                speechVolume: 1,
                ttsProvider: 'browser',
                sttProvider: 'browser',
                // Wartungsgrenzwerte
                fillLevelThreshold: 20,
                batteryThreshold: 25,
                conditionThreshold: 30,
                maintenanceDaysBefore: 7
            },
            currentSection: 'dashboard',
            filters: {
                search: '',
                category: null,
                conditions: []
            }
        };

        // ===== Initialization =====
        document.addEventListener('DOMContentLoaded', async () => {
            await initializeApp();
            hideLoadingScreen();
        });

        async function initializeApp() {
            loadDataFromStorage();
            setupEventListeners();
            updateDashboard();
            renderCurrentSection();

            // Load default categories and properties if not set
            if (AppState.categories.length === 0) {
                AppState.categories = [
                    'üì± Elektronik',
                    'üîß Werkzeug',
                    'üëï Kleidung',
                    'üìö B√ºcher',
                    'üç¥ K√ºche',
                    'üéÆ Gaming',
                    'üè† Haushalt',
                    'üíä Medizin'
                ];
            }

            if (AppState.properties.length === 0) {
                AppState.properties = [
                    'F√ºllstand',
                    'Zustand',
                    'Batterie',
                    'Sauberkeit',
                    'Wichtigkeit'
                ];
            }

            // Apply theme
            document.documentElement.setAttribute('data-theme', AppState.settings.theme);

            // Initialize speech rate display
            document.getElementById('speechRateValue').textContent = AppState.settings.speechRate.toFixed(1);
        }

        function hideLoadingScreen() {
            const loadingScreen = document.getElementById('loadingScreen');
            loadingScreen.style.opacity = '0';
            setTimeout(() => {
                loadingScreen.style.display = 'none';
            }, 500);
        }

        // ===== Data Management =====
        function loadDataFromStorage() {
            try {
                const savedData = localStorage.getItem('inventarProData');
                if (savedData) {
                    const parsed = JSON.parse(savedData);
                    Object.assign(AppState, parsed);
                }
            } catch (error) {
                console.error('Error loading data:', error);
                showNotification('Fehler beim Laden der Daten', 'error');
            }
        }

        function saveDataToStorage() {
            try {
                localStorage.setItem('inventarProData', JSON.stringify(AppState));
                if (AppState.settings.autoSave) {
                    showNotification('Daten automatisch gespeichert', 'success');
                }
            } catch (error) {
                console.error('Error saving data:', error);
                showNotification('Fehler beim Speichern der Daten', 'error');
            }
        }

        // ===== Event Listeners Setup =====
        function setupEventListeners() {
            // Burger Menu
            document.getElementById('burgerMenu').addEventListener('click', toggleMobileMenu);
            document.getElementById('sidebarOverlay').addEventListener('click', closeMobileMenu);

            // Theme Toggle
            document.getElementById('themeToggle').addEventListener('click', toggleTheme);

            // Navigation
            document.querySelectorAll('.nav-item').forEach(item => {
                item.addEventListener('click', () => navigateToSection(item.dataset.section));
                // Keyboard navigation
                item.addEventListener('keypress', (e) => {
                    if (e.key === 'Enter' || e.key === ' ') {
                        navigateToSection(item.dataset.section);
                    }
                });
            });

            // Quick Add Button
            document.getElementById('quickAddBtn').addEventListener('click', () => {
                navigateToSection('add');
            });

            // Add Item Form
            document.getElementById('addItemForm').addEventListener('submit', handleAddItem);
            document.getElementById('itemPhoto').addEventListener('change', handlePhotoUpload);
            document.getElementById('resetFormBtn').addEventListener('click', resetAddForm);
            document.getElementById('addPropertyBtn').addEventListener('click', addCustomProperty);

            // Voice Control
            document.getElementById('voiceTextInput').addEventListener('input', (e) => {
                handleVoiceInput(e.target.value);
            });
            document.getElementById('voiceButton').addEventListener('click', startVoiceRecognition);

            // Search & Filters
            document.getElementById('searchInput').addEventListener('input', debounce(handleSearch, 300));

            // Settings
            document.getElementById('showIDsToggle').addEventListener('change', toggleShowIDs);
            document.getElementById('speechRate').addEventListener('input', updateSpeechRate);
            document.getElementById('ttsProvider').addEventListener('change', updateTTSProvider);
            document.getElementById('sttProvider').addEventListener('change', updateSTTProvider);
            document.getElementById('saveConfig').addEventListener('click', saveConfiguration);
            document.getElementById('exportJSON').addEventListener('click', exportJSON);
            document.getElementById('exportCSV').addEventListener('click', exportCSV);
            document.getElementById('importFile').addEventListener('change', handleImport);
            document.getElementById('clearAllData').addEventListener('click', clearAllData);

            // Room Planner
            initializeRoomPlanner();

            // Other buttons
            document.getElementById('refreshDashboard').addEventListener('click', updateDashboard);
            document.getElementById('toggleTreeView').addEventListener('click', toggleTreeView);
            document.getElementById('exportInventory').addEventListener('click', exportInventory);
            document.getElementById('generateReport').addEventListener('click', generateAnalyticsReport);
            document.getElementById('exportAnalyticsJSON').addEventListener('click', exportAnalyticsJSON);
            document.getElementById('exportAnalyticsCSV').addEventListener('click', exportAnalyticsCSV);
            document.getElementById('maintenanceSettings').addEventListener('click', openMaintenanceSettings);

            // Maintenance threshold inputs
            document.getElementById('fillLevelThreshold').addEventListener('change', updateMaintenanceThresholds);
            document.getElementById('batteryThreshold').addEventListener('change', updateMaintenanceThresholds);
            document.getElementById('conditionThreshold').addEventListener('change', updateMaintenanceThresholds);
            document.getElementById('maintenanceDaysBefore').addEventListener('change', updateMaintenanceThresholds);

            // Filter chips
            setupFilterChips();

            // Auto-save on window close
            window.addEventListener('beforeunload', () => {
                if (AppState.settings.autoSave) {
                    saveDataToStorage();
                }
            });
        }

        // ===== Mobile Menu =====
        function toggleMobileMenu() {
            const burger = document.getElementById('burgerMenu');
            const sidebar = document.getElementById('sidebar');
            const overlay = document.getElementById('sidebarOverlay');

            burger.classList.toggle('active');
            sidebar.classList.toggle('open');
            overlay.classList.toggle('active');
        }

        function closeMobileMenu() {
            const burger = document.getElementById('burgerMenu');
            const sidebar = document.getElementById('sidebar');
            const overlay = document.getElementById('sidebarOverlay');

            burger.classList.remove('active');
            sidebar.classList.remove('open');
            overlay.classList.remove('active');
        }

        // ===== Theme Management =====
        function toggleTheme() {
            const currentTheme = document.documentElement.getAttribute('data-theme');
            const newTheme = currentTheme === 'light' ? 'dark' : 'light';
            document.documentElement.setAttribute('data-theme', newTheme);
            AppState.settings.theme = newTheme;
            saveDataToStorage();
        }

        // ===== Navigation =====
        function navigateToSection(section) {
            // Update active nav item
            document.querySelectorAll('.nav-item').forEach(item => {
                item.classList.toggle('active', item.dataset.section === section);
            });

            // Hide all sections
            document.querySelectorAll('.content-section').forEach(sec => {
                sec.classList.add('hidden');
            });

            // Show selected section
            const sectionElement = document.getElementById(`${section}-section`);
            if (sectionElement) {
                sectionElement.classList.remove('hidden');
            }

            AppState.currentSection = section;

            // Section-specific initialization
            switch (section) {
                case 'dashboard':
                    updateDashboard();
                    break;
                case 'search':
                    initializeSearch();
                    break;
                case 'inventory':
                    renderInventoryTree();
                    break;
                case 'add':
                    initializeAddForm();
                    break;
                case 'planner':
                    initializePlanner();
                    break;
                case 'voice':
                    initializeVoiceControl();
                    break;
                case 'analytics':
                    renderAnalytics();
                    break;
                case 'maintenance':
                    renderMaintenance();
                    break;
                case 'settings':
                    renderSettings();
                    break;
            }

            // Close mobile menu if open
            closeMobileMenu();
        }

        function renderCurrentSection() {
            navigateToSection(AppState.currentSection);
        }

        // ===== Dashboard Functions =====
        function updateDashboard() {
            // Update statistics
            document.getElementById('totalItems').textContent = AppState.inventory.length;
            document.getElementById('totalRooms').textContent = new Set(AppState.inventory.map(item => item.room)).size;
            document.getElementById('totalContainers').textContent = new Set(AppState.inventory.map(item => `${item.room}-${item.furniture}-${item.container}`).filter(c => c !== '--')).size;

            // Calculate items needing maintenance
            const needsMaintenance = AppState.inventory.filter(item => {
                return checkMaintenanceNeeded(item);
            }).length;
            document.getElementById('lowStock').textContent = needsMaintenance;

            // Show recent items
            renderRecentItems();
        }

        function renderRecentItems() {
            const container = document.getElementById('recentItems');
            container.innerHTML = '';

            const recentItems = AppState.inventory.slice(-4).reverse();

            recentItems.forEach(item => {
                const itemCard = createInventoryCard(item);
                container.appendChild(itemCard);
            });
        }

        // ===== ID Generation (Short IDs from bottom up) =====
        function generateItemId() {
            const id = AppState.nextId++;
            saveDataToStorage(); // Save the updated counter
            return id.toString();
        }

        // ===== Voice Control (Simplified like the example) =====
        function initializeVoiceControl() {
            // Focus on input field for better accessibility
            document.getElementById('voiceTextInput').focus();
        }

        function handleVoiceInput(input) {
            const item = input.trim().toLowerCase();
            if (!item) {
                document.getElementById('voiceResult').textContent = 'Hier erscheint das Ergebnis Ihrer Suche';
                return;
            }

            const result = findItemByName(item);

            if (result) {
                const location = buildLocationString(result);
                const output = `Dein ${result.name} liegt ${result.position || 'darin'} in:\n${location}`;
                document.getElementById('voiceResult').textContent = output;
                speak(output);
            } else {
                const msg = `Ich habe "${input}" nicht gefunden.`;
                document.getElementById('voiceResult').textContent = msg;
                speak(msg);
            }
        }

        function findItemByName(searchTerm) {
            return AppState.inventory.find(item =>
                item.name.toLowerCase().includes(searchTerm)
            );
        }

        function buildLocationString(item) {
            let location = item.room;
            if (item.furniture) location += ` > ${item.furniture}`;
            if (item.container) location += ` > ${item.container}`;
            return location;
        }

        function speak(text) {
            if ('speechSynthesis' in window) {
                // Cancel any ongoing speech
                speechSynthesis.cancel();

                const utterance = new SpeechSynthesisUtterance(text);
                utterance.lang = 'de-DE';
                utterance.rate = AppState.settings.speechRate;
                utterance.volume = AppState.settings.speechVolume || 1;

                // Use selected voice provider (in real app, would switch based on provider)
                speechSynthesis.speak(utterance);
            } else {
                console.warn("Sprachsynthese wird von diesem Browser nicht unterst√ºtzt.");
            }
        }

        function startVoiceRecognition() {
            if (!('webkitSpeechRecognition' in window || 'SpeechRecognition' in window)) {
                alert("Spracherkennung wird von diesem Browser nicht unterst√ºtzt.");
                return;
            }

            const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
            const recognition = new SpeechRecognition();
            recognition.lang = 'de-DE';
            recognition.interimResults = false;
            recognition.maxAlternatives = 1;

            const button = document.getElementById('voiceButton');
            button.classList.add('listening');

            recognition.start();

            recognition.onresult = (event) => {
                const spoken = event.results[0][0].transcript.toLowerCase();
                document.getElementById('voiceTextInput').value = spoken;
                handleVoiceInput(spoken);
            };

            recognition.onerror = (event) => {
                console.error("SpeechRecognition Fehler:", event.error);
                button.classList.remove('listening');
                showNotification('Spracherkennung fehlgeschlagen: ' + event.error, 'error');
            };

            recognition.onend = () => {
                button.classList.remove('listening');
            };
        }

        // ===== Inventory Management =====
        function handleAddItem(e) {
            e.preventDefault();

            const formData = {
                id: generateItemId(),
                name: document.getElementById('itemName').value,
                room: document.getElementById('itemRoom').value,
                furniture: document.getElementById('itemFurniture').value || null,
                container: document.getElementById('itemContainer').value || null,
                position: document.getElementById('itemPosition').value,
                category: document.querySelector('.filter-chip.active[data-category]')?.dataset.category || 'Sonstiges',
                photo: document.getElementById('photoPreview').querySelector('img')?.src || null,
                notes: document.getElementById('itemNotes').value,
                maintenanceInterval: parseInt(document.getElementById('maintenanceInterval').value) || null,
                runtime: parseFloat(document.getElementById('runtime').value) || 0,
                totalRuntime: 0,
                lastMaintenance: new Date().toISOString(),
                properties: {},
                dateAdded: new Date().toISOString(),
                lastModified: new Date().toISOString()
            };

            // Collect property values
            document.querySelectorAll('.property-slider').forEach(slider => {
                const propertyName = slider.dataset.property;
                formData.properties[propertyName] = parseInt(slider.value);
            });

            // Add to inventory
            AppState.inventory.push(formData);

            // Save and notify
            saveDataToStorage();
            showNotification(`${formData.name} wurde hinzugef√ºgt!`, 'success');
            speak(`${formData.name} wurde erfolgreich hinzugef√ºgt`);

            // Reset form
            resetAddForm();

            // Update dashboard if visible
            if (AppState.currentSection === 'dashboard') {
                updateDashboard();
            }
        }

        function resetAddForm() {
            document.getElementById('addItemForm').reset();
            document.getElementById('photoPreview').innerHTML = '';
            document.querySelectorAll('.filter-chip.active').forEach(chip => {
                chip.classList.remove('active');
            });
            document.getElementById('itemPosition').value = 'darin';
        }

        function handlePhotoUpload(e) {
            const file = e.target.files[0];
            if (file && file.type.startsWith('image/')) {
                const reader = new FileReader();
                reader.onload = (event) => {
                    const preview = document.getElementById('photoPreview');
                    preview.innerHTML = `<img src="${event.target.result}" style="max-width: 200px; max-height: 200px; border-radius: 8px;">`;
                };
                reader.readAsDataURL(file);
            }
        }

        function createInventoryCard(item) {
            const card = document.createElement('div');
            card.className = 'inventory-item';
            card.onclick = () => showItemDetails(item);

            const photoHtml = item.photo
                ? `<img src="${item.photo}" alt="${item.name}" class="item-image">`
                : `<div class="item-image flex-center" style="background: var(--background-light); color: var(--text-medium); font-size: 3rem;">üì¶</div>`;

            const idHtml = AppState.settings.showIDs ? `<div class="item-id">ID: ${item.id}</div>` : '';

            const maintenanceIcon = checkMaintenanceNeeded(item) ? ' üîß' : '';

            const propertiesHtml = Object.entries(item.properties || {}).map(([key, value]) => {
                const percentage = value;
                const color = percentage < 30 ? 'var(--error-color)' : percentage < 70 ? 'var(--warning-color)' : 'var(--success-color)';
                return `
                    <div style="margin-top: 8px;">
                        <div style="display: flex; justify-content: space-between; font-size: 0.9rem; margin-bottom: 4px;">
                            <span>${key}</span>
                            <span style="color: ${color}; font-weight: 600;">${percentage}%</span>
                        </div>
                        <div class="progress-bar">
                            <div class="progress-fill" style="width: ${percentage}%; background: ${color};"></div>
                        </div>
                    </div>
                `;
            }).join('');

            card.innerHTML = `
                ${photoHtml}
                <div class="item-name">${item.name}${maintenanceIcon}</div>
                ${idHtml}
                <div class="item-location">
                    <span>üìç</span>
                    <span>${item.room}${item.furniture ? ' ‚Ä∫ ' + item.furniture : ''}${item.container ? ' ‚Ä∫ ' + item.container : ''}</span>
                </div>
                ${item.position && item.position !== 'darin' ? `<div class="item-position">(${item.position})</div>` : ''}
                <div class="property-badge" style="background: var(--primary-light); color: var(--primary-dark); margin-top: 8px;">
                    ${item.category}
                </div>
                ${propertiesHtml}
            `;

            return card;
        }

        function showItemDetails(item) {
            const modal = document.getElementById('itemModal');
            const modalTitle = document.getElementById('modalTitle');
            const modalContent = document.getElementById('modalContent');

            modalTitle.textContent = item.name;

            const photoHtml = item.photo
                ? `<img src="${item.photo}" alt="${item.name}" style="width: 100%; max-height: 300px; object-fit: cover; border-radius: 8px; margin-bottom: 20px;">`
                : '';

            const propertiesHtml = Object.entries(item.properties || {}).map(([key, value]) => {
                return `
                    <div class="form-group">
                        <label class="form-label">${key}: ${value}%</label>
                        <input type="range" class="form-input property-editor" data-property="${key}" value="${value}" min="0" max="100">
                        <div class="progress-bar mt-md">
                            <div class="progress-fill" style="width: ${value}%;"></div>
                        </div>
                    </div>
                `;
            }).join('');

            modalContent.innerHTML = `
                ${photoHtml}
                <div class="form-group">
                    <label class="form-label">ID</label>
                    <input type="text" class="form-input" value="${item.id}" readonly>
                </div>
                <div class="form-group">
                    <label class="form-label">Standort</label>
                    <input type="text" class="form-input" value="${item.room}${item.furniture ? ' ‚Ä∫ ' + item.furniture : ''}${item.container ? ' ‚Ä∫ ' + item.container : ''}" readonly>
                </div>
                <div class="form-group">
                    <label class="form-label">Position</label>
                    <input type="text" class="form-input" value="${item.position || 'darin'}" readonly>
                </div>
                <div class="form-group">
                    <label class="form-label">Kategorie</label>
                    <input type="text" class="form-input" value="${item.category}" readonly>
                </div>
                ${item.maintenanceInterval ? `
                    <div class="form-group">
                        <label class="form-label">Wartungsintervall</label>
                        <input type="text" class="form-input" value="${item.maintenanceInterval} Tage" readonly>
                    </div>
                ` : ''}
                ${item.runtime ? `
                    <div class="form-group">
                        <label class="form-label">Laufzeit</label>
                        <input type="text" class="form-input" value="${item.totalRuntime || 0} / ${item.runtime} Stunden" readonly>
                    </div>
                ` : ''}
                ${propertiesHtml}
                <div class="form-group">
                    <label class="form-label">Notizen</label>
                    <textarea class="form-textarea" rows="3">${item.notes || ''}</textarea>
                </div>
                <div class="form-group">
                    <label class="form-label">Hinzugef√ºgt am</label>
                    <input type="text" class="form-input" value="${new Date(item.dateAdded).toLocaleString('de-DE')}" readonly>
                </div>
                <div class="flex gap-md">
                    <button class="btn btn-primary" onclick="updateItem('${item.id}')">
                        <span>üíæ</span>
                        <span>Speichern</span>
                    </button>
                    <button class="btn btn-secondary" onclick="speakItemLocation('${item.id}')">
                        <span>üîä</span>
                        <span>Standort vorlesen</span>
                    </button>
                    <button class="btn btn-danger" onclick="deleteItem('${item.id}')">
                        <span>üóëÔ∏è</span>
                        <span>L√∂schen</span>
                    </button>
                </div>
            `;

            // Setup property sliders
            modalContent.querySelectorAll('.property-editor').forEach(slider => {
                slider.addEventListener('input', (e) => {
                    const fill = e.target.parentElement.querySelector('.progress-fill');
                    fill.style.width = e.target.value + '%';
                });
            });

            modal.classList.add('active');
        }

        function speakItemLocation(itemId) {
            const item = AppState.inventory.find(i => i.id === itemId);
            if (item) {
                const location = buildLocationString(item);
                const text = `${item.name} liegt ${item.position || 'darin'} in: ${location}`;
                speak(text);
            }
        }

        function updateItem(itemId) {
            const item = AppState.inventory.find(i => i.id === itemId);
            if (!item) return;

            // Update properties from modal
            document.querySelectorAll('.property-editor').forEach(slider => {
                const property = slider.dataset.property;
                item.properties[property] = parseInt(slider.value);
            });

            // Update notes
            const notesTextarea = document.querySelector('#modalContent textarea');
            if (notesTextarea) {
                item.notes = notesTextarea.value;
            }

            item.lastModified = new Date().toISOString();

            saveDataToStorage();
            showNotification('Gegenstand aktualisiert!', 'success');
            closeModal('itemModal');

            // Refresh current view
            renderCurrentSection();
        }

        function deleteItem(itemId) {
            if (confirm('M√∂chten Sie diesen Gegenstand wirklich l√∂schen?')) {
                AppState.inventory = AppState.inventory.filter(i => i.id !== itemId);
                saveDataToStorage();
                showNotification('Gegenstand gel√∂scht!', 'success');
                closeModal('itemModal');
                renderCurrentSection();
            }
        }

        // ===== Room Planner (Enhanced) =====
        let selectedObject = null;
        let currentTool = 'select';
        let isDragging = false;
        let isResizing = false;
        let dragOffset = { x: 0, y: 0 };
        let currentRoom = null;

        function initializeRoomPlanner() {
            // Tool buttons
            document.querySelectorAll('.planner-tool').forEach(tool => {
                tool.addEventListener('click', () => selectPlannerTool(tool.dataset.tool));
            });
        }

        function initializePlanner() {
            const roomSelect = document.getElementById('roomSelect');
            roomSelect.innerHTML = '<option value="">Raum ausw√§hlen...</option>';

            const rooms = [...new Set(AppState.inventory.map(item => item.room))];
            rooms.forEach(room => {
                const option = document.createElement('option');
                option.value = room;
                option.textContent = room;
                roomSelect.appendChild(option);
            });

            roomSelect.addEventListener('change', loadRoomPlan);
        }

        function selectPlannerTool(tool) {
            currentTool = tool;
            document.querySelectorAll('.planner-tool').forEach(t => {
                t.classList.toggle('active', t.dataset.tool === tool);
            });

            // Deselect object when switching tools
            if (selectedObject) {
                selectedObject.classList.remove('selected');
                selectedObject = null;
            }
        }

        function loadRoomPlan() {
            const roomSelect = document.getElementById('roomSelect');
            currentRoom = roomSelect.value;

            const canvas = document.getElementById('plannerCanvas');
            canvas.innerHTML = '';

            if (currentRoom && AppState.roomPlans[currentRoom]) {
                // Load saved room objects
                AppState.roomPlans[currentRoom].forEach(obj => {
                    createRoomObject(obj);
                });
            }

            // Canvas click handler
            canvas.onclick = (e) => {
                if (currentTool === 'rectangle' && e.target === canvas) {
                    const rect = canvas.getBoundingClientRect();
                    const x = e.clientX - rect.left;
                    const y = e.clientY - rect.top;

                    const name = prompt('Name des Objekts (z.B. TV-Tisch):');
                    if (name) {
                        const obj = {
                            id: Date.now(),
                            name: name,
                            x: x - 50,
                            y: y - 25,
                            width: 100,
                            height: 50
                        };
                        createRoomObject(obj);
                        saveRoomPlan();
                    }
                } else if (currentTool === 'clear') {
                    if (confirm('Wirklich alle Objekte l√∂schen?')) {
                        canvas.innerHTML = '';
                        if (currentRoom) {
                            AppState.roomPlans[currentRoom] = [];
                            saveDataToStorage();
                        }
                    }
                }
            };
        }

        function createRoomObject(obj) {
            const canvas = document.getElementById('plannerCanvas');
            const element = document.createElement('div');
            element.className = 'room-object';
            element.style.left = obj.x + 'px';
            element.style.top = obj.y + 'px';
            element.style.width = obj.width + 'px';
            element.style.height = obj.height + 'px';
            element.textContent = obj.name;
            element.dataset.id = obj.id;

            // Add resize handles
            ['nw', 'ne', 'sw', 'se'].forEach(handle => {
                const resizeHandle = document.createElement('div');
                resizeHandle.className = `resize-handle ${handle}`;
                element.appendChild(resizeHandle);
            });

            // Mouse events
            element.addEventListener('mousedown', startDrag);
            element.querySelectorAll('.resize-handle').forEach(handle => {
                handle.addEventListener('mousedown', startResize);
            });

            element.addEventListener('click', (e) => {
                e.stopPropagation();
                if (currentTool === 'select') {
                    selectObject(element);
                } else if (currentTool === 'delete') {
                    if (confirm(`"${obj.name}" l√∂schen?`)) {
                        element.remove();
                        saveRoomPlan();
                    }
                }
            });

            canvas.appendChild(element);
        }

        function selectObject(element) {
            if (selectedObject) {
                selectedObject.classList.remove('selected');
            }
            selectedObject = element;
            element.classList.add('selected');
        }

        function startDrag(e) {
            if (currentTool !== 'select' || e.target.classList.contains('resize-handle')) return;

            isDragging = true;
            const rect = e.target.getBoundingClientRect();
            const parentRect = e.target.parentElement.getBoundingClientRect();
            dragOffset.x = e.clientX - rect.left;
            dragOffset.y = e.clientY - rect.top;

            selectObject(e.target);

            document.addEventListener('mousemove', drag);
            document.addEventListener('mouseup', stopDrag);
        }

        function drag(e) {
            if (!isDragging || !selectedObject) return;

            const canvas = document.getElementById('plannerCanvas');
            const rect = canvas.getBoundingClientRect();

            const x = e.clientX - rect.left - dragOffset.x;
            const y = e.clientY - rect.top - dragOffset.y;

            selectedObject.style.left = Math.max(0, Math.min(x, rect.width - selectedObject.offsetWidth)) + 'px';
            selectedObject.style.top = Math.max(0, Math.min(y, rect.height - selectedObject.offsetHeight)) + 'px';
        }

        function stopDrag() {
            if (isDragging) {
                isDragging = false;
                saveRoomPlan();
            }
            document.removeEventListener('mousemove', drag);
            document.removeEventListener('mouseup', stopDrag);
        }

        function startResize(e) {
            e.stopPropagation();
            isResizing = true;
            const handle = e.target.className.split(' ')[1];
            const object = e.target.parentElement;
            selectObject(object);

            document.addEventListener('mousemove', (e) => resize(e, handle, object));
            document.addEventListener('mouseup', stopResize);
        }

        function resize(e, handle, object) {
            if (!isResizing) return;

            const canvas = document.getElementById('plannerCanvas');
            const canvasRect = canvas.getBoundingClientRect();
            const objRect = object.getBoundingClientRect();

            const x = e.clientX - canvasRect.left;
            const y = e.clientY - canvasRect.top;

            let newWidth = objRect.width;
            let newHeight = objRect.height;
            let newLeft = parseInt(object.style.left);
            let newTop = parseInt(object.style.top);

            switch (handle) {
                case 'se':
                    newWidth = x - newLeft;
                    newHeight = y - newTop;
                    break;
                case 'sw':
                    newWidth = newLeft + objRect.width - x;
                    newHeight = y - newTop;
                    newLeft = x;
                    break;
                case 'ne':
                    newWidth = x - newLeft;
                    newHeight = newTop + objRect.height - y;
                    newTop = y;
                    break;
                case 'nw':
                    newWidth = newLeft + objRect.width - x;
                    newHeight = newTop + objRect.height - y;
                    newLeft = x;
                    newTop = y;
                    break;
            }

            // Apply minimum size
            newWidth = Math.max(80, newWidth);
            newHeight = Math.max(40, newHeight);

            object.style.width = newWidth + 'px';
            object.style.height = newHeight + 'px';
            object.style.left = newLeft + 'px';
            object.style.top = newTop + 'px';
        }

        function stopResize() {
            if (isResizing) {
                isResizing = false;
                saveRoomPlan();
            }
            document.removeEventListener('mousemove', resize);
            document.removeEventListener('mouseup', stopResize);
        }

        function saveRoomPlan() {
            if (!currentRoom) return;

            const canvas = document.getElementById('plannerCanvas');
            const objects = [];

            canvas.querySelectorAll('.room-object').forEach(obj => {
                objects.push({
                    id: obj.dataset.id,
                    name: obj.textContent,
                    x: parseInt(obj.style.left),
                    y: parseInt(obj.style.top),
                    width: parseInt(obj.style.width),
                    height: parseInt(obj.style.height)
                });
            });

            AppState.roomPlans[currentRoom] = objects;
            saveDataToStorage();
        }

        // ===== Analytics Functions (Enhanced) =====
        function renderAnalytics() {
            renderCharts();
            renderDetailedStats();
        }

        function renderCharts() {
            // Category Distribution
            renderCategoryChart();

            // Condition Overview
            renderConditionChart();

            // Fill Level Analysis
            renderFillLevelChart();

            // Room Usage
            renderRoomUsageChart();
        }

        function renderCategoryChart() {
            const container = document.getElementById('categoryChart');
            container.innerHTML = '';

            const categoryCounts = {};
            AppState.inventory.forEach(item => {
                categoryCounts[item.category] = (categoryCounts[item.category] || 0) + 1;
            });

            const total = AppState.inventory.length || 1;
            const maxCount = Math.max(...Object.values(categoryCounts), 1);

            Object.entries(categoryCounts).forEach(([category, count]) => {
                const percentage = (count / total * 100).toFixed(1);
                const barHeight = (count / maxCount * 250);

                const bar = document.createElement('div');
                bar.style.cssText = `
                    display: inline-block;
                    width: 60px;
                    margin: 0 10px;
                    text-align: center;
                    vertical-align: bottom;
                `;
                bar.innerHTML = `
                    <div style="font-size: 0.9rem; margin-bottom: 5px;">${count}</div>
                    <div style="
                        height: ${barHeight}px;
                        background: linear-gradient(to top, var(--primary-green), var(--accent-green));
                        border-radius: 4px 4px 0 0;
                        position: relative;
                        margin-bottom: 5px;
                        min-height: 20px;
                        display: flex;
                        align-items: flex-end;
                        justify-content: center;
                        color: white;
                        font-weight: bold;
                    ">
                        ${percentage}%
                    </div>
                    <div style="font-size: 0.8rem; word-break: break-all;">${category}</div>
                `;
                container.appendChild(bar);
            });
        }

        function renderConditionChart() {
            const container = document.getElementById('conditionChart');
            container.innerHTML = '';

            const conditions = {
                'Sehr gut (80-100%)': 0,
                'Gut (60-79%)': 0,
                'Mittel (40-59%)': 0,
                'Schlecht (20-39%)': 0,
                'Sehr schlecht (0-19%)': 0
            };

            AppState.inventory.forEach(item => {
                const condition = item.properties?.['Zustand'] || 100;
                if (condition >= 80) conditions['Sehr gut (80-100%)']++;
                else if (condition >= 60) conditions['Gut (60-79%)']++;
                else if (condition >= 40) conditions['Mittel (40-59%)']++;
                else if (condition >= 20) conditions['Schlecht (20-39%)']++;
                else conditions['Sehr schlecht (0-19%)']++;
            });

            const total = AppState.inventory.length || 1;

            Object.entries(conditions).forEach(([label, count]) => {
                const percentage = (count / total * 100).toFixed(1);
                const row = document.createElement('div');
                row.style.marginBottom = '15px';
                row.innerHTML = `
                    <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
                        <span>${label}</span>
                        <span>${count} (${percentage}%)</span>
                    </div>
                    <div class="progress-bar" style="height: 20px;">
                        <div class="progress-fill" style="width: ${percentage}%;">
                            ${count > 0 ? count : ''}
                        </div>
                    </div>
                `;
                container.appendChild(row);
            });
        }

        function renderFillLevelChart() {
            const container = document.getElementById('fillLevelChart');
            container.innerHTML = '';

            const fillLevels = {
                'Voll (80-100%)': 0,
                'Hoch (60-79%)': 0,
                'Mittel (40-59%)': 0,
                'Niedrig (20-39%)': 0,
                'Leer (0-19%)': 0
            };

            AppState.inventory.forEach(item => {
                const fill = item.properties?.['F√ºllstand'];
                if (fill !== undefined) {
                    if (fill >= 80) fillLevels['Voll (80-100%)']++;
                    else if (fill >= 60) fillLevels['Hoch (60-79%)']++;
                    else if (fill >= 40) fillLevels['Mittel (40-59%)']++;
                    else if (fill >= 20) fillLevels['Niedrig (20-39%)']++;
                    else fillLevels['Leer (0-19%)']++;
                }
            });

            const total = Object.values(fillLevels).reduce((a, b) => a + b, 0) || 1;

            // Create pie chart representation
            let currentAngle = 0;
            const centerX = 150;
            const centerY = 150;
            const radius = 120;

            const svg = document.createElementNS('http://www.w3.org/2000/svg', 'svg');
            svg.setAttribute('width', '300');
            svg.setAttribute('height', '300');

            const colors = ['#06ffa5', '#52b788', '#f77f00', '#e63946', '#d62828'];

            Object.entries(fillLevels).forEach(([label, count], index) => {
                if (count === 0) return;

                const percentage = count / total;
                const angle = percentage * 2 * Math.PI;

                const x1 = centerX + radius * Math.cos(currentAngle);
                const y1 = centerY + radius * Math.sin(currentAngle);
                const x2 = centerX + radius * Math.cos(currentAngle + angle);
                const y2 = centerY + radius * Math.sin(currentAngle + angle);

                const largeArcFlag = angle > Math.PI ? 1 : 0;

                const path = document.createElementNS('http://www.w3.org/2000/svg', 'path');
                path.setAttribute('d', `
                    M ${centerX} ${centerY}
                    L ${x1} ${y1}
                    A ${radius} ${radius} 0 ${largeArcFlag} 1 ${x2} ${y2}
                    Z
                `);
                path.setAttribute('fill', colors[index]);
                path.setAttribute('stroke', 'white');
                path.setAttribute('stroke-width', '2');

                svg.appendChild(path);

                // Add label
                const labelAngle = currentAngle + angle / 2;
                const labelX = centerX + (radius * 0.7) * Math.cos(labelAngle);
                const labelY = centerY + (radius * 0.7) * Math.sin(labelAngle);

                if (percentage > 0.05) {
                    const text = document.createElementNS('http://www.w3.org/2000/svg', 'text');
                    text.setAttribute('x', labelX);
                    text.setAttribute('y', labelY);
                    text.setAttribute('text-anchor', 'middle');
                    text.setAttribute('fill', 'white');
                    text.setAttribute('font-weight', 'bold');
                    text.textContent = `${(percentage * 100).toFixed(0)}%`;
                    svg.appendChild(text);
                }

                currentAngle += angle;
            });

            container.appendChild(svg);

            // Add legend
            const legend = document.createElement('div');
            legend.style.marginTop = '20px';
            Object.entries(fillLevels).forEach(([label, count], index) => {
                const item = document.createElement('div');
                item.style.cssText = 'display: flex; align-items: center; margin: 5px 0;';
                item.innerHTML = `
                    <div style="width: 20px; height: 20px; background: ${colors[index]}; margin-right: 10px; border-radius: 3px;"></div>
                    <span>${label}: ${count}</span>
                `;
                legend.appendChild(item);
            });
            container.appendChild(legend);
        }

        function renderRoomUsageChart() {
            const container = document.getElementById('roomUsageChart');
            container.innerHTML = '';

            const roomCounts = {};
            AppState.inventory.forEach(item => {
                roomCounts[item.room] = (roomCounts[item.room] || 0) + 1;
            });

            const sorted = Object.entries(roomCounts).sort((a, b) => b[1] - a[1]);
            const maxCount = sorted[0]?.[1] || 1;

            sorted.forEach(([room, count]) => {
                const percentage = (count / maxCount * 100);
                const row = document.createElement('div');
                row.style.marginBottom = '15px';
                row.innerHTML = `
                    <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
                        <span style="font-weight: 600;">${room}</span>
                        <span>${count} Gegenst√§nde</span>
                    </div>
                    <div class="progress-bar" style="height: 25px;">
                        <div class="progress-fill" style="width: ${percentage}%; font-size: 0.9rem; display: flex; align-items: center; padding: 0 10px;">
                            ${count}
                        </div>
                    </div>
                `;
                container.appendChild(row);
            });
        }

        function renderDetailedStats() {
            const container = document.getElementById('detailedStats');
            container.innerHTML = '';

            const stats = calculateDetailedStats();

            const statsHtml = `
                <div class="analytics-grid">
                    <div class="stat-card">
                        <div class="stat-icon">üìä</div>
                        <div class="stat-value">${stats.totalValue}‚Ç¨</div>
                        <div class="stat-label">Gesch√§tzter Gesamtwert</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">üìà</div>
                        <div class="stat-value">${stats.avgFillLevel}%</div>
                        <div class="stat-label">Durchschn. F√ºllstand</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">‚ö°</div>
                        <div class="stat-value">${stats.avgCondition}%</div>
                        <div class="stat-label">Durchschn. Zustand</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">üîã</div>
                        <div class="stat-value">${stats.avgBattery}%</div>
                        <div class="stat-label">Durchschn. Batteriestand</div>
                    </div>
                </div>

                <div class="content-section mt-md">
                    <h3>Top 5 R√§ume nach Gegenst√§nden</h3>
                    <ol style="font-size: 1.1rem; line-height: 1.8;">
                        ${stats.topRooms.map(([room, count]) => `<li>${room}: ${count} Gegenst√§nde</li>`).join('')}
                    </ol>
                </div>

                <div class="content-section mt-md">
                    <h3>Wartungsbedarf</h3>
                    <ul style="font-size: 1.1rem; line-height: 1.8;">
                        <li>${stats.maintenanceNeeded} Gegenst√§nde ben√∂tigen Wartung</li>
                        <li>${stats.lowStock} Gegenst√§nde haben niedrigen F√ºllstand</li>
                        <li>${stats.lowBattery} Gegenst√§nde haben niedrigen Batteriestand</li>
                        <li>${stats.poorCondition} Gegenst√§nde sind in schlechtem Zustand</li>
                    </ul>
                </div>
            `;

            container.innerHTML = statsHtml;
        }

        function calculateDetailedStats() {
            const stats = {
                totalValue: 0,
                avgFillLevel: 0,
                avgCondition: 0,
                avgBattery: 0,
                topRooms: [],
                maintenanceNeeded: 0,
                lowStock: 0,
                lowBattery: 0,
                poorCondition: 0
            };

            // Calculate averages
            let fillCount = 0, conditionCount = 0, batteryCount = 0;
            let fillSum = 0, conditionSum = 0, batterySum = 0;

            AppState.inventory.forEach(item => {
                // Check maintenance
                if (checkMaintenanceNeeded(item)) stats.maintenanceNeeded++;

                // Property averages
                if (item.properties?.['F√ºllstand'] !== undefined) {
                    fillSum += item.properties['F√ºllstand'];
                    fillCount++;
                    if (item.properties['F√ºllstand'] < AppState.settings.fillLevelThreshold) {
                        stats.lowStock++;
                    }
                }

                if (item.properties?.['Zustand'] !== undefined) {
                    conditionSum += item.properties['Zustand'];
                    conditionCount++;
                    if (item.properties['Zustand'] < AppState.settings.conditionThreshold) {
                        stats.poorCondition++;
                    }
                }

                if (item.properties?.['Batterie'] !== undefined) {
                    batterySum += item.properties['Batterie'];
                    batteryCount++;
                    if (item.properties['Batterie'] < AppState.settings.batteryThreshold) {
                        stats.lowBattery++;
                    }
                }
            });

            stats.avgFillLevel = fillCount > 0 ? Math.round(fillSum / fillCount) : 0;
            stats.avgCondition = conditionCount > 0 ? Math.round(conditionSum / conditionCount) : 0;
            stats.avgBattery = batteryCount > 0 ? Math.round(batterySum / batteryCount) : 0;

            // Top rooms
            const roomCounts = {};
            AppState.inventory.forEach(item => {
                roomCounts[item.room] = (roomCounts[item.room] || 0) + 1;
            });
            stats.topRooms = Object.entries(roomCounts)
                .sort((a, b) => b[1] - a[1])
                .slice(0, 5);

            // Estimate total value (placeholder calculation)
            stats.totalValue = AppState.inventory.length * 50;

            return stats;
        }

        function generateAnalyticsReport() {
            const stats = calculateDetailedStats();
            const report = {
                generatedAt: new Date().toISOString(),
                summary: {
                    totalItems: AppState.inventory.length,
                    totalRooms: new Set(AppState.inventory.map(item => item.room)).size,
                    estimatedValue: stats.totalValue,
                    maintenanceNeeded: stats.maintenanceNeeded
                },
                averages: {
                    fillLevel: stats.avgFillLevel,
                    condition: stats.avgCondition,
                    battery: stats.avgBattery
                },
                distribution: {
                    byCategory: {},
                    byRoom: {},
                    byCondition: {
                        excellent: 0,
                        good: 0,
                        fair: 0,
                        poor: 0,
                        critical: 0
                    }
                },
                maintenanceReport: {
                    immediate: [],
                    upcoming: [],
                    overdue: []
                },
                inventory: AppState.inventory
            };

            // Fill distribution data
            AppState.inventory.forEach(item => {
                // By category
                report.distribution.byCategory[item.category] = (report.distribution.byCategory[item.category] || 0) + 1;

                // By room
                report.distribution.byRoom[item.room] = (report.distribution.byRoom[item.room] || 0) + 1;

                // By condition
                const condition = item.properties?.['Zustand'] || 100;
                if (condition >= 80) report.distribution.byCondition.excellent++;
                else if (condition >= 60) report.distribution.byCondition.good++;
                else if (condition >= 40) report.distribution.byCondition.fair++;
                else if (condition >= 20) report.distribution.byCondition.poor++;
                else report.distribution.byCondition.critical++;

                // Maintenance status
                const maintenanceStatus = getMaintenanceStatus(item);
                if (maintenanceStatus.overdue) {
                    report.maintenanceReport.overdue.push({
                        id: item.id,
                        name: item.name,
                        location: buildLocationString(item),
                        reason: maintenanceStatus.reason
                    });
                } else if (maintenanceStatus.upcoming) {
                    report.maintenanceReport.upcoming.push({
                        id: item.id,
                        name: item.name,
                        location: buildLocationString(item),
                        daysUntil: maintenanceStatus.daysUntil
                    });
                } else if (maintenanceStatus.immediate) {
                    report.maintenanceReport.immediate.push({
                        id: item.id,
                        name: item.name,
                        location: buildLocationString(item),
                        issues: maintenanceStatus.issues
                    });
                }
            });

            showNotification('Umfassender Bericht wurde erstellt!', 'success');
            return report;
        }

        function exportAnalyticsJSON() {
            const report = generateAnalyticsReport();
            const data = JSON.stringify(report, null, 2);
            const blob = new Blob([data], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `inventar-analyse-${new Date().toISOString().split('T')[0]}.json`;
            a.click();
            URL.revokeObjectURL(url);
        }

        function exportAnalyticsCSV() {
            const report = generateAnalyticsReport();

            // Create multiple CSV sections
            let csv = 'INVENTAR ANALYSE BERICHT\n';
            csv += `Erstellt am:,${new Date().toLocaleString('de-DE')}\n\n`;

            csv += 'ZUSAMMENFASSUNG\n';
            csv += 'Metrik,Wert\n';
            csv += `Gegenst√§nde gesamt,${report.summary.totalItems}\n`;
            csv += `R√§ume gesamt,${report.summary.totalRooms}\n`;
            csv += `Gesch√§tzter Wert,${report.summary.estimatedValue}‚Ç¨\n`;
            csv += `Wartung ben√∂tigt,${report.summary.maintenanceNeeded}\n\n`;

            csv += 'DURCHSCHNITTSWERTE\n';
            csv += 'Eigenschaft,Durchschnitt %\n';
            csv += `F√ºllstand,${report.averages.fillLevel}\n`;
            csv += `Zustand,${report.averages.condition}\n`;
            csv += `Batterie,${report.averages.battery}\n\n`;

            csv += 'VERTEILUNG NACH KATEGORIE\n';
            csv += 'Kategorie,Anzahl\n';
            Object.entries(report.distribution.byCategory).forEach(([cat, count]) => {
                csv += `${cat},${count}\n`;
            });
            csv += '\n';

            csv += 'VERTEILUNG NACH RAUM\n';
            csv += 'Raum,Anzahl\n';
            Object.entries(report.distribution.byRoom).forEach(([room, count]) => {
                csv += `${room},${count}\n`;
            });
            csv += '\n';

            csv += 'WARTUNGSBERICHT\n';
            csv += 'Status,ID,Name,Standort,Details\n';
            report.maintenanceReport.overdue.forEach(item => {
                csv += `√úberf√§llig,${item.id},${item.name},"${item.location}","${item.reason}"\n`;
            });
            report.maintenanceReport.upcoming.forEach(item => {
                csv += `Anstehend,${item.id},${item.name},"${item.location}","In ${item.daysUntil} Tagen"\n`;
            });
            report.maintenanceReport.immediate.forEach(item => {
                csv += `Sofort,${item.id},${item.name},"${item.location}","${item.issues.join(', ')}"\n`;
            });

            // Add BOM for Excel UTF-8 compatibility
            const BOM = '\uFEFF';
            const blob = new Blob([BOM + csv], { type: 'text/csv;charset=utf-8;' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `inventar-analyse-${new Date().toISOString().split('T')[0]}.csv`;
            a.click();
            URL.revokeObjectURL(url);
        }

        // ===== Maintenance Functions (Enhanced) =====
        function renderMaintenance() {
            const container = document.getElementById('maintenanceItems');
            container.innerHTML = '';

            const maintenanceItems = getMaintenanceItems();

            if (maintenanceItems.length === 0) {
                container.innerHTML = '<p style="text-align: center; color: var(--text-medium); font-size: 1.1rem;">Keine Wartung erforderlich</p>';
                return;
            }

            maintenanceItems.forEach(item => {
                const card = document.createElement('div');
                card.className = 'maintenance-card';

                const status = getMaintenanceStatus(item);
                const urgencyColor = status.overdue ? 'var(--error-color)' :
                                   status.upcoming ? 'var(--warning-color)' :
                                   'var(--info-color)';

                card.innerHTML = `
                    <div class="maintenance-header">
                        <h3 class="maintenance-title">${item.name}</h3>
                        <span style="color: ${urgencyColor}; font-weight: 600;">
                            ${status.overdue ? '‚ö†Ô∏è √úberf√§llig' : status.upcoming ? '‚è∞ Anstehend' : 'üîß Wartung n√∂tig'}
                        </span>
                    </div>
                    <p style="color: var(--text-medium); margin-bottom: 16px;">
                        üìç ${buildLocationString(item)}
                    </p>
                    <div class="maintenance-interval">
                        ${status.details.map(detail => `
                            <div class="interval-item">
                                <strong>${detail.type}:</strong> ${detail.message}
                            </div>
                        `).join('')}
                    </div>
                    <button class="btn btn-primary mt-md" onclick="showItemDetails(AppState.inventory.find(i => i.id === '${item.id}'))">
                        Details anzeigen
                    </button>
                `;

                container.appendChild(card);
            });
        }

        function getMaintenanceItems() {
            const activeFilter = document.querySelector('.filter-chip.active[data-maintenance]')?.dataset.maintenance || 'all';

            return AppState.inventory.filter(item => {
                const status = getMaintenanceStatus(item);

                if (activeFilter === 'all') {
                    return status.needsMaintenance;
                } else if (activeFilter === 'interval' && item.maintenanceInterval) {
                    return status.details.some(d => d.type === 'Zeitintervall');
                } else if (activeFilter === 'runtime' && item.runtime) {
                    return status.details.some(d => d.type === 'Laufzeit');
                } else if (activeFilter === 'fillLevel') {
                    return status.details.some(d => d.type === 'F√ºllstand');
                } else if (activeFilter === 'battery') {
                    return status.details.some(d => d.type === 'Batteriestand');
                } else if (activeFilter === 'condition') {
                    return status.details.some(d => d.type === 'Zustand');
                }

                return false;
            });
        }

        function getMaintenanceStatus(item) {
            const status = {
                needsMaintenance: false,
                overdue: false,
                upcoming: false,
                immediate: false,
                details: [],
                issues: [],
                reason: '',
                daysUntil: null
            };

            // Check time interval
            if (item.maintenanceInterval && item.lastMaintenance) {
                const lastMaintenance = new Date(item.lastMaintenance);
                const now = new Date();
                const daysSince = Math.floor((now - lastMaintenance) / (1000 * 60 * 60 * 24));
                const daysUntil = item.maintenanceInterval - daysSince;

                if (daysSince >= item.maintenanceInterval) {
                    status.overdue = true;
                    status.needsMaintenance = true;
                    status.reason = `Wartung ${daysSince - item.maintenanceInterval} Tage √ºberf√§llig`;
                    status.details.push({
                        type: 'Zeitintervall',
                        message: status.reason
                    });
                } else if (daysUntil <= AppState.settings.maintenanceDaysBefore) {
                    status.upcoming = true;
                    status.needsMaintenance = true;
                    status.daysUntil = daysUntil;
                    status.details.push({
                        type: 'Zeitintervall',
                        message: `Wartung in ${daysUntil} Tagen f√§llig`
                    });
                }
            }

            // Check runtime
            if (item.runtime && item.totalRuntime >= item.runtime) {
                status.overdue = true;
                status.needsMaintenance = true;
                status.details.push({
                    type: 'Laufzeit',
                    message: `${item.totalRuntime} von ${item.runtime} Stunden erreicht`
                });
            }

            // Check properties
            if (item.properties) {
                if (item.properties['F√ºllstand'] < AppState.settings.fillLevelThreshold) {
                    status.immediate = true;
                    status.needsMaintenance = true;
                    status.issues.push('Niedriger F√ºllstand');
                    status.details.push({
                        type: 'F√ºllstand',
                        message: `Nur ${item.properties['F√ºllstand']}% (Grenzwert: ${AppState.settings.fillLevelThreshold}%)`
                    });
                }

                if (item.properties['Batterie'] < AppState.settings.batteryThreshold) {
                    status.immediate = true;
                    status.needsMaintenance = true;
                    status.issues.push('Niedrige Batterie');
                    status.details.push({
                        type: 'Batteriestand',
                        message: `Nur ${item.properties['Batterie']}% (Grenzwert: ${AppState.settings.batteryThreshold}%)`
                    });
                }

                if (item.properties['Zustand'] < AppState.settings.conditionThreshold) {
                    status.immediate = true;
                    status.needsMaintenance = true;
                    status.issues.push('Schlechter Zustand');
                    status.details.push({
                        type: 'Zustand',
                        message: `Nur ${item.properties['Zustand']}% (Grenzwert: ${AppState.settings.conditionThreshold}%)`
                    });
                }
            }

            return status;
        }

        function checkMaintenanceNeeded(item) {
            return getMaintenanceStatus(item).needsMaintenance;
        }

        function openMaintenanceSettings() {
            const modal = document.getElementById('maintenanceModal');
            const content = document.getElementById('maintenanceModalContent');

            content.innerHTML = `
                <div class="form-group">
                    <label class="form-label">F√ºllstand Warnung unter (%)</label>
                    <input type="number" id="modalFillThreshold" class="form-input"
                           min="0" max="100" value="${AppState.settings.fillLevelThreshold}">
                </div>
                <div class="form-group">
                    <label class="form-label">Batteriestand Warnung unter (%)</label>
                    <input type="number" id="modalBatteryThreshold" class="form-input"
                           min="0" max="100" value="${AppState.settings.batteryThreshold}">
                </div>
                <div class="form-group">
                    <label class="form-label">Zustand Warnung unter (%)</label>
                    <input type="number" id="modalConditionThreshold" class="form-input"
                           min="0" max="100" value="${AppState.settings.conditionThreshold}">
                </div>
                <div class="form-group">
                    <label class="form-label">Wartung X Tage vorher warnen</label>
                    <input type="number" id="modalMaintenanceDays" class="form-input"
                           min="1" value="${AppState.settings.maintenanceDaysBefore}">
                </div>
                <button class="btn btn-primary" onclick="saveMaintenanceSettings()">
                    Einstellungen speichern
                </button>
            `;

            modal.classList.add('active');
        }

        function saveMaintenanceSettings() {
            AppState.settings.fillLevelThreshold = parseInt(document.getElementById('modalFillThreshold').value);
            AppState.settings.batteryThreshold = parseInt(document.getElementById('modalBatteryThreshold').value);
            AppState.settings.conditionThreshold = parseInt(document.getElementById('modalConditionThreshold').value);
            AppState.settings.maintenanceDaysBefore = parseInt(document.getElementById('modalMaintenanceDays').value);

            // Update main settings too
            document.getElementById('fillLevelThreshold').value = AppState.settings.fillLevelThreshold;
            document.getElementById('batteryThreshold').value = AppState.settings.batteryThreshold;
            document.getElementById('conditionThreshold').value = AppState.settings.conditionThreshold;
            document.getElementById('maintenanceDaysBefore').value = AppState.settings.maintenanceDaysBefore;

            saveDataToStorage();
            showNotification('Wartungseinstellungen gespeichert!', 'success');
            closeModal('maintenanceModal');
            renderMaintenance();
        }

        function updateMaintenanceThresholds() {
            AppState.settings.fillLevelThreshold = parseInt(document.getElementById('fillLevelThreshold').value);
            AppState.settings.batteryThreshold = parseInt(document.getElementById('batteryThreshold').value);
            AppState.settings.conditionThreshold = parseInt(document.getElementById('conditionThreshold').value);
            AppState.settings.maintenanceDaysBefore = parseInt(document.getElementById('maintenanceDaysBefore').value);

            saveDataToStorage();

            // Update dashboard if visible
            if (AppState.currentSection === 'dashboard') {
                updateDashboard();
            }
        }

        // ===== Settings Functions =====
        function renderSettings() {
            // Update UI to match current settings
            document.getElementById('showIDsToggle').checked = AppState.settings.showIDs;
            document.getElementById('speechRate').value = AppState.settings.speechRate;
            document.getElementById('speechRateValue').textContent = AppState.settings.speechRate.toFixed(1);
            document.getElementById('ttsProvider').value = AppState.settings.ttsProvider;
            document.getElementById('sttProvider').value = AppState.settings.sttProvider;

            // Maintenance thresholds
            document.getElementById('fillLevelThreshold').value = AppState.settings.fillLevelThreshold;
            document.getElementById('batteryThreshold').value = AppState.settings.batteryThreshold;
            document.getElementById('conditionThreshold').value = AppState.settings.conditionThreshold;
            document.getElementById('maintenanceDaysBefore').value = AppState.settings.maintenanceDaysBefore;

            // Load categories and properties
            document.getElementById('categoriesConfig').value = AppState.categories.join('\n');
            document.getElementById('propertiesConfig').value = AppState.properties.join('\n');
        }

        function toggleShowIDs(e) {
            AppState.settings.showIDs = e.target.checked;
            saveDataToStorage();
            renderCurrentSection();
            showNotification(`IDs werden ${AppState.settings.showIDs ? 'angezeigt' : 'versteckt'}`, 'info');
        }

        function updateSpeechRate(e) {
            AppState.settings.speechRate = parseFloat(e.target.value);
            document.getElementById('speechRateValue').textContent = AppState.settings.speechRate.toFixed(1);
            saveDataToStorage();
        }

        function updateTTSProvider(e) {
            AppState.settings.ttsProvider = e.target.value;
            saveDataToStorage();
            showNotification(`TTS-Provider auf ${e.target.value} ge√§ndert`, 'info');
        }

        function updateSTTProvider(e) {
            AppState.settings.sttProvider = e.target.value;
            saveDataToStorage();
            showNotification(`STT-Provider auf ${e.target.value} ge√§ndert`, 'info');
        }

        function saveConfiguration() {
            // Save categories
            const categories = document.getElementById('categoriesConfig').value
                .split('\n')
                .filter(cat => cat.trim())
                .map(cat => cat.trim());
            AppState.categories = categories;

            // Save properties
            const properties = document.getElementById('propertiesConfig').value
                .split('\n')
                .filter(prop => prop.trim())
                .map(prop => prop.trim());
            AppState.properties = properties;

            saveDataToStorage();
            showNotification('Konfiguration gespeichert!', 'success');

            // Re-render affected sections
            if (AppState.currentSection === 'add') {
                renderCategorySelection();
                renderPropertySliders();
            }
        }

        // ===== Search & Filter Functions =====
        function initializeSearch() {
            renderCategoryFilters();
            handleSearch();
        }

        function renderCategoryFilters() {
            const container = document.getElementById('categoryFilters');
            container.innerHTML = '';

            // Get unique categories from inventory
            const categories = [...new Set(AppState.inventory.map(item => item.category))];

            categories.forEach(category => {
                const chip = document.createElement('div');
                chip.className = 'filter-chip';
                chip.dataset.filterCategory = category;
                chip.textContent = category;
                chip.onclick = () => toggleCategoryFilter(category);
                container.appendChild(chip);
            });
        }

        function toggleCategoryFilter(category) {
            const chip = document.querySelector(`[data-filter-category="${category}"]`);
            chip.classList.toggle('active');
            handleSearch();
        }

        function handleSearch() {
            const searchTerm = document.getElementById('searchInput').value.toLowerCase();
            const activeFilters = document.querySelectorAll('.filter-chip.active[data-filter]');
            const activeCategories = Array.from(document.querySelectorAll('.filter-chip.active[data-filter-category]'))
                .map(chip => chip.dataset.filterCategory);

            let results = AppState.inventory;

            // Apply search term
            if (searchTerm) {
                results = results.filter(item => {
                    return item.name.toLowerCase().includes(searchTerm) ||
                           item.room.toLowerCase().includes(searchTerm) ||
                           item.id.toLowerCase().includes(searchTerm) ||
                           (item.notes && item.notes.toLowerCase().includes(searchTerm));
                });
            }

            // Apply category filters
            if (activeCategories.length > 0) {
                results = results.filter(item => activeCategories.includes(item.category));
            }

            // Apply condition filters
            activeFilters.forEach(filter => {
                const filterType = filter.dataset.filter;
                switch (filterType) {
                    case 'low-stock':
                        results = results.filter(item => (item.properties?.['F√ºllstand'] || 100) < AppState.settings.fillLevelThreshold);
                        break;
                    case 'full':
                        results = results.filter(item => (item.properties?.['F√ºllstand'] || 100) > 80);
                        break;
                    case 'poor-condition':
                        results = results.filter(item => (item.properties?.['Zustand'] || 100) < AppState.settings.conditionThreshold);
                        break;
                    case 'low-battery':
                        results = results.filter(item => (item.properties?.['Batterie'] || 100) < AppState.settings.batteryThreshold);
                        break;
                    case 'maintenance':
                        results = results.filter(item => checkMaintenanceNeeded(item));
                        break;
                }
            });

            renderSearchResults(results);
        }

        function renderSearchResults(results) {
            const container = document.getElementById('searchResults');
            container.innerHTML = '';

            if (results.length === 0) {
                container.innerHTML = '<p style="text-align: center; color: var(--text-medium); font-size: 1.1rem;">Keine Ergebnisse gefunden</p>';
                return;
            }

            results.forEach(item => {
                const card = createInventoryCard(item);
                container.appendChild(card);
            });
        }

        function setupFilterChips() {
            // Search filters
            document.querySelectorAll('.filter-chip[data-filter]').forEach(chip => {
                chip.addEventListener('click', () => {
                    if (chip.dataset.filter === 'all') {
                        document.querySelectorAll('.filter-chip[data-filter]').forEach(c => c.classList.remove('active'));
                        chip.classList.add('active');
                    } else {
                        document.querySelector('.filter-chip[data-filter="all"]')?.classList.remove('active');
                        chip.classList.toggle('active');
                    }

                    if (AppState.currentSection === 'search') {
                        handleSearch();
                    }
                });
            });

            // Maintenance filters
            document.querySelectorAll('.filter-chip[data-maintenance]').forEach(chip => {
                chip.addEventListener('click', () => {
                    document.querySelectorAll('.filter-chip[data-maintenance]').forEach(c => c.classList.remove('active'));
                    chip.classList.add('active');
                    renderMaintenance();
                });
            });
        }

        // ===== Inventory Tree View =====
        function renderInventoryTree() {
            const container = document.getElementById('inventoryTree');
            container.innerHTML = '';

            // Group items by room
            const roomGroups = {};
            AppState.inventory.forEach(item => {
                if (!roomGroups[item.room]) {
                    roomGroups[item.room] = {
                        furniture: {}
                    };
                }

                const furnitureKey = item.furniture || 'Ohne M√∂bel';
                if (!roomGroups[item.room].furniture[furnitureKey]) {
                    roomGroups[item.room].furniture[furnitureKey] = {
                        containers: {}
                    };
                }

                const containerKey = item.container || 'Ohne Container';
                if (!roomGroups[item.room].furniture[furnitureKey].containers[containerKey]) {
                    roomGroups[item.room].furniture[furnitureKey].containers[containerKey] = [];
                }

                roomGroups[item.room].furniture[furnitureKey].containers[containerKey].push(item);
            });

            // Render tree structure
            Object.entries(roomGroups).forEach(([roomName, roomData]) => {
                const roomElement = createTreeNode(roomName, 'room', 'üè†');

                Object.entries(roomData.furniture).forEach(([furnitureName, furnitureData]) => {
                    if (furnitureName !== 'Ohne M√∂bel') {
                        const furnitureElement = createTreeNode(furnitureName, 'furniture', 'ü™ë');

                        Object.entries(furnitureData.containers).forEach(([containerName, items]) => {
                            if (containerName !== 'Ohne Container') {
                                const containerElement = createTreeNode(containerName, 'container', 'üìÅ');

                                items.forEach(item => {
                                    const itemElement = createTreeItem(item);
                                    containerElement.querySelector('.tree-children').appendChild(itemElement);
                                });

                                furnitureElement.querySelector('.tree-children').appendChild(containerElement);
                            } else {
                                items.forEach(item => {
                                    const itemElement = createTreeItem(item);
                                    furnitureElement.querySelector('.tree-children').appendChild(itemElement);
                                });
                            }
                        });

                        roomElement.querySelector('.tree-children').appendChild(furnitureElement);
                    } else {
                        Object.entries(furnitureData.containers).forEach(([containerName, items]) => {
                            items.forEach(item => {
                                const itemElement = createTreeItem(item);
                                roomElement.querySelector('.tree-children').appendChild(itemElement);
                            });
                        });
                    }
                });

                container.appendChild(roomElement);
            });
        }

        function createTreeNode(name, type, icon) {
            const node = document.createElement('div');
            node.className = 'tree-node';
            node.innerHTML = `
                <div class="tree-header" onclick="toggleTreeNode(this)" style="
                    padding: 12px;
                    background: var(--background-light);
                    border-radius: 8px;
                    margin-bottom: 8px;
                    cursor: pointer;
                    display: flex;
                    align-items: center;
                    gap: 8px;
                    transition: all 0.2s;
                ">
                    <span class="tree-toggle" style="transition: transform 0.2s;">‚ñ∂</span>
                    <span>${icon}</span>
                    <span style="font-weight: 600; font-size: 1.1rem;">${name}</span>
                </div>
                <div class="tree-children" style="margin-left: 24px; display: none;">
                </div>
            `;
            return node;
        }

        function createTreeItem(item) {
            const element = document.createElement('div');
            element.className = 'tree-item';
            element.style.cssText = `
                padding: 10px 12px;
                background: var(--background-white);
                border: 2px solid var(--border-color);
                border-radius: 8px;
                margin-bottom: 6px;
                cursor: pointer;
                transition: all 0.2s;
                display: flex;
                align-items: center;
                gap: 8px;
            `;

            const categoryIcon = item.category.split(' ')[0] || 'üì¶';
            const maintenanceIcon = checkMaintenanceNeeded(item) ? ' üîß' : '';

            element.innerHTML = `
                <span style="font-size: 1.2rem;">${categoryIcon}</span>
                <span style="font-size: 1.1rem;">${item.name}${maintenanceIcon}</span>
                ${item.position && item.position !== 'darin' ? `<span style="font-style: italic; color: var(--text-medium);">(${item.position})</span>` : ''}
                ${AppState.settings.showIDs ? `<small style="color: var(--text-medium); margin-left: auto; font-family: monospace;">ID: ${item.id}</small>` : ''}
            `;

            element.onclick = () => showItemDetails(item);

            element.onmouseover = () => {
                element.style.background = 'var(--background-light)';
                element.style.borderColor = 'var(--primary-green)';
                element.style.transform = 'translateX(5px)';
            };

            element.onmouseout = () => {
                element.style.background = 'var(--background-white)';
                element.style.borderColor = 'var(--border-color)';
                element.style.transform = 'translateX(0)';
            };

            return element;
        }

        function toggleTreeNode(header) {
            const toggle = header.querySelector('.tree-toggle');
            const children = header.nextElementSibling;

            if (children.style.display === 'none') {
                children.style.display = 'block';
                toggle.style.transform = 'rotate(90deg)';
            } else {
                children.style.display = 'none';
                toggle.style.transform = 'rotate(0deg)';
            }
        }

        function toggleTreeView() {
            const allChildren = document.querySelectorAll('.tree-children');
            const allToggles = document.querySelectorAll('.tree-toggle');
            const isAnyOpen = Array.from(allChildren).some(child => child.style.display !== 'none');

            allChildren.forEach(child => {
                child.style.display = isAnyOpen ? 'none' : 'block';
            });

            allToggles.forEach(toggle => {
                toggle.style.transform = isAnyOpen ? 'rotate(0deg)' : 'rotate(90deg)';
            });
        }

        // ===== Form Initialization =====
        function initializeAddForm() {
            // Populate room select
            const roomSelect = document.getElementById('itemRoom');
            roomSelect.innerHTML = '<option value="">Raum ausw√§hlen...</option>';

            const rooms = [...new Set(AppState.inventory.map(item => item.room))];
            rooms.forEach(room => {
                const option = document.createElement('option');
                option.value = room;
                option.textContent = room;
                roomSelect.appendChild(option);
            });

            // Add option to create new room
            const newRoomOption = document.createElement('option');
            newRoomOption.value = '__new__';
            newRoomOption.textContent = '+ Neuer Raum';
            roomSelect.appendChild(newRoomOption);

            roomSelect.addEventListener('change', (e) => {
                if (e.target.value === '__new__') {
                    const newRoom = prompt('Name des neuen Raums:');
                    if (newRoom && newRoom.trim()) {
                        const option = document.createElement('option');
                        option.value = newRoom;
                        option.textContent = newRoom;
                        roomSelect.insertBefore(option, roomSelect.lastElementChild);
                        roomSelect.value = newRoom;
                    } else {
                        roomSelect.value = '';
                    }
                }
            });

            // Render category selection
            renderCategorySelection();

            // Render property sliders
            renderPropertySliders();
        }

        function renderCategorySelection() {
            const container = document.getElementById('categorySelection');
            container.innerHTML = '';

            AppState.categories.forEach(category => {
                const chip = document.createElement('div');
                chip.className = 'filter-chip';
                chip.dataset.category = category;
                chip.textContent = category;
                chip.onclick = () => selectCategory(chip);
                container.appendChild(chip);
            });
        }

        function selectCategory(chip) {
            document.querySelectorAll('#categorySelection .filter-chip').forEach(c => {
                c.classList.remove('active');
            });
            chip.classList.add('active');
        }

        function renderPropertySliders() {
            const container = document.getElementById('propertySliders');
            container.innerHTML = '';

            AppState.properties.forEach(property => {
                const group = document.createElement('div');
                group.className = 'form-group';
                group.innerHTML = `
                    <label class="form-label">${property}: <span id="${property}-value">50</span>%</label>
                    <input type="range" class="form-input property-slider" data-property="${property}"
                           min="0" max="100" value="50" oninput="updateSliderValue('${property}', this.value)">
                    <div class="progress-bar">
                        <div class="progress-fill" id="${property}-fill" style="width: 50%;"></div>
                    </div>
                `;
                container.appendChild(group);
            });
        }

        function updateSliderValue(property, value) {
            document.getElementById(`${property}-value`).textContent = value;
            document.getElementById(`${property}-fill`).style.width = value + '%';
        }

        function addCustomProperty() {
            const propertyName = prompt('Name der neuen Eigenschaft:');
            if (propertyName && propertyName.trim() && !AppState.properties.includes(propertyName)) {
                AppState.properties.push(propertyName);
                renderPropertySliders();
                saveDataToStorage();
                showNotification(`Eigenschaft "${propertyName}" hinzugef√ºgt!`, 'success');
            }
        }

        // ===== Import/Export Functions =====
        function exportJSON() {
            const data = JSON.stringify(AppState, null, 2);
            const blob = new Blob([data], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `inventar-backup-${new Date().toISOString().split('T')[0]}.json`;
            a.click();
            URL.revokeObjectURL(url);
            showNotification('JSON-Export erfolgreich!', 'success');
        }

        function exportCSV() {
            // Create CSV header
            const headers = ['ID', 'Name', 'Raum', 'M√∂bel', 'Container', 'Position', 'Kategorie',
                           'Wartungsintervall (Tage)', 'Laufzeit (Stunden)', 'Gesamtlaufzeit (Stunden)',
                           'Notizen', 'Hinzugef√ºgt', 'Ge√§ndert'];
            AppState.properties.forEach(prop => headers.push(prop));

            // Create CSV rows
            const rows = [headers];

            AppState.inventory.forEach(item => {
                const row = [
                    item.id,
                    item.name,
                    item.room,
                    item.furniture || '',
                    item.container || '',
                    item.position || 'darin',
                    item.category,
                    item.maintenanceInterval || '',
                    item.runtime || '',
                    item.totalRuntime || '',
                    item.notes || '',
                    new Date(item.dateAdded).toLocaleString('de-DE'),
                    new Date(item.lastModified).toLocaleString('de-DE')
                ];

                AppState.properties.forEach(prop => {
                    row.push(item.properties?.[prop] || '');
                });

                rows.push(row);
            });

            // Convert to CSV string with proper escaping
            const csvContent = rows.map(row =>
                row.map(cell => {
                    const cellStr = String(cell);
                    // Escape quotes and wrap in quotes if contains comma, newline, or quote
                    if (cellStr.includes(',') || cellStr.includes('\n') || cellStr.includes('"')) {
                        return '"' + cellStr.replace(/"/g, '""') + '"';
                    }
                    return cellStr;
                }).join(',')
            ).join('\n');

            // Add BOM for Excel UTF-8 compatibility
            const BOM = '\uFEFF';
            const blob = new Blob([BOM + csvContent], { type: 'text/csv;charset=utf-8;' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `inventar-export-${new Date().toISOString().split('T')[0]}.csv`;
            a.click();
            URL.revokeObjectURL(url);
            showNotification('CSV-Export (Excel-kompatibel) erfolgreich!', 'success');
        }

        function exportInventory() {
            // Show export options
            const choice = confirm('JSON-Format exportieren? (OK = JSON, Abbrechen = CSV)');
            if (choice) {
                exportJSON();
            } else {
                exportCSV();
            }
        }

        function handleImport(e) {
            const file = e.target.files[0];
            if (!file) return;

            const reader = new FileReader();

            if (file.name.endsWith('.json')) {
                reader.onload = (event) => {
                    try {
                        const data = JSON.parse(event.target.result);
                        if (confirm('Dies wird alle aktuellen Daten ersetzen. Fortfahren?')) {
                            Object.assign(AppState, data);
                            saveDataToStorage();
                            renderCurrentSection();
                            showNotification('JSON-Import erfolgreich!', 'success');
                        }
                    } catch (error) {
                        showNotification('Fehler beim Import: ' + error.message, 'error');
                    }
                };
                reader.readAsText(file);
            } else if (file.name.endsWith('.csv')) {
                reader.onload = (event) => {
                    try {
                        const csvData = event.target.result;
                        const rows = csvData.split('\n').map(row => {
                            const cells = [];
                            let cell = '';
                            let inQuotes = false;

                            for (let i = 0; i < row.length; i++) {
                                const char = row[i];
                                const nextChar = row[i + 1];

                                if (char === '"' && nextChar === '"' && inQuotes) {
                                    cell += '"';
                                    i++; // Skip next quote
                                } else if (char === '"') {
                                    inQuotes = !inQuotes;
                                } else if (char === ',' && !inQuotes) {
                                    cells.push(cell);
                                    cell = '';
                                } else {
                                    cell += char;
                                }
                            }
                            cells.push(cell);
                            return cells;
                        });

                        if (rows.length < 2) {
                            throw new Error('CSV-Datei ist leer oder ung√ºltig');
                        }

                        const headers = rows[0];
                        const items = [];

                        // Find where properties start in headers
                        const propertyStartIndex = headers.indexOf('Hinzugef√ºgt') + 2; // After "Ge√§ndert"

                        for (let i = 1; i < rows.length; i++) {
                            const row = rows[i];
                            if (row.length < 13) continue; // Skip incomplete rows

                            const item = {
                                id: row[0] || generateItemId(),
                                name: row[1],
                                room: row[2],
                                furniture: row[3] || null,
                                container: row[4] || null,
                                position: row[5] || 'darin',
                                category: row[6] || 'Sonstiges',
                                maintenanceInterval: parseInt(row[7]) || null,
                                runtime: parseFloat(row[8]) || null,
                                totalRuntime: parseFloat(row[9]) || 0,
                                notes: row[10] || '',
                                dateAdded: row[11] || new Date().toISOString(),
                                lastModified: row[12] || new Date().toISOString(),
                                properties: {}
                            };

                            // Import properties
                            for (let j = propertyStartIndex; j < headers.length && j < row.length; j++) {
                                const propName = headers[j];
                                const propValue = parseInt(row[j]) || 0;
                                if (propName) {
                                    item.properties[propName] = propValue;
                                }
                            }

                            items.push(item);
                        }

                        if (confirm(`${items.length} Gegenst√§nde gefunden. Importieren?`)) {
                            AppState.inventory = items;
                            // Update next ID based on imported items
                            const maxId = Math.max(...items.map(item => parseInt(item.id) || 0));
                            AppState.nextId = maxId + 1;

                            saveDataToStorage();
                            renderCurrentSection();
                            showNotification(`${items.length} Gegenst√§nde importiert!`, 'success');
                        }
                    } catch (error) {
                        showNotification('Fehler beim CSV-Import: ' + error.message, 'error');
                    }
                };
                reader.readAsText(file, 'UTF-8');
            }

            // Reset input
            e.target.value = '';
        }

        function clearAllData() {
            if (confirm('WARNUNG: Dies wird ALLE Daten unwiderruflich l√∂schen! Sind Sie sicher?')) {
                if (confirm('Wirklich ALLE Daten l√∂schen? Diese Aktion kann nicht r√ºckg√§ngig gemacht werden!')) {
                    localStorage.clear();
                    location.reload();
                }
            }
        }

        // ===== Modal Functions =====
        function closeModal(modalId) {
            const modal = document.getElementById(modalId);
            modal.classList.remove('active');
        }

        // Close modal on outside click
        document.addEventListener('click', (e) => {
            if (e.target.classList.contains('modal')) {
                e.target.classList.remove('active');
            }
        });

        // ===== Keyboard Shortcuts =====
        document.addEventListener('keydown', (e) => {
            // Ctrl/Cmd + S: Save
            if ((e.ctrlKey || e.metaKey) && e.key === 's') {
                e.preventDefault();
                saveDataToStorage();
                showNotification('Daten gespeichert!', 'success');
            }

            // Ctrl/Cmd + F: Focus search
            if ((e.ctrlKey || e.metaKey) && e.key === 'f') {
                e.preventDefault();
                navigateToSection('search');
                document.getElementById('searchInput').focus();
            }

            // Ctrl/Cmd + N: New item
            if ((e.ctrlKey || e.metaKey) && e.key === 'n') {
                e.preventDefault();
                navigateToSection('add');
            }

            // Escape: Close modals
            if (e.key === 'Escape') {
                document.querySelectorAll('.modal.active').forEach(modal => {
                    modal.classList.remove('active');
                });
            }
        });

        // ===== Notification System =====
        function showNotification(message, type = 'info') {
            const container = document.getElementById('notificationContainer');
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;

            const icon = type === 'success' ? '‚úÖ' :
                        type === 'error' ? '‚ùå' :
                        type === 'warning' ? '‚ö†Ô∏è' : '‚ÑπÔ∏è';

            notification.innerHTML = `
                <span>${icon}</span>
                <span>${message}</span>
            `;

            container.appendChild(notification);

            // Auto-remove after 5 seconds
            setTimeout(() => {
                notification.style.animation = 'slideOutRight 0.5s ease';
                setTimeout(() => notification.remove(), 500);
            }, 5000);
        }

        // ===== Utility Functions =====
        function debounce(func, wait) {
            let timeout;
            return function executedFunction(...args) {
                const later = () => {
                    clearTimeout(timeout);
                    func(...args);
                };
                clearTimeout(timeout);
                timeout = setTimeout(later, wait);
            };
        }

        // ===== Initialize Demo Data (if empty) =====
        if (AppState.inventory.length === 0) {
            // Add some demo items
            const demoItems = [
                {
                    id: generateItemId(),
                    name: 'Hammer',
                    room: 'Werkstatt',
                    furniture: 'Werkbank',
                    container: 'Obere Schublade',
                    position: 'darin',
                    category: 'üîß Werkzeug',
                    properties: { 'F√ºllstand': 100, 'Zustand': 85, 'Batterie': 100 },
                    notes: 'Schwerer Zimmermannshammer',
                    maintenanceInterval: 365,
                    runtime: null,
                    totalRuntime: 0,
                    lastMaintenance: new Date().toISOString(),
                    dateAdded: new Date().toISOString(),
                    lastModified: new Date().toISOString()
                },
                {
                    id: generateItemId(),
                    name: 'Erste-Hilfe-Set',
                    room: 'Badezimmer',
                    furniture: 'Spiegelschrank',
                    container: null,
                    position: 'darin',
                    category: 'üíä Medizin',
                    properties: { 'F√ºllstand': 75, 'Zustand': 100 },
                    notes: 'Haltbarkeit √ºberpr√ºfen!',
                    maintenanceInterval: 180,
                    runtime: null,
                    totalRuntime: 0,
                    lastMaintenance: new Date(Date.now() - 150 * 24 * 60 * 60 * 1000).toISOString(),
                    dateAdded: new Date().toISOString(),
                    lastModified: new Date().toISOString()
                },
                {
                    id: generateItemId(),
                    name: 'Gaming-Headset',
                    room: 'Arbeitszimmer',
                    furniture: 'Schreibtisch',
                    container: null,
                    position: 'oben drauf',
                    category: 'üéÆ Gaming',
                    properties: { 'Zustand': 90, 'Batterie': 15 },
                    notes: 'Wireless, USB-C Ladekabel',
                    maintenanceInterval: null,
                    runtime: 2000,
                    totalRuntime: 1850,
                    lastMaintenance: new Date().toISOString(),
                    dateAdded: new Date().toISOString(),
                    lastModified: new Date().toISOString()
                }
            ];

            AppState.inventory = demoItems;
            saveDataToStorage();
        }

        // Style for toggle switch
        const style = document.createElement('style');
        style.textContent = `
            .switch {
                position: relative;
                display: inline-block;
                width: 50px;
                height: 26px;
            }

            .switch input {
                opacity: 0;
                width: 0;
                height: 0;
            }

            .slider {
                position: absolute;
                cursor: pointer;
                top: 0;
                left: 0;
                right: 0;
                bottom: 0;
                background-color: var(--border-color);
                transition: .4s;
                border-radius: 26px;
            }

            .slider:before {
                position: absolute;
                content: "";
                height: 20px;
                width: 20px;
                left: 3px;
                bottom: 3px;
                background-color: white;
                transition: .4s;
                border-radius: 50%;
            }

            input:checked + .slider {
                background-color: var(--primary-green);
            }

            input:focus + .slider {
                box-shadow: 0 0 1px var(--primary-green);
            }

            input:checked + .slider:before {
                transform: translateX(24px);
            }
        `;
        document.head.appendChild(style);

        console.log('Inventartor geladen!');
    </script>
</body>
</html>
