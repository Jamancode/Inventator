<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Inventartor</title>
    <style>
        /* ===== CSS Variables & Root Styles ===== */
        :root {
            /* Gr√ºn-Pastell Farbschema mit optimalen Kontrasten */
            --primary-green: #52b788;
            --primary-dark: #2d6a4f;
            --primary-light: #95d5b2;
            --accent-green: #74c69d;
            --background-light: #f1faee;
            --background-white: #ffffff;
            --text-dark: #1b4332;
            --text-medium: #40916c;
            --text-light: #52b788;
            --shadow-color: rgba(45, 106, 79, 0.1);
            --border-color: #d8f3dc;
            --error-color: #e63946;
            --warning-color: #f77f00;
            --success-color: #06ffa5;
            --info-color: #4ecdc4;

            /* Animationen */
            --transition-fast: 0.2s ease;
            --transition-medium: 0.4s ease;
            --transition-slow: 0.6s ease;

            /* Layout */
            --header-height: 70px;
            --sidebar-width: 280px;
            --border-radius: 12px;
            --border-radius-small: 8px;
            --spacing-xs: 0.25rem;
            --spacing-sm: 0.5rem;
            --spacing-md: 1rem;
            --spacing-lg: 1.5rem;
            --spacing-xl: 2rem;
        }

        /* Dark Mode Variables */
        [data-theme="dark"] {
            --primary-green: #74c69d;
            --primary-dark: #95d5b2;
            --primary-light: #40916c;
            --accent-green: #52b788;
            --background-light: #081c15;
            --background-white: #1b4332;
            --text-dark: #f1faee;
            --text-medium: #b7e4c7;
            --text-light: #95d5b2;
            --shadow-color: rgba(149, 213, 178, 0.1);
            --border-color: #2d6a4f;
        }

        /* ===== Reset & Base Styles ===== */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        html {
            font-size: 16px;
            scroll-behavior: smooth;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background-color: var(--background-light);
            color: var(--text-dark);
            line-height: 1.6;
            overflow-x: hidden;
            transition: background-color var(--transition-medium), color var(--transition-medium);
        }

        /* ===== Loading Screen ===== */
        .loading-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, var(--primary-light) 0%, var(--accent-green) 100%);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 10000;
            transition: opacity 0.5s ease;
        }

        .loading-content {
            text-align: center;
            color: white;
        }

        .loading-spinner {
            width: 80px;
            height: 80px;
            border: 5px solid rgba(255, 255, 255, 0.3);
            border-top-color: white;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* ===== Header ===== */
        .header {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            height: var(--header-height);
            background: var(--background-white);
            box-shadow: 0 2px 20px var(--shadow-color);
            z-index: 1000;
            display: flex;
            align-items: center;
            padding: 0 var(--spacing-lg);
            transition: all var(--transition-medium);
        }

        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            width: 100%;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: var(--spacing-md);
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--primary-dark);
        }

        .logo-icon {
            width: 40px;
            height: 40px;
            background: linear-gradient(135deg, var(--primary-green), var(--accent-green));
            border-radius: var(--border-radius-small);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            color: white;
            animation: pulse 2s ease infinite;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        .header-actions {
            display: flex;
            align-items: center;
            gap: var(--spacing-md);
        }

        .theme-toggle {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: var(--text-medium);
            transition: all var(--transition-fast);
            padding: var(--spacing-sm);
            border-radius: var(--border-radius-small);
        }

        .theme-toggle:hover {
            background: var(--background-light);
            color: var(--primary-dark);
            transform: rotate(180deg);
        }

        /* ===== Main Layout ===== */
        .app-container {
            display: flex;
            min-height: 100vh;
            padding-top: var(--header-height);
        }

        /* ===== Sidebar Navigation ===== */
        .sidebar {
            width: var(--sidebar-width);
            background: var(--background-white);
            box-shadow: 2px 0 20px var(--shadow-color);
            padding: var(--spacing-lg);
            overflow-y: auto;
            transition: all var(--transition-medium);
            position: fixed;
            left: 0;
            top: var(--header-height);
            bottom: 0;
            z-index: 900;
        }

        .sidebar.collapsed {
            width: 80px;
        }

        .nav-item {
            display: flex;
            align-items: center;
            gap: var(--spacing-md);
            padding: var(--spacing-md);
            margin-bottom: var(--spacing-sm);
            border-radius: var(--border-radius-small);
            cursor: pointer;
            transition: all var(--transition-fast);
            color: var(--text-medium);
            font-weight: 500;
        }

        .nav-item:hover {
            background: var(--background-light);
            color: var(--primary-dark);
            transform: translateX(5px);
        }

        .nav-item.active {
            background: linear-gradient(135deg, var(--primary-green), var(--accent-green));
            color: white;
            box-shadow: 0 5px 15px rgba(82, 183, 136, 0.3);
        }

        .nav-icon {
            font-size: 1.25rem;
            min-width: 24px;
        }

        .nav-text {
            transition: opacity var(--transition-fast);
        }

        .sidebar.collapsed .nav-text {
            display: none;
        }

        /* ===== Main Content ===== */
        .main-content {
            flex: 1;
            margin-left: var(--sidebar-width);
            padding: var(--spacing-xl);
            transition: margin-left var(--transition-medium);
        }

        .sidebar.collapsed + .main-content {
            margin-left: 80px;
        }

        /* ===== Dashboard Stats ===== */
        .dashboard-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: var(--spacing-lg);
            margin-bottom: var(--spacing-xl);
        }

        .stat-card {
            background: var(--background-white);
            border-radius: var(--border-radius);
            padding: var(--spacing-lg);
            box-shadow: 0 5px 20px var(--shadow-color);
            transition: all var(--transition-fast);
            position: relative;
            overflow: hidden;
        }

        .stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, var(--primary-green), var(--accent-green));
            transform: scaleX(0);
            transform-origin: left;
            transition: transform var(--transition-medium);
        }

        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 30px var(--shadow-color);
        }

        .stat-card:hover::before {
            transform: scaleX(1);
        }

        .stat-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: var(--spacing-md);
        }

        .stat-icon {
            width: 50px;
            height: 50px;
            background: var(--background-light);
            border-radius: var(--border-radius-small);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            color: var(--primary-green);
        }

        .stat-value {
            font-size: 2rem;
            font-weight: 700;
            color: var(--primary-dark);
            margin-bottom: var(--spacing-xs);
        }

        .stat-label {
            color: var(--text-medium);
            font-size: 0.875rem;
        }

        .stat-trend {
            font-size: 0.75rem;
            color: var(--success-color);
            display: flex;
            align-items: center;
            gap: var(--spacing-xs);
        }

        /* ===== Content Sections ===== */
        .content-section {
            background: var(--background-white);
            border-radius: var(--border-radius);
            padding: var(--spacing-xl);
            box-shadow: 0 5px 20px var(--shadow-color);
            margin-bottom: var(--spacing-xl);
            animation: fadeInUp 0.5s ease;
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: var(--spacing-lg);
            padding-bottom: var(--spacing-md);
            border-bottom: 2px solid var(--border-color);
        }

        .section-title {
            font-size: 1.5rem;
            font-weight: 600;
            color: var(--primary-dark);
        }

        /* ===== Forms ===== */
        .form-group {
            margin-bottom: var(--spacing-lg);
        }

        .form-label {
            display: block;
            margin-bottom: var(--spacing-sm);
            font-weight: 500;
            color: var(--text-dark);
        }

        .form-input,
        .form-select,
        .form-textarea {
            width: 100%;
            padding: var(--spacing-md);
            border: 2px solid var(--border-color);
            border-radius: var(--border-radius-small);
            background: var(--background-white);
            color: var(--text-dark);
            font-size: 1rem;
            transition: all var(--transition-fast);
        }

        .form-input:focus,
        .form-select:focus,
        .form-textarea:focus {
            outline: none;
            border-color: var(--primary-green);
            box-shadow: 0 0 0 3px rgba(82, 183, 136, 0.1);
        }

        /* ===== Buttons ===== */
        .btn {
            padding: var(--spacing-md) var(--spacing-lg);
            border: none;
            border-radius: var(--border-radius-small);
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all var(--transition-fast);
            display: inline-flex;
            align-items: center;
            gap: var(--spacing-sm);
            position: relative;
            overflow: hidden;
        }

        .btn::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            background: rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            transform: translate(-50%, -50%);
            transition: width 0.6s, height 0.6s;
        }

        .btn:active::before {
            width: 300px;
            height: 300px;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--primary-green), var(--accent-green));
            color: white;
            box-shadow: 0 5px 15px rgba(82, 183, 136, 0.3);
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(82, 183, 136, 0.4);
        }

        .btn-secondary {
            background: var(--background-light);
            color: var(--text-dark);
            border: 2px solid var(--border-color);
        }

        .btn-secondary:hover {
            background: var(--border-color);
            border-color: var(--primary-green);
        }

        .btn-danger {
            background: var(--error-color);
            color: white;
        }

        .btn-danger:hover {
            background: #d62828;
            transform: translateY(-2px);
        }

        /* ===== Modal ===== */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.7);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 2000;
            opacity: 0;
            visibility: hidden;
            transition: all var(--transition-medium);
        }

        .modal.active {
            opacity: 1;
            visibility: visible;
        }

        .modal-content {
            background: var(--background-white);
            border-radius: var(--border-radius);
            padding: var(--spacing-xl);
            max-width: 600px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
            transform: scale(0.8);
            transition: transform var(--transition-medium);
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        }

        .modal.active .modal-content {
            transform: scale(1);
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: var(--spacing-lg);
        }

        .modal-close {
            background: none;
            border: none;
            font-size: 1.5rem;
            color: var(--text-medium);
            cursor: pointer;
            padding: var(--spacing-sm);
            border-radius: var(--border-radius-small);
            transition: all var(--transition-fast);
        }

        .modal-close:hover {
            background: var(--background-light);
            color: var(--error-color);
            transform: rotate(90deg);
        }

        /* ===== Inventory Grid ===== */
        .inventory-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: var(--spacing-lg);
            margin-top: var(--spacing-lg);
        }

        .inventory-item {
            background: var(--background-white);
            border: 2px solid var(--border-color);
            border-radius: var(--border-radius);
            padding: var(--spacing-md);
            transition: all var(--transition-fast);
            cursor: pointer;
            position: relative;
            overflow: hidden;
        }

        .inventory-item::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, transparent, rgba(82, 183, 136, 0.1));
            transform: translateX(-100%);
            transition: transform var(--transition-medium);
        }

        .inventory-item:hover {
            border-color: var(--primary-green);
            transform: translateY(-5px);
            box-shadow: 0 10px 25px var(--shadow-color);
        }

        .inventory-item:hover::before {
            transform: translateX(0);
        }

        .item-image {
            width: 100%;
            height: 150px;
            object-fit: cover;
            border-radius: var(--border-radius-small);
            margin-bottom: var(--spacing-md);
        }

        .item-name {
            font-weight: 600;
            color: var(--text-dark);
            margin-bottom: var(--spacing-sm);
        }

        .item-location {
            font-size: 0.875rem;
            color: var(--text-medium);
            display: flex;
            align-items: center;
            gap: var(--spacing-xs);
        }

        .item-properties {
            margin-top: var(--spacing-md);
            display: flex;
            flex-wrap: wrap;
            gap: var(--spacing-sm);
        }

        .property-badge {
            font-size: 0.75rem;
            padding: var(--spacing-xs) var(--spacing-sm);
            background: var(--background-light);
            border-radius: 20px;
            color: var(--text-medium);
        }

        /* ===== Progress Bars ===== */
        .progress-bar {
            width: 100%;
            height: 8px;
            background: var(--background-light);
            border-radius: 4px;
            overflow: hidden;
            margin-top: var(--spacing-xs);
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--primary-green), var(--accent-green));
            transition: width var(--transition-medium);
            position: relative;
            overflow: hidden;
        }

        .progress-fill::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            bottom: 0;
            right: 0;
            background: linear-gradient(
                90deg,
                transparent,
                rgba(255, 255, 255, 0.3),
                transparent
            );
            animation: shimmer 2s infinite;
        }

        @keyframes shimmer {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }

        /* ===== Focus View ===== */
        .focus-view {
            position: fixed;
            top: var(--header-height);
            right: 0;
            width: 400px;
            height: calc(100vh - var(--header-height));
            background: var(--background-white);
            box-shadow: -5px 0 20px var(--shadow-color);
            transform: translateX(100%);
            transition: transform var(--transition-medium);
            z-index: 950;
            overflow-y: auto;
            padding: var(--spacing-xl);
        }

        .focus-view.active {
            transform: translateX(0);
        }

        .focus-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: var(--spacing-lg);
            padding-bottom: var(--spacing-md);
            border-bottom: 2px solid var(--border-color);
        }

        .focus-close {
            background: none;
            border: none;
            font-size: 1.25rem;
            color: var(--text-medium);
            cursor: pointer;
            padding: var(--spacing-sm);
            border-radius: var(--border-radius-small);
            transition: all var(--transition-fast);
        }

        .focus-close:hover {
            background: var(--background-light);
            color: var(--error-color);
        }

        /* ===== Notifications ===== */
        .notification-container {
            position: fixed;
            top: calc(var(--header-height) + var(--spacing-lg));
            right: var(--spacing-lg);
            z-index: 3000;
            display: flex;
            flex-direction: column;
            gap: var(--spacing-md);
        }

        .notification {
            background: var(--background-white);
            border-radius: var(--border-radius-small);
            padding: var(--spacing-md) var(--spacing-lg);
            box-shadow: 0 5px 20px var(--shadow-color);
            display: flex;
            align-items: center;
            gap: var(--spacing-md);
            animation: slideInRight 0.5s ease;
            position: relative;
            overflow: hidden;
            min-width: 300px;
        }

        @keyframes slideInRight {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        .notification::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 4px;
            height: 100%;
            background: var(--primary-green);
        }

        .notification.error::before {
            background: var(--error-color);
        }

        .notification.warning::before {
            background: var(--warning-color);
        }

        .notification.success::before {
            background: var(--success-color);
        }

        /* ===== Search & Filter ===== */
        .search-container {
            position: relative;
            margin-bottom: var(--spacing-lg);
        }

        .search-input {
            width: 100%;
            padding: var(--spacing-md) var(--spacing-lg);
            padding-left: 3rem;
            border: 2px solid var(--border-color);
            border-radius: 50px;
            background: var(--background-white);
            font-size: 1rem;
            transition: all var(--transition-fast);
        }

        .search-input:focus {
            border-color: var(--primary-green);
            box-shadow: 0 0 0 3px rgba(82, 183, 136, 0.1);
        }

        .search-icon {
            position: absolute;
            left: var(--spacing-lg);
            top: 50%;
            transform: translateY(-50%);
            color: var(--text-medium);
        }

        .filter-chips {
            display: flex;
            flex-wrap: wrap;
            gap: var(--spacing-sm);
            margin-top: var(--spacing-md);
        }

        .filter-chip {
            padding: var(--spacing-sm) var(--spacing-md);
            background: var(--background-light);
            border: 2px solid transparent;
            border-radius: 50px;
            font-size: 0.875rem;
            cursor: pointer;
            transition: all var(--transition-fast);
            display: flex;
            align-items: center;
            gap: var(--spacing-xs);
        }

        .filter-chip:hover {
            border-color: var(--primary-green);
            transform: translateY(-2px);
        }

        .filter-chip.active {
            background: var(--primary-green);
            color: white;
            border-color: var(--primary-green);
        }

        /* ===== Voice Control ===== */
        .voice-control {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: var(--spacing-lg);
            padding: var(--spacing-xl);
        }

        .voice-button {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            border: none;
            background: linear-gradient(135deg, var(--primary-green), var(--accent-green));
            color: white;
            font-size: 3rem;
            cursor: pointer;
            transition: all var(--transition-fast);
            position: relative;
            box-shadow: 0 10px 30px rgba(82, 183, 136, 0.3);
        }

        .voice-button:hover {
            transform: scale(1.05);
            box-shadow: 0 15px 40px rgba(82, 183, 136, 0.4);
        }

        .voice-button.listening {
            animation: pulse 1.5s ease infinite;
        }

        .voice-button.processing {
            animation: rotate 1s linear infinite;
        }

        @keyframes rotate {
            to { transform: rotate(360deg); }
        }

        .voice-status {
            font-size: 1.125rem;
            color: var(--text-medium);
            text-align: center;
        }

        /* ===== Room Planner Canvas ===== */
        .canvas-container {
            position: relative;
            width: 100%;
            height: 500px;
            background: var(--background-light);
            border: 2px solid var(--border-color);
            border-radius: var(--border-radius);
            overflow: hidden;
        }

        .drawing-canvas {
            width: 100%;
            height: 100%;
            cursor: crosshair;
        }

        .canvas-tools {
            position: absolute;
            top: var(--spacing-md);
            left: var(--spacing-md);
            display: flex;
            gap: var(--spacing-sm);
            background: var(--background-white);
            padding: var(--spacing-sm);
            border-radius: var(--border-radius-small);
            box-shadow: 0 5px 15px var(--shadow-color);
        }

        .canvas-tool {
            width: 40px;
            height: 40px;
            border: none;
            background: var(--background-light);
            border-radius: var(--border-radius-small);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all var(--transition-fast);
        }

        .canvas-tool:hover {
            background: var(--primary-light);
            transform: translateY(-2px);
        }

        .canvas-tool.active {
            background: var(--primary-green);
            color: white;
        }

        /* ===== Settings Panel ===== */
        .settings-panel {
            display: grid;
            gap: var(--spacing-xl);
        }

        .settings-group {
            background: var(--background-light);
            padding: var(--spacing-lg);
            border-radius: var(--border-radius);
        }

        .settings-group-title {
            font-size: 1.125rem;
            font-weight: 600;
            color: var(--primary-dark);
            margin-bottom: var(--spacing-md);
        }

        .setting-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: var(--spacing-md) 0;
            border-bottom: 1px solid var(--border-color);
        }

        .setting-item:last-child {
            border-bottom: none;
        }

        .setting-label {
            display: flex;
            flex-direction: column;
            gap: var(--spacing-xs);
        }

        .setting-label-text {
            font-weight: 500;
            color: var(--text-dark);
        }

        .setting-label-desc {
            font-size: 0.875rem;
            color: var(--text-medium);
        }

        /* ===== Toggle Switch ===== */
        .toggle-switch {
            position: relative;
            width: 50px;
            height: 26px;
            background: var(--border-color);
            border-radius: 13px;
            cursor: pointer;
            transition: background var(--transition-fast);
        }

        .toggle-switch.active {
            background: var(--primary-green);
        }

        .toggle-switch::after {
            content: '';
            position: absolute;
            top: 3px;
            left: 3px;
            width: 20px;
            height: 20px;
            background: white;
            border-radius: 50%;
            transition: transform var(--transition-fast);
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
        }

        .toggle-switch.active::after {
            transform: translateX(24px);
        }

        /* ===== QR Code ===== */
        .qr-code-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: var(--spacing-md);
            padding: var(--spacing-lg);
            background: var(--background-light);
            border-radius: var(--border-radius);
        }

        .qr-code {
            width: 200px;
            height: 200px;
            background: white;
            padding: var(--spacing-md);
            border-radius: var(--border-radius-small);
            box-shadow: 0 5px 15px var(--shadow-color);
        }

        /* ===== Responsive Design ===== */
        @media (max-width: 1200px) {
            .dashboard-stats {
                grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            }

            .focus-view {
                width: 350px;
            }
        }

        @media (max-width: 768px) {
            .sidebar {
                transform: translateX(-100%);
            }

            .sidebar.mobile-open {
                transform: translateX(0);
            }

            .main-content {
                margin-left: 0;
                padding: var(--spacing-md);
            }

            .header {
                padding: 0 var(--spacing-md);
            }

            .inventory-grid {
                grid-template-columns: 1fr;
            }

            .focus-view {
                width: 100%;
            }

            .notification-container {
                right: var(--spacing-sm);
                left: var(--spacing-sm);
            }

            .mobile-menu-toggle {
                display: block;
            }
        }

        @media (max-width: 480px) {
            .dashboard-stats {
                grid-template-columns: 1fr;
            }

            .stat-value {
                font-size: 1.5rem;
            }

            .section-title {
                font-size: 1.25rem;
            }
        }

        /* ===== Print Styles ===== */
        @media print {
            .header,
            .sidebar,
            .focus-view,
            .notification-container,
            .btn,
            .modal {
                display: none !important;
            }

            .main-content {
                margin: 0;
                padding: 0;
            }

            .content-section {
                box-shadow: none;
                border: 1px solid #ddd;
                page-break-inside: avoid;
            }
        }

        /* ===== Utility Classes ===== */
        .hidden {
            display: none !important;
        }

        .text-center {
            text-align: center;
        }

        .text-right {
            text-align: right;
        }

        .mt-md {
            margin-top: var(--spacing-md);
        }

        .mb-md {
            margin-bottom: var(--spacing-md);
        }

        .flex {
            display: flex;
        }

        .flex-center {
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .gap-md {
            gap: var(--spacing-md);
        }

        /* ===== Loading Animation ===== */
        .skeleton {
            background: linear-gradient(90deg, var(--background-light) 25%, var(--border-color) 50%, var(--background-light) 75%);
            background-size: 200% 100%;
            animation: loading 1.5s infinite;
        }

        @keyframes loading {
            0% { background-position: 200% 0; }
            100% { background-position: -200% 0; }
        }

        /* ===== Tooltips ===== */
        .tooltip {
            position: relative;
        }

        .tooltip::after {
            content: attr(data-tooltip);
            position: absolute;
            bottom: 100%;
            left: 50%;
            transform: translateX(-50%);
            background: var(--text-dark);
            color: white;
            padding: var(--spacing-sm) var(--spacing-md);
            border-radius: var(--border-radius-small);
            font-size: 0.875rem;
            white-space: nowrap;
            opacity: 0;
            visibility: hidden;
            transition: all var(--transition-fast);
            pointer-events: none;
            margin-bottom: var(--spacing-sm);
        }

        .tooltip:hover::after {
            opacity: 1;
            visibility: visible;
        }

        /* Mobile Menu Toggle (hidden by default) */
        .mobile-menu-toggle {
            display: none;
            background: none;
            border: none;
            font-size: 1.5rem;
            color: var(--text-medium);
            cursor: pointer;
            padding: var(--spacing-sm);
        }
    </style>
</head>
<body>
    <!-- Loading Screen -->
    <div class="loading-screen" id="loadingScreen">
        <div class="loading-content">
            <div class="loading-spinner"></div>
            <h2>Smart Inventar Organizer Pro 2.0</h2>
            <p>Wird geladen...</p>
        </div>
    </div>

    <!-- Header -->
    <header class="header">
        <div class="header-content">
            <div class="flex-center gap-md">
                <button class="mobile-menu-toggle" id="mobileMenuToggle">‚ò∞</button>
                <div class="logo">
                    <div class="logo-icon">üì¶</div>
                    <span>Inventar Pro</span>
                </div>
            </div>
            <div class="header-actions">
                <button class="theme-toggle" id="themeToggle" aria-label="Theme umschalten">üåì</button>
                <button class="btn btn-primary" id="quickAddBtn">
                    <span>‚ûï</span>
                    <span>Schnell hinzuf√ºgen</span>
                </button>
            </div>
        </div>
    </header>

    <!-- Main App Container -->
    <div class="app-container">
        <!-- Sidebar Navigation -->
        <nav class="sidebar" id="sidebar">
            <div class="nav-item active" data-section="dashboard">
                <span class="nav-icon">üìä</span>
                <span class="nav-text">Dashboard</span>
            </div>
            <div class="nav-item" data-section="search">
                <span class="nav-icon">üîç</span>
                <span class="nav-text">Suche & Filter</span>
            </div>
            <div class="nav-item" data-section="inventory">
                <span class="nav-icon">üì¶</span>
                <span class="nav-text">Inventar</span>
            </div>
            <div class="nav-item" data-section="add">
                <span class="nav-icon">‚ûï</span>
                <span class="nav-text">Hinzuf√ºgen</span>
            </div>
            <div class="nav-item" data-section="planner">
                <span class="nav-icon">üè†</span>
                <span class="nav-text">Grundriss</span>
            </div>
            <div class="nav-item" data-section="voice">
                <span class="nav-icon">üé§</span>
                <span class="nav-text">Sprachsteuerung</span>
            </div>
            <div class="nav-item" data-section="analytics">
                <span class="nav-icon">üìà</span>
                <span class="nav-text">Analysen</span>
            </div>
            <div class="nav-item" data-section="maintenance">
                <span class="nav-icon">üîß</span>
                <span class="nav-text">Wartung</span>
            </div>
            <div class="nav-item" data-section="settings">
                <span class="nav-icon">‚öôÔ∏è</span>
                <span class="nav-text">Einstellungen</span>
            </div>
        </nav>

        <!-- Main Content Area -->
        <main class="main-content" id="mainContent">
            <!-- Dashboard Section -->
            <section class="content-section" id="dashboard-section">
                <div class="section-header">
                    <h2 class="section-title">Dashboard √úbersicht</h2>
                    <button class="btn btn-secondary" id="refreshDashboard">
                        <span>üîÑ</span>
                        <span>Aktualisieren</span>
                    </button>
                </div>

                <div class="dashboard-stats">
                    <div class="stat-card">
                        <div class="stat-header">
                            <div class="stat-icon">üì¶</div>
                            <span class="stat-trend">‚ÜóÔ∏è +12%</span>
                        </div>
                        <div class="stat-value" id="totalItems">0</div>
                        <div class="stat-label">Gegenst√§nde gesamt</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-header">
                            <div class="stat-icon">üè†</div>
                            <span class="stat-trend">‚Üí 0%</span>
                        </div>
                        <div class="stat-value" id="totalRooms">0</div>
                        <div class="stat-label">R√§ume</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-header">
                            <div class="stat-icon">üìÅ</div>
                            <span class="stat-trend">‚ÜóÔ∏è +5%</span>
                        </div>
                        <div class="stat-value" id="totalContainers">0</div>
                        <div class="stat-label">Container</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-header">
                            <div class="stat-icon">‚ö†Ô∏è</div>
                            <span class="stat-trend">‚ÜòÔ∏è -3%</span>
                        </div>
                        <div class="stat-value" id="lowStock">0</div>
                        <div class="stat-label">Niedriger Bestand</div>
                    </div>
                </div>

                <div class="content-section mt-md">
                    <h3 class="section-title">Zuletzt hinzugef√ºgt</h3>
                    <div class="inventory-grid" id="recentItems">
                        <!-- Recent items will be populated here -->
                    </div>
                </div>
            </section>

            <!-- Search Section -->
            <section class="content-section hidden" id="search-section">
                <div class="section-header">
                    <h2 class="section-title">Suche & Filter</h2>
                </div>

                <div class="search-container">
                    <span class="search-icon">üîç</span>
                    <input type="text" class="search-input" id="searchInput" placeholder="Suche nach Namen, ID oder Eigenschaften...">
                </div>

                <div class="filter-chips">
                    <div class="filter-chip" data-filter="all">Alle</div>
                    <div class="filter-chip" data-filter="low-stock">üî¥ Fast leer</div>
                    <div class="filter-chip" data-filter="full">üü¢ Voll</div>
                    <div class="filter-chip" data-filter="poor-condition">‚ö†Ô∏è Schlechter Zustand</div>
                    <div class="filter-chip" data-filter="low-battery">üîã Batterie schwach</div>
                </div>

                <div class="mt-md">
                    <h3>Kategorien</h3>
                    <div class="filter-chips" id="categoryFilters">
                        <!-- Category filters will be populated here -->
                    </div>
                </div>

                <div class="inventory-grid mt-md" id="searchResults">
                    <!-- Search results will be populated here -->
                </div>
            </section>

            <!-- Add Item Section -->
            <section class="content-section hidden" id="add-section">
                <div class="section-header">
                    <h2 class="section-title">Neuen Gegenstand hinzuf√ºgen</h2>
                </div>

                <form id="addItemForm">
                    <div class="form-group">
                        <label class="form-label">Foto hinzuf√ºgen</label>
                        <input type="file" id="itemPhoto" accept="image/*" class="form-input">
                        <div id="photoPreview" class="mt-md"></div>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Gegenstand *</label>
                        <input type="text" id="itemName" class="form-input" required placeholder="z.B. Akkuschrauber">
                    </div>

                    <div class="form-group">
                        <label class="form-label">Raum *</label>
                        <select id="itemRoom" class="form-select" required>
                            <option value="">Raum ausw√§hlen...</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label class="form-label">M√∂bel (optional)</label>
                        <input type="text" id="itemFurniture" class="form-input" placeholder="z.B. Werkbank">
                    </div>

                    <div class="form-group">
                        <label class="form-label">Container (optional)</label>
                        <input type="text" id="itemContainer" class="form-input" placeholder="z.B. Obere Schublade">
                    </div>

                    <div class="form-group">
                        <label class="form-label">Kategorie</label>
                        <div class="filter-chips" id="categorySelection">
                            <!-- Categories will be populated here -->
                        </div>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Eigenschaften</label>
                        <div id="propertySliders">
                            <!-- Property sliders will be populated here -->
                        </div>
                        <button type="button" class="btn btn-secondary mt-md" id="addPropertyBtn">
                            ‚ûï Eigene Eigenschaft hinzuf√ºgen
                        </button>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Notizen</label>
                        <textarea id="itemNotes" class="form-textarea" rows="3" placeholder="Zus√§tzliche Informationen..."></textarea>
                    </div>

                    <div class="flex gap-md">
                        <button type="submit" class="btn btn-primary">
                            <span>üíæ</span>
                            <span>Speichern</span>
                        </button>
                        <button type="button" class="btn btn-secondary" id="resetFormBtn">
                            <span>üîÑ</span>
                            <span>Zur√ºcksetzen</span>
                        </button>
                    </div>
                </form>
            </section>

            <!-- Inventory Section -->
            <section class="content-section hidden" id="inventory-section">
                <div class="section-header">
                    <h2 class="section-title">Inventar √úbersicht</h2>
                    <div class="flex gap-md">
                        <button class="btn btn-secondary" id="toggleTreeView">
                            <span>üå≥</span>
                            <span>Alle auf-/zuklappen</span>
                        </button>
                        <button class="btn btn-primary" id="exportInventory">
                            <span>üì§</span>
                            <span>Exportieren</span>
                        </button>
                    </div>
                </div>

                <div id="inventoryTree">
                    <!-- Inventory tree will be populated here -->
                </div>
            </section>

            <!-- Room Planner Section -->
            <section class="content-section hidden" id="planner-section">
                <div class="section-header">
                    <h2 class="section-title">Grundriss Editor</h2>
                    <select id="roomSelect" class="form-select" style="width: 200px;">
                        <option value="">Raum ausw√§hlen...</option>
                    </select>
                </div>

                <div class="canvas-container">
                    <canvas id="plannerCanvas" class="drawing-canvas"></canvas>
                    <div class="canvas-tools">
                        <button class="canvas-tool active" data-tool="draw" title="Zeichnen">‚úèÔ∏è</button>
                        <button class="canvas-tool" data-tool="item" title="Gegenstand platzieren">üì¶</button>
                        <button class="canvas-tool" data-tool="erase" title="L√∂schen">üóëÔ∏è</button>
                    </div>
                </div>
            </section>

            <!-- Voice Control Section -->
            <section class="content-section hidden" id="voice-section">
                <div class="section-header">
                    <h2 class="section-title">Sprachsteuerung</h2>
                </div>

                <div class="voice-control">
                    <button class="voice-button" id="voiceButton">
                        <span id="voiceIcon">üé§</span>
                    </button>
                    <div class="voice-status" id="voiceStatus">
                        Klicken Sie auf das Mikrofon oder sagen Sie "Hey Organizer"
                    </div>
                </div>

                <div class="content-section mt-md">
                    <h3>Verf√ºgbare Befehle</h3>
                    <ul>
                        <li>"Wo ist mein [Gegenstand]?" - Sucht nach einem Gegenstand</li>
                        <li>"Zeige mir alles in [Raum]" - Zeigt alle Gegenst√§nde in einem Raum</li>
                        <li>"Was ist fast leer?" - Zeigt Gegenst√§nde mit niedrigem F√ºllstand</li>
                        <li>"F√ºge [Gegenstand] hinzu" - Startet das Hinzuf√ºgen eines neuen Gegenstands</li>
                        <li>"Zeige Statistiken" - Zeigt Dashboard-Statistiken</li>
                    </ul>
                </div>
            </section>

            <!-- Analytics Section -->
            <section class="content-section hidden" id="analytics-section">
                <div class="section-header">
                    <h2 class="section-title">Analysen & Berichte</h2>
                    <button class="btn btn-primary" id="generateReport">
                        <span>üìä</span>
                        <span>Bericht erstellen</span>
                    </button>
                </div>

                <div class="dashboard-stats">
                    <div class="stat-card">
                        <div class="stat-header">
                            <div class="stat-icon">üìà</div>
                        </div>
                        <div class="stat-value" id="avgFillLevel">0%</div>
                        <div class="stat-label">Durchschn. F√ºllstand</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-header">
                            <div class="stat-icon">‚ö°</div>
                        </div>
                        <div class="stat-value" id="avgCondition">0%</div>
                        <div class="stat-label">Durchschn. Zustand</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-header">
                            <div class="stat-icon">üè∑Ô∏è</div>
                        </div>
                        <div class="stat-value" id="topCategory">-</div>
                        <div class="stat-label">H√§ufigste Kategorie</div>
                    </div>
                </div>

                <div class="content-section mt-md">
                    <h3>Kategorieverteilung</h3>
                    <div id="categoryChart">
                        <!-- Chart will be rendered here -->
                    </div>
                </div>
            </section>

            <!-- Maintenance Section -->
            <section class="content-section hidden" id="maintenance-section">
                <div class="section-header">
                    <h2 class="section-title">Wartung & Erinnerungen</h2>
                    <button class="btn btn-primary" id="addReminder">
                        <span>‚è∞</span>
                        <span>Erinnerung hinzuf√ºgen</span>
                    </button>
                </div>

                <div id="maintenanceItems">
                    <!-- Maintenance items will be populated here -->
                </div>
            </section>

            <!-- Settings Section -->
            <section class="content-section hidden" id="settings-section">
                <div class="section-header">
                    <h2 class="section-title">Einstellungen</h2>
                </div>

                <div class="settings-panel">
                    <div class="settings-group">
                        <h3 class="settings-group-title">Sprach-APIs</h3>

                        <div class="setting-item">
                            <div class="setting-label">
                                <span class="setting-label-text">Text-to-Speech API</span>
                                <span class="setting-label-desc">W√§hlen Sie die bevorzugte TTS-Engine</span>
                            </div>
                            <select class="form-select" id="ttsProvider" style="width: 200px;">
                                <option value="browser">Browser (Standard)</option>
                                <option value="google">Google Cloud TTS</option>
                                <option value="amazon">Amazon Polly</option>
                                <option value="azure">Azure Speech</option>
                            </select>
                        </div>

                        <div class="setting-item">
                            <div class="setting-label">
                                <span class="setting-label-text">Speech-to-Text API</span>
                                <span class="setting-label-desc">W√§hlen Sie die bevorzugte STT-Engine</span>
                            </div>
                            <select class="form-select" id="sttProvider" style="width: 200px;">
                                <option value="browser">Browser (Standard)</option>
                                <option value="google">Google Cloud STT</option>
                                <option value="azure">Azure Speech</option>
                                <option value="whisper">OpenAI Whisper</option>
                            </select>
                        </div>

                        <div class="setting-item">
                            <div class="setting-label">
                                <span class="setting-label-text">API Keys</span>
                                <span class="setting-label-desc">Konfigurieren Sie Ihre API-Schl√ºssel</span>
                            </div>
                            <button class="btn btn-secondary" id="configureAPIs">Konfigurieren</button>
                        </div>
                    </div>

                    <div class="settings-group">
                        <h3 class="settings-group-title">Audio-Einstellungen</h3>

                        <div class="setting-item">
                            <div class="setting-label">
                                <span class="setting-label-text">Wake Word aktivieren</span>
                                <span class="setting-label-desc">"Hey Organizer" zur Aktivierung</span>
                            </div>
                            <div class="toggle-switch" id="wakeWordToggle"></div>
                        </div>

                        <div class="setting-item">
                            <div class="setting-label">
                                <span class="setting-label-text">Sprechgeschwindigkeit</span>
                            </div>
                            <input type="range" class="form-input" id="speechRate" min="0.5" max="2" step="0.1" value="1">
                        </div>

                        <div class="setting-item">
                            <div class="setting-label">
                                <span class="setting-label-text">Lautst√§rke</span>
                            </div>
                            <input type="range" class="form-input" id="speechVolume" min="0" max="1" step="0.1" value="1">
                        </div>
                    </div>

                    <div class="settings-group">
                        <h3 class="settings-group-title">Datenmanagement</h3>

                        <div class="setting-item">
                            <div class="setting-label">
                                <span class="setting-label-text">Auto-Save</span>
                                <span class="setting-label-desc">Automatisches Speichern aktivieren</span>
                            </div>
                            <div class="toggle-switch active" id="autoSaveToggle"></div>
                        </div>

                        <div class="setting-item">
                            <div class="setting-label">
                                <span class="setting-label-text">IDs anzeigen</span>
                                <span class="setting-label-desc">Eindeutige IDs im Inventar anzeigen</span>
                            </div>
                            <div class="toggle-switch" id="showIDsToggle"></div>
                        </div>

                        <div class="setting-item">
                            <div class="setting-label">
                                <span class="setting-label-text">Daten exportieren</span>
                                <span class="setting-label-desc">Als JSON oder CSV exportieren</span>
                            </div>
                            <div class="flex gap-md">
                                <button class="btn btn-secondary" id="exportJSON">JSON</button>
                                <button class="btn btn-secondary" id="exportCSV">CSV</button>
                            </div>
                        </div>

                        <div class="setting-item">
                            <div class="setting-label">
                                <span class="setting-label-text">Daten importieren</span>
                                <span class="setting-label-desc">JSON oder CSV importieren</span>
                            </div>
                            <input type="file" class="form-input" id="importFile" accept=".json,.csv">
                        </div>

                        <div class="setting-item">
                            <div class="setting-label">
                                <span class="setting-label-text">Alle Daten l√∂schen</span>
                                <span class="setting-label-desc">Achtung: Diese Aktion kann nicht r√ºckg√§ngig gemacht werden!</span>
                            </div>
                            <button class="btn btn-danger" id="clearAllData">Alles l√∂schen</button>
                        </div>
                    </div>

                    <div class="settings-group">
                        <h3 class="settings-group-title">Kategorien & Eigenschaften</h3>

                        <div class="form-group">
                            <label class="form-label">Kategorien (eine pro Zeile)</label>
                            <textarea id="categoriesConfig" class="form-textarea" rows="5">üì± Elektronik
üîß Werkzeug
üëï Kleidung
üìö B√ºcher
üç¥ K√ºche
üéÆ Gaming
üè† Haushalt
üíä Medizin</textarea>
                        </div>

                        <div class="form-group">
                            <label class="form-label">Standard-Eigenschaften (eine pro Zeile)</label>
                            <textarea id="propertiesConfig" class="form-textarea" rows="5">F√ºllstand
Zustand
Batterie
Sauberkeit
Wichtigkeit</textarea>
                        </div>

                        <button class="btn btn-primary" id="saveConfig">
                            <span>üíæ</span>
                            <span>Konfiguration speichern</span>
                        </button>
                    </div>
                </div>
            </section>
        </main>

        <!-- Focus View Panel -->
        <aside class="focus-view" id="focusView">
            <div class="focus-header">
                <h3 id="focusTitle">Details</h3>
                <button class="focus-close" id="closeFocus">‚úï</button>
            </div>
            <div id="focusContent">
                <!-- Focus content will be populated here -->
            </div>
        </aside>
    </div>

    <!-- Modals -->
    <div class="modal" id="itemModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="modalTitle">Gegenstand Details</h3>
                <button class="modal-close" onclick="closeModal('itemModal')">‚úï</button>
            </div>
            <div id="modalContent">
                <!-- Modal content will be populated here -->
            </div>
        </div>
    </div>

    <!-- Notification Container -->
    <div class="notification-container" id="notificationContainer"></div>

    <!-- JavaScript -->
    <script>
        // ===== Smart Inventar Organizer Pro 2.0 - Enhanced JavaScript =====

        // App State Management
        const AppState = {
            inventory: [],
            rooms: [],
            categories: [],
            properties: [],
            settings: {
                theme: 'light',
                autoSave: true,
                showIDs: false,
                wakeWord: false,
                speechRate: 1,
                speechVolume: 1,
                ttsProvider: 'browser',
                sttProvider: 'browser',
                apiKeys: {}
            },
            currentSection: 'dashboard',
            focusedItem: null,
            speechRecognition: null,
            speechSynthesis: window.speechSynthesis,
            isListening: false,
            canvasData: {},
            filters: {
                search: '',
                category: null,
                conditions: []
            }
        };

        // ===== Initialization =====
        document.addEventListener('DOMContentLoaded', async () => {
            await initializeApp();
            hideLoadingScreen();
        });

        async function initializeApp() {
            loadDataFromStorage();
            setupEventListeners();
            initializeSpeechRecognition();
            updateDashboard();
            renderCurrentSection();

            // Load default categories and properties if not set
            if (AppState.categories.length === 0) {
                AppState.categories = [
                    'üì± Elektronik',
                    'üîß Werkzeug',
                    'üëï Kleidung',
                    'üìö B√ºcher',
                    'üç¥ K√ºche',
                    'üéÆ Gaming',
                    'üè† Haushalt',
                    'üíä Medizin'
                ];
            }

            if (AppState.properties.length === 0) {
                AppState.properties = [
                    'F√ºllstand',
                    'Zustand',
                    'Batterie',
                    'Sauberkeit',
                    'Wichtigkeit'
                ];
            }

            // Apply theme
            document.documentElement.setAttribute('data-theme', AppState.settings.theme);
        }

        function hideLoadingScreen() {
            const loadingScreen = document.getElementById('loadingScreen');
            loadingScreen.style.opacity = '0';
            setTimeout(() => {
                loadingScreen.style.display = 'none';
            }, 500);
        }

        // ===== Data Management =====
        function loadDataFromStorage() {
            try {
                const savedData = localStorage.getItem('inventarProData');
                if (savedData) {
                    const parsed = JSON.parse(savedData);
                    Object.assign(AppState, parsed);
                }
            } catch (error) {
                console.error('Error loading data:', error);
                showNotification('Fehler beim Laden der Daten', 'error');
            }
        }

        function saveDataToStorage() {
            try {
                localStorage.setItem('inventarProData', JSON.stringify(AppState));
                if (AppState.settings.autoSave) {
                    showNotification('Daten automatisch gespeichert', 'success');
                }
            } catch (error) {
                console.error('Error saving data:', error);
                showNotification('Fehler beim Speichern der Daten', 'error');
            }
        }

        // ===== Event Listeners Setup =====
        function setupEventListeners() {
            // Theme Toggle
            document.getElementById('themeToggle').addEventListener('click', toggleTheme);

            // Mobile Menu
            document.getElementById('mobileMenuToggle').addEventListener('click', toggleMobileMenu);

            // Navigation
            document.querySelectorAll('.nav-item').forEach(item => {
                item.addEventListener('click', () => navigateToSection(item.dataset.section));
            });

            // Quick Add Button
            document.getElementById('quickAddBtn').addEventListener('click', () => {
                navigateToSection('add');
            });

            // Add Item Form
            document.getElementById('addItemForm').addEventListener('submit', handleAddItem);
            document.getElementById('itemPhoto').addEventListener('change', handlePhotoUpload);
            document.getElementById('resetFormBtn').addEventListener('click', resetAddForm);
            document.getElementById('addPropertyBtn').addEventListener('click', addCustomProperty);

            // Search & Filters
            document.getElementById('searchInput').addEventListener('input', handleSearch);

            // Settings
            document.getElementById('wakeWordToggle').addEventListener('click', toggleWakeWord);
            document.getElementById('autoSaveToggle').addEventListener('click', toggleAutoSave);
            document.getElementById('showIDsToggle').addEventListener('click', toggleShowIDs);
            document.getElementById('speechRate').addEventListener('change', updateSpeechRate);
            document.getElementById('speechVolume').addEventListener('change', updateSpeechVolume);
            document.getElementById('ttsProvider').addEventListener('change', updateTTSProvider);
            document.getElementById('sttProvider').addEventListener('change', updateSTTProvider);
            document.getElementById('saveConfig').addEventListener('click', saveConfiguration);
            document.getElementById('exportJSON').addEventListener('click', exportJSON);
            document.getElementById('exportCSV').addEventListener('click', exportCSV);
            document.getElementById('importFile').addEventListener('change', handleImport);
            document.getElementById('clearAllData').addEventListener('click', clearAllData);

            // Voice Control
            document.getElementById('voiceButton').addEventListener('click', toggleVoiceControl);

            // Focus View
            document.getElementById('closeFocus').addEventListener('click', closeFocusView);

            // Canvas Tools
            document.querySelectorAll('.canvas-tool').forEach(tool => {
                tool.addEventListener('click', () => selectCanvasTool(tool.dataset.tool));
            });

            // Other buttons
            document.getElementById('refreshDashboard').addEventListener('click', updateDashboard);
            document.getElementById('toggleTreeView').addEventListener('click', toggleTreeView);
            document.getElementById('exportInventory').addEventListener('click', exportInventory);
            document.getElementById('generateReport').addEventListener('click', generateAnalyticsReport);
            document.getElementById('addReminder').addEventListener('click', addMaintenanceReminder);
            document.getElementById('configureAPIs').addEventListener('click', configureAPIs);

            // Auto-save on window close
            window.addEventListener('beforeunload', () => {
                if (AppState.settings.autoSave) {
                    saveDataToStorage();
                }
            });
        }

        // ===== Theme Management =====
        function toggleTheme() {
            const currentTheme = document.documentElement.getAttribute('data-theme');
            const newTheme = currentTheme === 'light' ? 'dark' : 'light';
            document.documentElement.setAttribute('data-theme', newTheme);
            AppState.settings.theme = newTheme;
            saveDataToStorage();
        }

        // ===== Navigation =====
        function navigateToSection(section) {
            // Update active nav item
            document.querySelectorAll('.nav-item').forEach(item => {
                item.classList.toggle('active', item.dataset.section === section);
            });

            // Hide all sections
            document.querySelectorAll('.content-section').forEach(sec => {
                sec.classList.add('hidden');
            });

            // Show selected section
            const sectionElement = document.getElementById(`${section}-section`);
            if (sectionElement) {
                sectionElement.classList.remove('hidden');
            }

            AppState.currentSection = section;

            // Section-specific initialization
            switch (section) {
                case 'dashboard':
                    updateDashboard();
                    break;
                case 'search':
                    initializeSearch();
                    break;
                case 'inventory':
                    renderInventoryTree();
                    break;
                case 'add':
                    initializeAddForm();
                    break;
                case 'planner':
                    initializePlanner();
                    break;
                case 'voice':
                    initializeVoiceControl();
                    break;
                case 'analytics':
                    renderAnalytics();
                    break;
                case 'maintenance':
                    renderMaintenance();
                    break;
                case 'settings':
                    renderSettings();
                    break;
            }

            // Close mobile menu if open
            closeMobileMenu();
        }

        function renderCurrentSection() {
            navigateToSection(AppState.currentSection);
        }

        // ===== Mobile Menu =====
        function toggleMobileMenu() {
            const sidebar = document.getElementById('sidebar');
            sidebar.classList.toggle('mobile-open');
        }

        function closeMobileMenu() {
            const sidebar = document.getElementById('sidebar');
            sidebar.classList.remove('mobile-open');
        }

        // ===== Dashboard Functions =====
        function updateDashboard() {
            // Update statistics
            document.getElementById('totalItems').textContent = AppState.inventory.length;
            document.getElementById('totalRooms').textContent = new Set(AppState.inventory.map(item => item.room)).size;
            document.getElementById('totalContainers').textContent = new Set(AppState.inventory.map(item => `${item.room}-${item.furniture}-${item.container}`).filter(c => c !== '--')).size;

            // Calculate low stock items
            const lowStock = AppState.inventory.filter(item => {
                const fillLevel = item.properties?.['F√ºllstand'] || 100;
                return fillLevel < 20;
            }).length;
            document.getElementById('lowStock').textContent = lowStock;

            // Show recent items
            renderRecentItems();
        }

        function renderRecentItems() {
            const container = document.getElementById('recentItems');
            container.innerHTML = '';

            const recentItems = AppState.inventory.slice(-4).reverse();

            recentItems.forEach(item => {
                const itemCard = createInventoryCard(item);
                container.appendChild(itemCard);
            });
        }

        // ===== Inventory Management =====
        function generateItemId() {
            const timestamp = Date.now();
            const random = Math.floor(Math.random() * 1000);
            return `ITM-${timestamp}-${random}`;
        }

        function handleAddItem(e) {
            e.preventDefault();

            const formData = {
                id: generateItemId(),
                name: document.getElementById('itemName').value,
                room: document.getElementById('itemRoom').value,
                furniture: document.getElementById('itemFurniture').value || null,
                container: document.getElementById('itemContainer').value || null,
                category: document.querySelector('.filter-chip.active[data-category]')?.dataset.category || 'Sonstiges',
                photo: document.getElementById('photoPreview').querySelector('img')?.src || null,
                notes: document.getElementById('itemNotes').value,
                properties: {},
                dateAdded: new Date().toISOString(),
                lastModified: new Date().toISOString()
            };

            // Collect property values
            document.querySelectorAll('.property-slider').forEach(slider => {
                const propertyName = slider.dataset.property;
                formData.properties[propertyName] = parseInt(slider.value);
            });

            // Add to inventory
            AppState.inventory.push(formData);

            // Save and notify
            saveDataToStorage();
            showNotification(`${formData.name} wurde hinzugef√ºgt!`, 'success');

            // Reset form
            resetAddForm();

            // Update dashboard if visible
            if (AppState.currentSection === 'dashboard') {
                updateDashboard();
            }

            // Generate QR code for the item
            generateQRCode(formData.id);
        }

        function resetAddForm() {
            document.getElementById('addItemForm').reset();
            document.getElementById('photoPreview').innerHTML = '';
            document.querySelectorAll('.filter-chip.active').forEach(chip => {
                chip.classList.remove('active');
            });
        }

        function handlePhotoUpload(e) {
            const file = e.target.files[0];
            if (file && file.type.startsWith('image/')) {
                const reader = new FileReader();
                reader.onload = (event) => {
                    const preview = document.getElementById('photoPreview');
                    preview.innerHTML = `<img src="${event.target.result}" style="max-width: 200px; max-height: 200px; border-radius: 8px;">`;
                };
                reader.readAsDataURL(file);
            }
        }

        function createInventoryCard(item) {
            const card = document.createElement('div');
            card.className = 'inventory-item';
            card.onclick = () => showItemDetails(item);

            const photoHtml = item.photo
                ? `<img src="${item.photo}" alt="${item.name}" class="item-image">`
                : `<div class="item-image flex-center" style="background: var(--background-light); color: var(--text-medium);">üì¶</div>`;

            const idHtml = AppState.settings.showIDs ? `<small style="color: var(--text-medium);">${item.id}</small>` : '';

            const propertiesHtml = Object.entries(item.properties || {}).map(([key, value]) => {
                const percentage = value;
                const color = percentage < 30 ? 'var(--error-color)' : percentage < 70 ? 'var(--warning-color)' : 'var(--success-color)';
                return `
                    <div style="margin-top: 8px;">
                        <div style="display: flex; justify-content: space-between; font-size: 0.875rem; margin-bottom: 4px;">
                            <span>${key}</span>
                            <span style="color: ${color}; font-weight: 600;">${percentage}%</span>
                        </div>
                        <div class="progress-bar">
                            <div class="progress-fill" style="width: ${percentage}%; background: ${color};"></div>
                        </div>
                    </div>
                `;
            }).join('');

            card.innerHTML = `
                ${photoHtml}
                <div class="item-name">${item.name} ${idHtml}</div>
                <div class="item-location">
                    <span>üìç</span>
                    <span>${item.room}${item.furniture ? ' ‚Ä∫ ' + item.furniture : ''}${item.container ? ' ‚Ä∫ ' + item.container : ''}</span>
                </div>
                <div class="property-badge" style="background: var(--primary-light); color: var(--primary-dark);">
                    ${item.category}
                </div>
                ${propertiesHtml}
            `;

            return card;
        }

        function showItemDetails(item) {
            const modal = document.getElementById('itemModal');
            const modalTitle = document.getElementById('modalTitle');
            const modalContent = document.getElementById('modalContent');

            modalTitle.textContent = item.name;

            const photoHtml = item.photo
                ? `<img src="${item.photo}" alt="${item.name}" style="width: 100%; max-height: 300px; object-fit: cover; border-radius: 8px; margin-bottom: 20px;">`
                : '';

            const propertiesHtml = Object.entries(item.properties || {}).map(([key, value]) => {
                return `
                    <div class="form-group">
                        <label class="form-label">${key}: ${value}%</label>
                        <input type="range" class="form-input property-editor" data-property="${key}" value="${value}" min="0" max="100">
                        <div class="progress-bar mt-md">
                            <div class="progress-fill" style="width: ${value}%;"></div>
                        </div>
                    </div>
                `;
            }).join('');

            modalContent.innerHTML = `
                ${photoHtml}
                <div class="form-group">
                    <label class="form-label">ID</label>
                    <input type="text" class="form-input" value="${item.id}" readonly>
                </div>
                <div class="form-group">
                    <label class="form-label">Standort</label>
                    <input type="text" class="form-input" value="${item.room}${item.furniture ? ' ‚Ä∫ ' + item.furniture : ''}${item.container ? ' ‚Ä∫ ' + item.container : ''}" readonly>
                </div>
                <div class="form-group">
                    <label class="form-label">Kategorie</label>
                    <input type="text" class="form-input" value="${item.category}" readonly>
                </div>
                ${propertiesHtml}
                <div class="form-group">
                    <label class="form-label">Notizen</label>
                    <textarea class="form-textarea" rows="3">${item.notes || ''}</textarea>
                </div>
                <div class="form-group">
                    <label class="form-label">Hinzugef√ºgt am</label>
                    <input type="text" class="form-input" value="${new Date(item.dateAdded).toLocaleString('de-DE')}" readonly>
                </div>
                <div class="flex gap-md">
                    <button class="btn btn-primary" onclick="updateItem('${item.id}')">
                        <span>üíæ</span>
                        <span>Speichern</span>
                    </button>
                    <button class="btn btn-secondary" onclick="openFocusView('${item.id}')">
                        <span>üîç</span>
                        <span>Im Fokus √∂ffnen</span>
                    </button>
                    <button class="btn btn-secondary" onclick="generateItemQR('${item.id}')">
                        <span>üì±</span>
                        <span>QR-Code</span>
                    </button>
                    <button class="btn btn-danger" onclick="deleteItem('${item.id}')">
                        <span>üóëÔ∏è</span>
                        <span>L√∂schen</span>
                    </button>
                </div>
            `;

            // Setup property sliders
            modalContent.querySelectorAll('.property-editor').forEach(slider => {
                slider.addEventListener('input', (e) => {
                    const fill = e.target.parentElement.querySelector('.progress-fill');
                    fill.style.width = e.target.value + '%';
                });
            });

            modal.classList.add('active');
        }

        function updateItem(itemId) {
            const item = AppState.inventory.find(i => i.id === itemId);
            if (!item) return;

            // Update properties from modal
            document.querySelectorAll('.property-editor').forEach(slider => {
                const property = slider.dataset.property;
                item.properties[property] = parseInt(slider.value);
            });

            // Update notes
            const notesTextarea = document.querySelector('#modalContent textarea');
            if (notesTextarea) {
                item.notes = notesTextarea.value;
            }

            item.lastModified = new Date().toISOString();

            saveDataToStorage();
            showNotification('Gegenstand aktualisiert!', 'success');
            closeModal('itemModal');

            // Refresh current view
            renderCurrentSection();
        }

        function deleteItem(itemId) {
            if (confirm('M√∂chten Sie diesen Gegenstand wirklich l√∂schen?')) {
                AppState.inventory = AppState.inventory.filter(i => i.id !== itemId);
                saveDataToStorage();
                showNotification('Gegenstand gel√∂scht!', 'success');
                closeModal('itemModal');
                renderCurrentSection();
            }
        }

        // ===== Search & Filter Functions =====
        function initializeSearch() {
            renderCategoryFilters();
            handleSearch();
        }

        function renderCategoryFilters() {
            const container = document.getElementById('categoryFilters');
            container.innerHTML = '';

            // Get unique categories from inventory
            const categories = [...new Set(AppState.inventory.map(item => item.category))];

            categories.forEach(category => {
                const chip = document.createElement('div');
                chip.className = 'filter-chip';
                chip.dataset.filterCategory = category;
                chip.textContent = category;
                chip.onclick = () => toggleCategoryFilter(category);
                container.appendChild(chip);
            });
        }

        function toggleCategoryFilter(category) {
            const chip = document.querySelector(`[data-filter-category="${category}"]`);
            chip.classList.toggle('active');
            handleSearch();
        }

        function handleSearch() {
            const searchTerm = document.getElementById('searchInput').value.toLowerCase();
            const activeFilters = document.querySelectorAll('.filter-chip.active[data-filter]');
            const activeCategories = Array.from(document.querySelectorAll('.filter-chip.active[data-filter-category]'))
                .map(chip => chip.dataset.filterCategory);

            let results = AppState.inventory;

            // Apply search term
            if (searchTerm) {
                results = results.filter(item => {
                    return item.name.toLowerCase().includes(searchTerm) ||
                           item.room.toLowerCase().includes(searchTerm) ||
                           item.id.toLowerCase().includes(searchTerm) ||
                           (item.notes && item.notes.toLowerCase().includes(searchTerm));
                });
            }

            // Apply category filters
            if (activeCategories.length > 0) {
                results = results.filter(item => activeCategories.includes(item.category));
            }

            // Apply condition filters
            activeFilters.forEach(filter => {
                const filterType = filter.dataset.filter;
                switch (filterType) {
                    case 'low-stock':
                        results = results.filter(item => (item.properties?.['F√ºllstand'] || 100) < 20);
                        break;
                    case 'full':
                        results = results.filter(item => (item.properties?.['F√ºllstand'] || 100) > 80);
                        break;
                    case 'poor-condition':
                        results = results.filter(item => (item.properties?.['Zustand'] || 100) < 30);
                        break;
                    case 'low-battery':
                        results = results.filter(item => (item.properties?.['Batterie'] || 100) < 25);
                        break;
                }
            });

            renderSearchResults(results);
        }

        function renderSearchResults(results) {
            const container = document.getElementById('searchResults');
            container.innerHTML = '';

            if (results.length === 0) {
                container.innerHTML = '<p style="text-align: center; color: var(--text-medium);">Keine Ergebnisse gefunden</p>';
                return;
            }

            results.forEach(item => {
                const card = createInventoryCard(item);
                container.appendChild(card);
            });
        }

        // Setup filter chip listeners
        document.addEventListener('DOMContentLoaded', () => {
            document.querySelectorAll('.filter-chip[data-filter]').forEach(chip => {
                chip.addEventListener('click', () => {
                    chip.classList.toggle('active');
                    handleSearch();
                });
            });
        });

        // ===== Inventory Tree View =====
        function renderInventoryTree() {
            const container = document.getElementById('inventoryTree');
            container.innerHTML = '';

            // Group items by room
            const roomGroups = {};
            AppState.inventory.forEach(item => {
                if (!roomGroups[item.room]) {
                    roomGroups[item.room] = {
                        furniture: {}
                    };
                }

                const furnitureKey = item.furniture || 'Ohne M√∂bel';
                if (!roomGroups[item.room].furniture[furnitureKey]) {
                    roomGroups[item.room].furniture[furnitureKey] = {
                        containers: {}
                    };
                }

                const containerKey = item.container || 'Ohne Container';
                if (!roomGroups[item.room].furniture[furnitureKey].containers[containerKey]) {
                    roomGroups[item.room].furniture[furnitureKey].containers[containerKey] = [];
                }

                roomGroups[item.room].furniture[furnitureKey].containers[containerKey].push(item);
            });

            // Render tree structure
            Object.entries(roomGroups).forEach(([roomName, roomData]) => {
                const roomElement = createTreeNode(roomName, 'room', 'üè†');

                Object.entries(roomData.furniture).forEach(([furnitureName, furnitureData]) => {
                    if (furnitureName !== 'Ohne M√∂bel') {
                        const furnitureElement = createTreeNode(furnitureName, 'furniture', 'ü™ë');

                        Object.entries(furnitureData.containers).forEach(([containerName, items]) => {
                            if (containerName !== 'Ohne Container') {
                                const containerElement = createTreeNode(containerName, 'container', 'üìÅ');

                                items.forEach(item => {
                                    const itemElement = createTreeItem(item);
                                    containerElement.querySelector('.tree-children').appendChild(itemElement);
                                });

                                furnitureElement.querySelector('.tree-children').appendChild(containerElement);
                            } else {
                                items.forEach(item => {
                                    const itemElement = createTreeItem(item);
                                    furnitureElement.querySelector('.tree-children').appendChild(itemElement);
                                });
                            }
                        });

                        roomElement.querySelector('.tree-children').appendChild(furnitureElement);
                    } else {
                        Object.entries(furnitureData.containers).forEach(([containerName, items]) => {
                            items.forEach(item => {
                                const itemElement = createTreeItem(item);
                                roomElement.querySelector('.tree-children').appendChild(itemElement);
                            });
                        });
                    }
                });

                container.appendChild(roomElement);
            });
        }

        function createTreeNode(name, type, icon) {
            const node = document.createElement('div');
            node.className = 'tree-node';
            node.innerHTML = `
                <div class="tree-header" onclick="toggleTreeNode(this)" style="
                    padding: 12px;
                    background: var(--background-light);
                    border-radius: 8px;
                    margin-bottom: 8px;
                    cursor: pointer;
                    display: flex;
                    align-items: center;
                    gap: 8px;
                    transition: all 0.2s;
                ">
                    <span class="tree-toggle">‚ñ∂</span>
                    <span>${icon}</span>
                    <span style="font-weight: 600;">${name}</span>
                    <button class="btn btn-secondary" style="margin-left: auto; padding: 4px 12px; font-size: 0.875rem;" onclick="event.stopPropagation(); openFocusView('${type}', '${name}')">
                        Fokus
                    </button>
                </div>
                <div class="tree-children" style="margin-left: 24px; display: none;">
                </div>
            `;
            return node;
        }

        function createTreeItem(item) {
            const element = document.createElement('div');
            element.className = 'tree-item';
            element.style.cssText = `
                padding: 8px 12px;
                background: var(--background-white);
                border: 1px solid var(--border-color);
                border-radius: 6px;
                margin-bottom: 4px;
                cursor: pointer;
                transition: all 0.2s;
                display: flex;
                align-items: center;
                gap: 8px;
            `;

            const categoryIcon = item.category.split(' ')[0] || 'üì¶';

            element.innerHTML = `
                <span>${categoryIcon}</span>
                <span>${item.name}</span>
                ${AppState.settings.showIDs ? `<small style="color: var(--text-medium); margin-left: auto;">${item.id}</small>` : ''}
            `;

            element.onclick = () => showItemDetails(item);

            element.onmouseover = () => {
                element.style.background = 'var(--background-light)';
                element.style.borderColor = 'var(--primary-green)';
            };

            element.onmouseout = () => {
                element.style.background = 'var(--background-white)';
                element.style.borderColor = 'var(--border-color)';
            };

            return element;
        }

        function toggleTreeNode(header) {
            const toggle = header.querySelector('.tree-toggle');
            const children = header.nextElementSibling;

            if (children.style.display === 'none') {
                children.style.display = 'block';
                toggle.style.transform = 'rotate(90deg)';
            } else {
                children.style.display = 'none';
                toggle.style.transform = 'rotate(0deg)';
            }
        }

        function toggleTreeView() {
            const allChildren = document.querySelectorAll('.tree-children');
            const allToggles = document.querySelectorAll('.tree-toggle');
            const isAnyOpen = Array.from(allChildren).some(child => child.style.display !== 'none');

            allChildren.forEach(child => {
                child.style.display = isAnyOpen ? 'none' : 'block';
            });

            allToggles.forEach(toggle => {
                toggle.style.transform = isAnyOpen ? 'rotate(0deg)' : 'rotate(90deg)';
            });
        }

        // ===== Form Initialization =====
        function initializeAddForm() {
            // Populate room select
            const roomSelect = document.getElementById('itemRoom');
            roomSelect.innerHTML = '<option value="">Raum ausw√§hlen...</option>';

            const rooms = [...new Set(AppState.inventory.map(item => item.room))];
            rooms.forEach(room => {
                const option = document.createElement('option');
                option.value = room;
                option.textContent = room;
                roomSelect.appendChild(option);
            });

            // Add option to create new room
            const newRoomOption = document.createElement('option');
            newRoomOption.value = '__new__';
            newRoomOption.textContent = '+ Neuer Raum';
            roomSelect.appendChild(newRoomOption);

            roomSelect.addEventListener('change', (e) => {
                if (e.target.value === '__new__') {
                    const newRoom = prompt('Name des neuen Raums:');
                    if (newRoom && newRoom.trim()) {
                        const option = document.createElement('option');
                        option.value = newRoom;
                        option.textContent = newRoom;
                        roomSelect.insertBefore(option, roomSelect.lastElementChild);
                        roomSelect.value = newRoom;
                    } else {
                        roomSelect.value = '';
                    }
                }
            });

            // Render category selection
            renderCategorySelection();

            // Render property sliders
            renderPropertySliders();
        }

        function renderCategorySelection() {
            const container = document.getElementById('categorySelection');
            container.innerHTML = '';

            AppState.categories.forEach(category => {
                const chip = document.createElement('div');
                chip.className = 'filter-chip';
                chip.dataset.category = category;
                chip.textContent = category;
                chip.onclick = () => selectCategory(chip);
                container.appendChild(chip);
            });
        }

        function selectCategory(chip) {
            document.querySelectorAll('#categorySelection .filter-chip').forEach(c => {
                c.classList.remove('active');
            });
            chip.classList.add('active');
        }

        function renderPropertySliders() {
            const container = document.getElementById('propertySliders');
            container.innerHTML = '';

            AppState.properties.forEach(property => {
                const group = document.createElement('div');
                group.className = 'form-group';
                group.innerHTML = `
                    <label class="form-label">${property}: <span id="${property}-value">50</span>%</label>
                    <input type="range" class="form-input property-slider" data-property="${property}"
                           min="0" max="100" value="50" oninput="updateSliderValue('${property}', this.value)">
                    <div class="progress-bar">
                        <div class="progress-fill" id="${property}-fill" style="width: 50%;"></div>
                    </div>
                `;
                container.appendChild(group);
            });
        }

        function updateSliderValue(property, value) {
            document.getElementById(`${property}-value`).textContent = value;
            document.getElementById(`${property}-fill`).style.width = value + '%';
        }

        function addCustomProperty() {
            const propertyName = prompt('Name der neuen Eigenschaft:');
            if (propertyName && propertyName.trim() && !AppState.properties.includes(propertyName)) {
                AppState.properties.push(propertyName);
                renderPropertySliders();
                saveDataToStorage();
                showNotification(`Eigenschaft "${propertyName}" hinzugef√ºgt!`, 'success');
            }
        }

        // ===== Room Planner Functions =====
        function initializePlanner() {
            const roomSelect = document.getElementById('roomSelect');
            roomSelect.innerHTML = '<option value="">Raum ausw√§hlen...</option>';

            const rooms = [...new Set(AppState.inventory.map(item => item.room))];
            rooms.forEach(room => {
                const option = document.createElement('option');
                option.value = room;
                option.textContent = room;
                roomSelect.appendChild(option);
            });

            roomSelect.addEventListener('change', loadRoomCanvas);

            // Initialize canvas
            initializeCanvas();
        }

        let canvas, ctx, isDrawing = false, currentTool = 'draw';

        function initializeCanvas() {
            canvas = document.getElementById('plannerCanvas');
            ctx = canvas.getContext('2d');

            // Set canvas size
            const container = canvas.parentElement;
            canvas.width = container.offsetWidth;
            canvas.height = container.offsetHeight;

            // Canvas events
            canvas.addEventListener('mousedown', startDrawing);
            canvas.addEventListener('mousemove', draw);
            canvas.addEventListener('mouseup', stopDrawing);
            canvas.addEventListener('mouseout', stopDrawing);

            // Touch events for mobile
            canvas.addEventListener('touchstart', handleTouch);
            canvas.addEventListener('touchmove', handleTouch);
            canvas.addEventListener('touchend', stopDrawing);
        }

        function selectCanvasTool(tool) {
            currentTool = tool;
            document.querySelectorAll('.canvas-tool').forEach(t => {
                t.classList.toggle('active', t.dataset.tool === tool);
            });

            canvas.style.cursor = tool === 'draw' ? 'crosshair' :
                               tool === 'item' ? 'pointer' :
                               'not-allowed';
        }

        function startDrawing(e) {
            if (currentTool !== 'draw') return;

            isDrawing = true;
            const rect = canvas.getBoundingClientRect();
            ctx.beginPath();
            ctx.moveTo(e.clientX - rect.left, e.clientY - rect.top);
        }

        function draw(e) {
            if (!isDrawing || currentTool !== 'draw') return;

            const rect = canvas.getBoundingClientRect();
            ctx.lineTo(e.clientX - rect.left, e.clientY - rect.top);
            ctx.strokeStyle = getComputedStyle(document.documentElement).getPropertyValue('--primary-green');
            ctx.lineWidth = 3;
            ctx.lineCap = 'round';
            ctx.stroke();
        }

        function stopDrawing() {
            if (isDrawing) {
                isDrawing = false;
                saveCanvasData();
            }
        }

        function handleTouch(e) {
            e.preventDefault();
            const touch = e.touches[0];
            const mouseEvent = new MouseEvent(e.type === 'touchstart' ? 'mousedown' :
                                            e.type === 'touchmove' ? 'mousemove' : 'mouseup', {
                clientX: touch.clientX,
                clientY: touch.clientY
            });
            canvas.dispatchEvent(mouseEvent);
        }

        function saveCanvasData() {
            const roomSelect = document.getElementById('roomSelect');
            const room = roomSelect.value;
            if (room) {
                AppState.canvasData[room] = canvas.toDataURL();
                saveDataToStorage();
            }
        }

        function loadRoomCanvas() {
            const roomSelect = document.getElementById('roomSelect');
            const room = roomSelect.value;

            // Clear canvas
            ctx.clearRect(0, 0, canvas.width, canvas.height);

            if (room && AppState.canvasData[room]) {
                const img = new Image();
                img.onload = () => {
                    ctx.drawImage(img, 0, 0);
                };
                img.src = AppState.canvasData[room];
            }
        }

        canvas?.addEventListener('click', (e) => {
            if (currentTool === 'item') {
                const rect = canvas.getBoundingClientRect();
                const x = e.clientX - rect.left;
                const y = e.clientY - rect.top;

                const itemName = prompt('Name des Gegenstands:');
                if (itemName) {
                    // Draw item marker
                    ctx.fillStyle = getComputedStyle(document.documentElement).getPropertyValue('--error-color');
                    ctx.beginPath();
                    ctx.arc(x, y, 8, 0, 2 * Math.PI);
                    ctx.fill();

                    // Draw item name
                    ctx.fillStyle = getComputedStyle(document.documentElement).getPropertyValue('--text-dark');
                    ctx.font = '14px sans-serif';
                    ctx.fillText(itemName, x + 12, y + 5);

                    saveCanvasData();
                }
            } else if (currentTool === 'erase') {
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                saveCanvasData();
            }
        });

        // ===== Voice Control Functions =====
        function initializeSpeechRecognition() {
            if ('webkitSpeechRecognition' in window || 'SpeechRecognition' in window) {
                const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
                AppState.speechRecognition = new SpeechRecognition();

                AppState.speechRecognition.continuous = false;
                AppState.speechRecognition.interimResults = false;
                AppState.speechRecognition.lang = 'de-DE';

                AppState.speechRecognition.onstart = () => {
                    AppState.isListening = true;
                    updateVoiceUI('listening');
                };

                AppState.speechRecognition.onresult = (event) => {
                    const transcript = event.results[0][0].transcript;
                    processVoiceCommand(transcript);
                };

                AppState.speechRecognition.onerror = (event) => {
                    console.error('Speech recognition error:', event.error);
                    updateVoiceUI('error');
                    showNotification('Spracherkennung fehlgeschlagen', 'error');
                };

                AppState.speechRecognition.onend = () => {
                    AppState.isListening = false;
                    updateVoiceUI('ready');
                };

                // Initialize wake word detection if enabled
                if (AppState.settings.wakeWord) {
                    startWakeWordDetection();
                }
            } else {
                console.warn('Speech recognition not supported');
                showNotification('Spracherkennung wird nicht unterst√ºtzt', 'warning');
            }
        }

        function initializeVoiceControl() {
            // Voice control is initialized on app start
        }

        function toggleVoiceControl() {
            if (AppState.isListening) {
                AppState.speechRecognition.stop();
            } else {
                AppState.speechRecognition.start();
            }
        }

        function updateVoiceUI(status) {
            const button = document.getElementById('voiceButton');
            const statusText = document.getElementById('voiceStatus');
            const icon = document.getElementById('voiceIcon');

            switch (status) {
                case 'listening':
                    button.classList.add('listening');
                    button.style.background = 'linear-gradient(135deg, #e63946, #d62828)';
                    icon.textContent = 'üî¥';
                    statusText.textContent = 'Ich h√∂re zu...';
                    break;
                case 'processing':
                    button.classList.remove('listening');
                    button.classList.add('processing');
                    button.style.background = 'linear-gradient(135deg, #f77f00, #fcbf49)';
                    icon.textContent = '‚ö°';
                    statusText.textContent = 'Verarbeite Befehl...';
                    break;
                case 'speaking':
                    button.classList.remove('processing');
                    button.style.background = 'linear-gradient(135deg, #06ffa5, #00b4d8)';
                    icon.textContent = 'üîä';
                    statusText.textContent = 'Antwort wird gesprochen...';
                    break;
                case 'error':
                    button.classList.remove('listening', 'processing');
                    button.style.background = 'linear-gradient(135deg, var(--primary-green), var(--accent-green))';
                    icon.textContent = 'üé§';
                    statusText.textContent = 'Fehler bei der Spracherkennung';
                    break;
                default:
                    button.classList.remove('listening', 'processing');
                    button.style.background = 'linear-gradient(135deg, var(--primary-green), var(--accent-green))';
                    icon.textContent = 'üé§';
                    statusText.textContent = 'Klicken Sie auf das Mikrofon oder sagen Sie "Hey Organizer"';
            }
        }

        function processVoiceCommand(command) {
            updateVoiceUI('processing');

            const lowerCommand = command.toLowerCase();
            let response = '';
            let action = null;

            // Search commands
            if (lowerCommand.includes('wo ist') || lowerCommand.includes('finde')) {
                const searchTerm = lowerCommand.replace(/(wo ist|finde|mein|meine|der|die|das)/g, '').trim();
                const results = AppState.inventory.filter(item =>
                    item.name.toLowerCase().includes(searchTerm)
                );

                if (results.length > 0) {
                    response = `Ich habe ${results.length} ${results.length === 1 ? 'Ergebnis' : 'Ergebnisse'} gefunden. `;
                    response += results.map(item =>
                        `${item.name} ist in ${item.room}${item.furniture ? ', ' + item.furniture : ''}${item.container ? ', ' + item.container : ''}`
                    ).join('. ');

                    action = () => {
                        navigateToSection('search');
                        document.getElementById('searchInput').value = searchTerm;
                        handleSearch();
                    };
                } else {
                    response = `Ich konnte "${searchTerm}" nicht finden.`;
                }
            }
            // Show room contents
            else if (lowerCommand.includes('zeige') && lowerCommand.includes('in')) {
                const room = lowerCommand.split('in')[1].trim();
                const items = AppState.inventory.filter(item =>
                    item.room.toLowerCase().includes(room)
                );

                if (items.length > 0) {
                    response = `In ${room} befinden sich ${items.length} Gegenst√§nde.`;
                    action = () => {
                        navigateToSection('inventory');
                        // Focus on room
                    };
                } else {
                    response = `Ich konnte keinen Raum "${room}" finden.`;
                }
            }
            // Status queries
            else if (lowerCommand.includes('was ist fast leer') || lowerCommand.includes('niedriger bestand')) {
                const lowStock = AppState.inventory.filter(item =>
                    (item.properties?.['F√ºllstand'] || 100) < 20
                );

                if (lowStock.length > 0) {
                    response = `${lowStock.length} ${lowStock.length === 1 ? 'Gegenstand ist' : 'Gegenst√§nde sind'} fast leer: `;
                    response += lowStock.map(item => item.name).join(', ');

                    action = () => {
                        navigateToSection('search');
                        document.querySelector('[data-filter="low-stock"]').click();
                    };
                } else {
                    response = 'Alle Gegenst√§nde haben ausreichenden Bestand.';
                }
            }
            // Add item
            else if (lowerCommand.includes('f√ºge') && lowerCommand.includes('hinzu')) {
                response = 'Ich √∂ffne das Hinzuf√ºgen-Formular f√ºr Sie.';
                action = () => navigateToSection('add');
            }
            // Show statistics
            else if (lowerCommand.includes('statistik') || lowerCommand.includes('√ºbersicht')) {
                const stats = {
                    items: AppState.inventory.length,
                    rooms: new Set(AppState.inventory.map(item => item.room)).size,
                    lowStock: AppState.inventory.filter(item => (item.properties?.['F√ºllstand'] || 100) < 20).length
                };

                response = `Sie haben ${stats.items} Gegenst√§nde in ${stats.rooms} R√§umen. `;
                if (stats.lowStock > 0) {
                    response += `${stats.lowStock} ${stats.lowStock === 1 ? 'Gegenstand hat' : 'Gegenst√§nde haben'} niedrigen Bestand.`;
                }

                action = () => navigateToSection('dashboard');
            }
            else {
                response = 'Entschuldigung, ich habe den Befehl nicht verstanden. Sie k√∂nnen zum Beispiel sagen: "Wo ist mein Hammer?" oder "Zeige Statistiken".';
            }

            // Speak response
            speak(response, () => {
                if (action) action();
            });
        }

        function speak(text, callback) {
            updateVoiceUI('speaking');

            const utterance = new SpeechSynthesisUtterance(text);
            utterance.lang = 'de-DE';
            utterance.rate = AppState.settings.speechRate;
            utterance.volume = AppState.settings.speechVolume;

            utterance.onend = () => {
                updateVoiceUI('ready');
                if (callback) callback();
            };

            AppState.speechSynthesis.speak(utterance);
        }

        function startWakeWordDetection() {
            // Simple wake word detection using continuous recognition
            // In a real app, you'd use a dedicated wake word detection library
            if (AppState.settings.wakeWord && AppState.speechRecognition) {
                const wakeRecognition = new (window.SpeechRecognition || window.webkitSpeechRecognition)();
                wakeRecognition.continuous = true;
                wakeRecognition.interimResults = false;
                wakeRecognition.lang = 'de-DE';

                wakeRecognition.onresult = (event) => {
                    const transcript = event.results[event.results.length - 1][0].transcript.toLowerCase();
                    if (transcript.includes('hey organizer') || transcript.includes('hallo organizer')) {
                        wakeRecognition.stop();
                        setTimeout(() => {
                            AppState.speechRecognition.start();
                        }, 500);
                    }
                };

                wakeRecognition.onerror = () => {
                    // Restart wake word detection after error
                    setTimeout(() => {
                        if (AppState.settings.wakeWord) {
                            wakeRecognition.start();
                        }
                    }, 1000);
                };

                wakeRecognition.start();
                AppState.wakeRecognition = wakeRecognition;
            }
        }

        // ===== Analytics Functions =====
        function renderAnalytics() {
            calculateAnalytics();
            renderCategoryChart();
        }

        function calculateAnalytics() {
            // Calculate average fill level
            const fillLevels = AppState.inventory
                .map(item => item.properties?.['F√ºllstand'] || 100)
                .filter(level => level !== undefined);
            const avgFill = fillLevels.length > 0
                ? Math.round(fillLevels.reduce((a, b) => a + b, 0) / fillLevels.length)
                : 0;
            document.getElementById('avgFillLevel').textContent = avgFill + '%';

            // Calculate average condition
            const conditions = AppState.inventory
                .map(item => item.properties?.['Zustand'] || 100)
                .filter(condition => condition !== undefined);
            const avgCondition = conditions.length > 0
                ? Math.round(conditions.reduce((a, b) => a + b, 0) / conditions.length)
                : 0;
            document.getElementById('avgCondition').textContent = avgCondition + '%';

            // Find top category
            const categoryCounts = {};
            AppState.inventory.forEach(item => {
                categoryCounts[item.category] = (categoryCounts[item.category] || 0) + 1;
            });

            const topCategory = Object.entries(categoryCounts)
                .sort((a, b) => b[1] - a[1])[0];
            document.getElementById('topCategory').textContent = topCategory ? topCategory[0] : '-';
        }

        function renderCategoryChart() {
            const container = document.getElementById('categoryChart');
            container.innerHTML = '';

            const categoryCounts = {};
            AppState.inventory.forEach(item => {
                categoryCounts[item.category] = (categoryCounts[item.category] || 0) + 1;
            });

            const total = AppState.inventory.length;

            Object.entries(categoryCounts).forEach(([category, count]) => {
                const percentage = (count / total * 100).toFixed(1);
                const bar = document.createElement('div');
                bar.style.cssText = 'margin-bottom: 16px;';
                bar.innerHTML = `
                    <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                        <span>${category}</span>
                        <span>${count} (${percentage}%)</span>
                    </div>
                    <div class="progress-bar" style="height: 24px;">
                        <div class="progress-fill" style="width: ${percentage}%; display: flex; align-items: center; padding: 0 8px; font-size: 0.875rem; color: white;">
                            ${count}
                        </div>
                    </div>
                `;
                container.appendChild(bar);
            });
        }

        function generateAnalyticsReport() {
            const report = {
                generatedAt: new Date().toISOString(),
                totalItems: AppState.inventory.length,
                totalRooms: new Set(AppState.inventory.map(item => item.room)).size,
                categories: {},
                lowStockItems: [],
                poorConditionItems: [],
                roomDistribution: {},
                averageProperties: {}
            };

            // Analyze inventory
            AppState.inventory.forEach(item => {
                // Categories
                report.categories[item.category] = (report.categories[item.category] || 0) + 1;

                // Room distribution
                report.roomDistribution[item.room] = (report.roomDistribution[item.room] || 0) + 1;

                // Low stock
                if ((item.properties?.['F√ºllstand'] || 100) < 20) {
                    report.lowStockItems.push({
                        name: item.name,
                        location: `${item.room}${item.furniture ? ' ‚Ä∫ ' + item.furniture : ''}`,
                        fillLevel: item.properties?.['F√ºllstand'] || 0
                    });
                }

                // Poor condition
                if ((item.properties?.['Zustand'] || 100) < 30) {
                    report.poorConditionItems.push({
                        name: item.name,
                        location: `${item.room}${item.furniture ? ' ‚Ä∫ ' + item.furniture : ''}`,
                        condition: item.properties?.['Zustand'] || 0
                    });
                }
            });

            // Calculate averages for all properties
            AppState.properties.forEach(prop => {
                const values = AppState.inventory
                    .map(item => item.properties?.[prop])
                    .filter(v => v !== undefined);
                if (values.length > 0) {
                    report.averageProperties[prop] = Math.round(
                        values.reduce((a, b) => a + b, 0) / values.length
                    );
                }
            });

            // Download report as JSON
            const blob = new Blob([JSON.stringify(report, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `inventar-report-${new Date().toISOString().split('T')[0]}.json`;
            a.click();
            URL.revokeObjectURL(url);

            showNotification('Bericht wurde erstellt und heruntergeladen!', 'success');
        }

        // ===== Maintenance Functions =====
        function renderMaintenance() {
            const container = document.getElementById('maintenanceItems');
            container.innerHTML = '';

            // Items needing attention
            const needsAttention = AppState.inventory.filter(item => {
                const condition = item.properties?.['Zustand'] || 100;
                const battery = item.properties?.['Batterie'] || 100;
                const fillLevel = item.properties?.['F√ºllstand'] || 100;

                return condition < 30 || battery < 25 || fillLevel < 20;
            });

            if (needsAttention.length === 0) {
                container.innerHTML = '<p style="text-align: center; color: var(--text-medium);">Keine Wartung erforderlich</p>';
                return;
            }

            needsAttention.forEach(item => {
                const card = document.createElement('div');
                card.className = 'content-section';
                card.style.marginBottom = '16px';

                const issues = [];
                if ((item.properties?.['Zustand'] || 100) < 30) {
                    issues.push(`Zustand: ${item.properties['Zustand']}%`);
                }
                if ((item.properties?.['Batterie'] || 100) < 25) {
                    issues.push(`Batterie: ${item.properties['Batterie']}%`);
                }
                if ((item.properties?.['F√ºllstand'] || 100) < 20) {
                    issues.push(`F√ºllstand: ${item.properties['F√ºllstand']}%`);
                }

                card.innerHTML = `
                    <h4>${item.name}</h4>
                    <p style="color: var(--text-medium);">üìç ${item.room}${item.furniture ? ' ‚Ä∫ ' + item.furniture : ''}</p>
                    <div class="property-badges" style="margin-top: 8px;">
                        ${issues.map(issue => `<span class="property-badge" style="background: var(--error-color); color: white;">${issue}</span>`).join('')}
                    </div>
                    <button class="btn btn-secondary mt-md" onclick="showItemDetails('${item.id}')">
                        Details anzeigen
                    </button>
                `;

                container.appendChild(card);
            });
        }

        function addMaintenanceReminder() {
            // In a real app, this would open a form to add reminders
            showNotification('Erinnerungsfunktion wird in der n√§chsten Version verf√ºgbar sein', 'info');
        }

        // ===== Settings Functions =====
        function renderSettings() {
            // Update UI to match current settings
            document.getElementById('wakeWordToggle').classList.toggle('active', AppState.settings.wakeWord);
            document.getElementById('autoSaveToggle').classList.toggle('active', AppState.settings.autoSave);
            document.getElementById('showIDsToggle').classList.toggle('active', AppState.settings.showIDs);
            document.getElementById('speechRate').value = AppState.settings.speechRate;
            document.getElementById('speechVolume').value = AppState.settings.speechVolume;
            document.getElementById('ttsProvider').value = AppState.settings.ttsProvider;
            document.getElementById('sttProvider').value = AppState.settings.sttProvider;

            // Load categories and properties
            document.getElementById('categoriesConfig').value = AppState.categories.join('\n');
            document.getElementById('propertiesConfig').value = AppState.properties.join('\n');
        }

        function toggleWakeWord() {
            AppState.settings.wakeWord = !AppState.settings.wakeWord;
            document.getElementById('wakeWordToggle').classList.toggle('active');

            if (AppState.settings.wakeWord) {
                startWakeWordDetection();
                showNotification('Wake Word "Hey Organizer" aktiviert', 'success');
            } else {
                if (AppState.wakeRecognition) {
                    AppState.wakeRecognition.stop();
                    AppState.wakeRecognition = null;
                }
                showNotification('Wake Word deaktiviert', 'info');
            }

            saveDataToStorage();
        }

        function toggleAutoSave() {
            AppState.settings.autoSave = !AppState.settings.autoSave;
            document.getElementById('autoSaveToggle').classList.toggle('active');
            saveDataToStorage();
            showNotification(`Auto-Save ${AppState.settings.autoSave ? 'aktiviert' : 'deaktiviert'}`, 'info');
        }

        function toggleShowIDs() {
            AppState.settings.showIDs = !AppState.settings.showIDs;
            document.getElementById('showIDsToggle').classList.toggle('active');
            saveDataToStorage();
            renderCurrentSection();
            showNotification(`IDs werden ${AppState.settings.showIDs ? 'angezeigt' : 'versteckt'}`, 'info');
        }

        function updateSpeechRate(e) {
            AppState.settings.speechRate = parseFloat(e.target.value);
            saveDataToStorage();
        }

        function updateSpeechVolume(e) {
            AppState.settings.speechVolume = parseFloat(e.target.value);
            saveDataToStorage();
        }

        function updateTTSProvider(e) {
            AppState.settings.ttsProvider = e.target.value;
            saveDataToStorage();
            showNotification(`TTS-Provider auf ${e.target.value} ge√§ndert`, 'info');
        }

        function updateSTTProvider(e) {
            AppState.settings.sttProvider = e.target.value;
            saveDataToStorage();
            showNotification(`STT-Provider auf ${e.target.value} ge√§ndert`, 'info');
        }

        function saveConfiguration() {
            // Save categories
            const categories = document.getElementById('categoriesConfig').value
                .split('\n')
                .filter(cat => cat.trim())
                .map(cat => cat.trim());
            AppState.categories = categories;

            // Save properties
            const properties = document.getElementById('propertiesConfig').value
                .split('\n')
                .filter(prop => prop.trim())
                .map(prop => prop.trim());
            AppState.properties = properties;

            saveDataToStorage();
            showNotification('Konfiguration gespeichert!', 'success');

            // Re-render affected sections
            renderCategorySelection();
            renderPropertySliders();
        }

        function configureAPIs() {
            // In a real app, this would open a form to configure API keys
            showNotification('API-Konfiguration wird in der n√§chsten Version verf√ºgbar sein', 'info');
        }

        // ===== Import/Export Functions =====
        function exportJSON() {
            const data = JSON.stringify(AppState, null, 2);
            const blob = new Blob([data], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `inventar-backup-${new Date().toISOString().split('T')[0]}.json`;
            a.click();
            URL.revokeObjectURL(url);
            showNotification('JSON-Export erfolgreich!', 'success');
        }

        function exportCSV() {
            // Create CSV header
            const headers = ['ID', 'Name', 'Raum', 'M√∂bel', 'Container', 'Kategorie', 'Notizen', 'Hinzugef√ºgt', 'Ge√§ndert'];
            AppState.properties.forEach(prop => headers.push(prop));

            // Create CSV rows
            const rows = [headers];

            AppState.inventory.forEach(item => {
                const row = [
                    item.id,
                    item.name,
                    item.room,
                    item.furniture || '',
                    item.container || '',
                    item.category,
                    item.notes || '',
                    new Date(item.dateAdded).toLocaleString('de-DE'),
                    new Date(item.lastModified).toLocaleString('de-DE')
                ];

                AppState.properties.forEach(prop => {
                    row.push(item.properties?.[prop] || '');
                });

                rows.push(row);
            });

            // Convert to CSV string with proper escaping
            const csvContent = rows.map(row =>
                row.map(cell => {
                    const cellStr = String(cell);
                    // Escape quotes and wrap in quotes if contains comma, newline, or quote
                    if (cellStr.includes(',') || cellStr.includes('\n') || cellStr.includes('"')) {
                        return '"' + cellStr.replace(/"/g, '""') + '"';
                    }
                    return cellStr;
                }).join(',')
            ).join('\n');

            // Add BOM for Excel UTF-8 compatibility
            const BOM = '\uFEFF';
            const blob = new Blob([BOM + csvContent], { type: 'text/csv;charset=utf-8;' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `inventar-export-${new Date().toISOString().split('T')[0]}.csv`;
            a.click();
            URL.revokeObjectURL(url);
            showNotification('CSV-Export erfolgreich!', 'success');
        }

        function exportInventory() {
            // Show export options
            const choice = confirm('JSON-Format exportieren? (OK = JSON, Abbrechen = CSV)');
            if (choice) {
                exportJSON();
            } else {
                exportCSV();
            }
        }

        function handleImport(e) {
            const file = e.target.files[0];
            if (!file) return;

            const reader = new FileReader();

            if (file.name.endsWith('.json')) {
                reader.onload = (event) => {
                    try {
                        const data = JSON.parse(event.target.result);
                        if (confirm('Dies wird alle aktuellen Daten ersetzen. Fortfahren?')) {
                            Object.assign(AppState, data);
                            saveDataToStorage();
                            renderCurrentSection();
                            showNotification('JSON-Import erfolgreich!', 'success');
                        }
                    } catch (error) {
                        showNotification('Fehler beim Import: ' + error.message, 'error');
                    }
                };
                reader.readAsText(file);
            } else if (file.name.endsWith('.csv')) {
                reader.onload = (event) => {
                    try {
                        const csvData = event.target.result;
                        const rows = csvData.split('\n').map(row => {
                            const cells = [];
                            let cell = '';
                            let inQuotes = false;

                            for (let i = 0; i < row.length; i++) {
                                const char = row[i];
                                const nextChar = row[i + 1];

                                if (char === '"' && nextChar === '"' && inQuotes) {
                                    cell += '"';
                                    i++; // Skip next quote
                                } else if (char === '"') {
                                    inQuotes = !inQuotes;
                                } else if (char === ',' && !inQuotes) {
                                    cells.push(cell);
                                    cell = '';
                                } else {
                                    cell += char;
                                }
                            }
                            cells.push(cell);
                            return cells;
                        });

                        if (rows.length < 2) {
                            throw new Error('CSV-Datei ist leer oder ung√ºltig');
                        }

                        const headers = rows[0];
                        const items = [];

                        for (let i = 1; i < rows.length; i++) {
                            const row = rows[i];
                            if (row.length < headers.length) continue;

                            const item = {
                                id: row[0] || generateItemId(),
                                name: row[1],
                                room: row[2],
                                furniture: row[3] || null,
                                container: row[4] || null,
                                category: row[5] || 'Sonstiges',
                                notes: row[6] || '',
                                dateAdded: row[7] || new Date().toISOString(),
                                lastModified: row[8] || new Date().toISOString(),
                                properties: {}
                            };

                            // Import properties
                            for (let j = 9; j < headers.length && j < row.length; j++) {
                                const propName = headers[j];
                                const propValue = parseInt(row[j]) || 0;
                                item.properties[propName] = propValue;
                            }

                            items.push(item);
                        }

                        if (confirm(`${items.length} Gegenst√§nde gefunden. Importieren?`)) {
                            AppState.inventory = items;
                            saveDataToStorage();
                            renderCurrentSection();
                            showNotification(`${items.length} Gegenst√§nde importiert!`, 'success');
                        }
                    } catch (error) {
                        showNotification('Fehler beim CSV-Import: ' + error.message, 'error');
                    }
                };
                reader.readAsText(file, 'UTF-8');
            }

            // Reset input
            e.target.value = '';
        }

        function clearAllData() {
            if (confirm('WARNUNG: Dies wird ALLE Daten unwiderruflich l√∂schen! Sind Sie sicher?')) {
                if (confirm('Wirklich ALLE Daten l√∂schen? Diese Aktion kann nicht r√ºckg√§ngig gemacht werden!')) {
                    localStorage.clear();
                    location.reload();
                }
            }
        }

        // ===== Focus View Functions =====
        function openFocusView(itemIdOrType, name) {
            const focusView = document.getElementById('focusView');
            const focusTitle = document.getElementById('focusTitle');
            const focusContent = document.getElementById('focusContent');

            if (itemIdOrType === 'room' || itemIdOrType === 'furniture' || itemIdOrType === 'container') {
                // Focus on room/furniture/container
                focusTitle.textContent = `${name} - √úbersicht`;

                const items = AppState.inventory.filter(item => {
                    switch (itemIdOrType) {
                        case 'room':
                            return item.room === name;
                        case 'furniture':
                            return item.furniture === name;
                        case 'container':
                            return item.container === name;
                        default:
                            return false;
                    }
                });

                focusContent.innerHTML = `
                    <div class="stat-card">
                        <div class="stat-value">${items.length}</div>
                        <div class="stat-label">Gegenst√§nde</div>
                    </div>
                    <h4 style="margin-top: 24px; margin-bottom: 16px;">Inhalt:</h4>
                    <div class="inventory-grid">
                        ${items.map(item => createInventoryCard(item).outerHTML).join('')}
                    </div>
                `;
            } else {
                // Focus on specific item
                const item = AppState.inventory.find(i => i.id === itemIdOrType);
                if (!item) return;

                focusTitle.textContent = item.name;

                const photoHtml = item.photo
                    ? `<img src="${item.photo}" alt="${item.name}" style="width: 100%; max-height: 200px; object-fit: cover; border-radius: 8px; margin-bottom: 16px;">`
                    : '';

                focusContent.innerHTML = `
                    ${photoHtml}
                    <div class="form-group">
                        <label class="form-label">Standort</label>
                        <p>${item.room}${item.furniture ? ' ‚Ä∫ ' + item.furniture : ''}${item.container ? ' ‚Ä∫ ' + item.container : ''}</p>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Kategorie</label>
                        <span class="property-badge" style="background: var(--primary-light); color: var(--primary-dark);">
                            ${item.category}
                        </span>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Eigenschaften</label>
                        ${Object.entries(item.properties || {}).map(([key, value]) => `
                            <div style="margin-bottom: 12px;">
                                <div style="display: flex; justify-content: space-between; margin-bottom: 4px;">
                                    <span>${key}</span>
                                    <span>${value}%</span>
                                </div>
                                <div class="progress-bar">
                                    <div class="progress-fill" style="width: ${value}%;"></div>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                    ${item.notes ? `
                        <div class="form-group">
                            <label class="form-label">Notizen</label>
                            <p>${item.notes}</p>
                        </div>
                    ` : ''}
                `;
            }

            focusView.classList.add('active');

            // Adjust main content margin
            document.querySelector('.main-content').style.marginRight = '400px';
        }

        function closeFocusView() {
            const focusView = document.getElementById('focusView');
            focusView.classList.remove('active');
            document.querySelector('.main-content').style.marginRight = '0';
        }

        // ===== Notification System =====
        function showNotification(message, type = 'info') {
            const container = document.getElementById('notificationContainer');
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;

            const icon = type === 'success' ? '‚úÖ' :
                        type === 'error' ? '‚ùå' :
                        type === 'warning' ? '‚ö†Ô∏è' : '‚ÑπÔ∏è';

            notification.innerHTML = `
                <span>${icon}</span>
                <span>${message}</span>
            `;

            container.appendChild(notification);

            // Auto-remove after 5 seconds
            setTimeout(() => {
                notification.style.animation = 'slideOutRight 0.5s ease';
                setTimeout(() => notification.remove(), 500);
            }, 5000);
        }

        // ===== QR Code Generation =====
        function generateQRCode(itemId) {
            // In a real app, you'd use a QR code library
            // For now, we'll show a placeholder
            console.log('QR Code for item:', itemId);
        }

        function generateItemQR(itemId) {
            const item = AppState.inventory.find(i => i.id === itemId);
            if (!item) return;

            // Create QR data
            const qrData = {
                id: item.id,
                name: item.name,
                location: `${item.room}${item.furniture ? ' ‚Ä∫ ' + item.furniture : ''}${item.container ? ' ‚Ä∫ ' + item.container : ''}`,
                app: 'Smart Inventar Organizer Pro'
            };

            // In a real app, generate actual QR code
            showNotification('QR-Code wurde generiert (Demo)', 'info');
        }

        // ===== Modal Functions =====
        function closeModal(modalId) {
            const modal = document.getElementById(modalId);
            modal.classList.remove('active');
        }

        // Close modal on outside click
        document.addEventListener('click', (e) => {
            if (e.target.classList.contains('modal')) {
                e.target.classList.remove('active');
            }
        });

        // ===== Keyboard Shortcuts =====
        document.addEventListener('keydown', (e) => {
            // Ctrl/Cmd + S: Save
            if ((e.ctrlKey || e.metaKey) && e.key === 's') {
                e.preventDefault();
                saveDataToStorage();
                showNotification('Daten gespeichert!', 'success');
            }

            // Ctrl/Cmd + F: Focus search
            if ((e.ctrlKey || e.metaKey) && e.key === 'f') {
                e.preventDefault();
                navigateToSection('search');
                document.getElementById('searchInput').focus();
            }

            // Ctrl/Cmd + N: New item
            if ((e.ctrlKey || e.metaKey) && e.key === 'n') {
                e.preventDefault();
                navigateToSection('add');
            }

            // Escape: Close modals and focus view
            if (e.key === 'Escape') {
                document.querySelectorAll('.modal.active').forEach(modal => {
                    modal.classList.remove('active');
                });
                closeFocusView();
            }
        });

        // ===== Service Worker Registration (for offline support) =====
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('sw.js').catch(err => {
                console.log('Service Worker registration failed:', err);
            });
        }

        // ===== Performance Optimization =====
        // Debounce function for search input
        function debounce(func, wait) {
            let timeout;
            return function executedFunction(...args) {
                const later = () => {
                    clearTimeout(timeout);
                    func(...args);
                };
                clearTimeout(timeout);
                timeout = setTimeout(later, wait);
            };
        }

        // Apply debounce to search
        document.getElementById('searchInput').addEventListener('input', debounce(handleSearch, 300));

        // ===== Initialize Demo Data (if empty) =====
        if (AppState.inventory.length === 0) {
            // Add some demo items
            const demoItems = [
                {
                    id: generateItemId(),
                    name: 'Akkuschrauber Bosch',
                    room: 'Werkstatt',
                    furniture: 'Werkbank',
                    container: 'Obere Schublade',
                    category: 'üîß Werkzeug',
                    properties: { 'F√ºllstand': 100, 'Zustand': 85, 'Batterie': 60 },
                    notes: 'Inkl. 2 Akkus und Ladeger√§t',
                    dateAdded: new Date().toISOString(),
                    lastModified: new Date().toISOString()
                },
                {
                    id: generateItemId(),
                    name: 'Erste-Hilfe-Set',
                    room: 'Badezimmer',
                    furniture: 'Spiegelschrank',
                    container: null,
                    category: 'üíä Medizin',
                    properties: { 'F√ºllstand': 75, 'Zustand': 100 },
                    notes: 'Haltbarkeit √ºberpr√ºfen!',
                    dateAdded: new Date().toISOString(),
                    lastModified: new Date().toISOString()
                },
                {
                    id: generateItemId(),
                    name: 'Gaming-Headset',
                    room: 'Arbeitszimmer',
                    furniture: 'Schreibtisch',
                    container: null,
                    category: 'üéÆ Gaming',
                    properties: { 'Zustand': 90, 'Batterie': 45 },
                    notes: 'Wireless, USB-C Ladekabel',
                    dateAdded: new Date().toISOString(),
                    lastModified: new Date().toISOString()
                }
            ];

            AppState.inventory = demoItems;
            saveDataToStorage();
        }

        console.log('Smart Inventar Organizer Pro 2.0 geladen!');
    </script>
</body>
</html>
